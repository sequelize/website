<!DOCTYPE html><html>
<!-- Mirrored from localhost:3000/docs/1.7.6/utils by HTTrack Website Copier/3.x [XR&CO'2014], Sat, 19 Mar 2022 11:45:49 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head><title>Sequelize - Documentation - Utils</title><link rel="shortcut icon" type="image/x-icon" href="../../favicon.ico"><link rel="stylesheet" href="../../stylesheets/style.css"><script src="../../javascripts/jquery-1.10.2.min.js"></script><script>fromGithub = function (partialId, url) {
  var $partial = $("#" + partialId)

  $partial.load(url, function () {
    hljs.highlightBlock($partial.get(0));
  });
}</script></head><body id="documentation"><div role="navigation" class="navbar navbar-default navbar-fixed-top"><div class="container-liquid"><div class="col-sm-3 navbar-left"><section><a href="../../index.html" class="navbar-brand"><img src="../../images/logo-small.png"><span>Sequelize</span></a><div class="clearfix"></div></section></div><div class="col-sm-8 navbar-right"><section><button type="button" data-toggle="collapse" data-target=".navbar-collapse" class="navbar-toggle"><span class="sr-only">Toggle navigation</span><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></button><div class="navbar-collapse collapse"><ul class="nav navbar-nav"></ul><ul class="nav navbar-nav navbar-right"><li><a href="../../index.html"><span class="glyphicon glyphicon-home"></span><span class="spacer">&nbsp;</span><span class="text">Home</span></a></li><li class="active"><a href="../1.7.8/installation.html"><span class="glyphicon glyphicon-info-sign"></span><span class="spacer">&nbsp;</span><span class="text">Docs</span></a></li><li><a href="../../articles/getting-started.html"><span class="glyphicon glyphicon-book"></span><span class="spacer">&nbsp;</span><span class="text">Articles</span></a></li><li><a href="../../blog.html"><span class="glyphicon glyphicon-comment"></span><span class="spacer">&nbsp;</span><span class="text">Blog</span></a></li><li><a href="../../search.html" class="search"><i class="fa fa-search"></i><span class="spacer">&nbsp;</span><span class="text">Search</span></a></li></ul></div></section></div></div></div><div class="container-liquid"><div class="row documentation"><div class="col-sm-2 mid-blue sidebar"><div class="headline-spacer"></div><section class="navigation"><ul><li><a href="installation.html">Installation</a></li><li><a href="usage.html">Usage</a><ul><li><a href="usage.html#basics">Basic usage</a></li><li><a href="usage.html#options">Options</a></li><li><a href="usage.html#read-replication">Read replication</a></li><li><a href="usage.html#dialects">Dialects</a></li><li><a href="usage.html#raw-queries">Executing raw SQL queries</a></li></ul></li><li><a href="models.html">Models</a><ul><li><a href="models.html#definition">Definition</a></li><li><a href="models.html#data-types">Data types</a></li><li><a href="models.html#getters---setters">Getters &amp; setters</a></li><li><a href="models.html#validations">Validations</a></li><li><a href="models.html#configuration">Configuration</a></li><li><a href="models.html#import">Import</a></li><li><a href="models.html#database-synchronization">Database synchronization</a></li><li><a href="models.html#expansion-of-models">Expansion of models</a></li><li><a href="models.html#finders">Data retrieval / Finders</a></li><li><a href="models.html#eager-loading">Eager loading</a></li><li><a href="models.html#ordered-eager-loading">Ordering Eager Loaded Associations</a></li><li><a href="models.html#nested-eager-loading">Nested eager loading</a></li></ul></li><li><a href="instances.html">Instances</a><ul><li><a href="instances.html#build">Building a not-persistant instance</a></li><li><a href="instances.html#create">Creating persistant instances</a></li><li><a href="instances.html#update">Updating / Saving / Persisting an instance</a></li><li><a href="instances.html#destroy">Destroying / Deleting persistant instances</a></li><li><a href="instances.html#bulk">Working in bulk (updating multiple rows at once)</a></li><li><a href="instances.html#values">Values of an instance</a></li><li><a href="instances.html#reload">Reloading instances</a></li><li><a href="instances.html#increment">Incrementing certain values of an instance</a></li><li><a href="instances.html#decrement">Decrementing certain values of an instance</a></li></ul></li><li><a href="associations.html">Associations</a><ul><li><a href="associations.html#one-to-one">One-To-One associations</a></li><li><a href="associations.html#one-to-many">One-To-Many associations</a></li><li><a href="associations.html#many-to-many">Many-To-Many associations</a></li><li><a href="associations.html#associating-objects">Associating objects</a></li><li><a href="associations.html#check-associations">Check associations</a></li><li><a href="associations.html#foreign-keys">Foreign Keys</a></li></ul></li><li><a href="hooks.html">Hooks</a><ul><li><a href="hooks.html#order-of-operations">Order of Operations</a></li><li><a href="hooks.html#declaring-hooks">Declaring Hooks</a></li></ul></li><li><a href="transactions.html">Transactions</a></li><li><a href="migrations.html">Migrations</a><ul><li><a href="migrations.html#the-binary">The binary</a></li><li><a href="migrations.html#skeleton">Skeleton</a></li><li><a href="migrations.html#functions">Functions</a></li><li><a href="migrations.html#programmatic-use">Programmatic use</a></li></ul></li><li class="active"><a href="utils.html">Utils</a><ul><li><a href="utils.html#lodash-js">Lodash.js</a></li><li><a href="utils.html#querychainer">QueryChainer</a></li><li><a href="utils.html#custom-event-emitter">CustomEventEmitter</a></li></ul></li><li><a href="misc.html">Misc</a><ul><li><a href="misc.html#compatibility">Compatibility</a></li><li><a href="misc.html#asynchronicity">Asynchronicity</a></li><li><a href="misc.html#links(data-nav-value='Links')">Additional links</a></li><li><a href="misc.html#company---projects">Company &amp; Projects</a></li></ul></li><li><a>Versions</a><ul><li><a href="../latest/installation.html">Latest</a></li><li><a href="../1.7.8/installation.html">1.7.8</a></li><li><a href="installation.html">1.7.6</a></li><li><a href="../1.7.0-beta.1/installation.html">1.7.0-beta.1</a></li></ul></li></ul></section><div class="clearfix"></div></div><div class="col-sm-9 col-sm-offset-1 beige content"><section><div><h2>Utils</h2><p>Sequelize comes with some handy utils including references to<code>lodash</code>as well as some individual helpers&period; You can access them via<code>Sequelize&period;Utils</code>&period;</p><h3 id="lodash-js">Lodash.js</h3><p>You can access all the methods of lodash like this&colon;</p><pre class="dark-blue"><code class="javascript">Sequelize.Utils._.each(/* ... */)
Sequelize.Utils._.map(/* ... */)
Sequelize.Utils._...</code></pre><p>Also Sequelize ships the Underscore extension<code>underscore&period;string</code>&comma; which allows nifty string manipulation&colon;</p><pre class="dark-blue"><code class="javascript">Sequelize.Utils._.camelize('something') // Something</code></pre><p>Check out the page of&nbsp;<a href="http://lodash.com/" rel="nofollow" target="_blank">Lodash</a>&comma;&nbsp;<a href="http://underscorejs.org/" rel="nofollow" target="_blank">Underscore</a>&nbsp;and&nbsp;<a href="https://github.com/epeli/underscore.string" rel="nofollow" target="_blank">underscore&period;string</a>&nbsp;for further information&period;</p><h3 id="querychainer">QueryChainer</h3><p>Because you will want to save&sol;create&sol;delete several items at once and just go on after all of them are saved&comma; Sequelize provides the<code>QueryChainer</code>module&period; It can be used like this&colon;</p><pre class="dark-blue"><code class="javascript">var chainer = new Sequelize.Utils.QueryChainer
chainer.add(/* Query | EventEmitter */)
chainer.run().success(function(){}).error(function(errors){})</code></pre><p>And a real world example&colon;</p><pre class="dark-blue"><code class="javascript">var chainer = new Sequelize.Utils.QueryChainer
var Task    = sequelize.define('Task', /* ... */)
&nbsp;
chainer
  .add(Task.drop())
  .add(Task.sync())
&nbsp;
for(var i = 0; i < 20; i++)
  chainer.add(Task.create({}))
&nbsp;
chainer
  .run()
  .success(function(){})
  .error(function(errors){})</code></pre><p>It is also possible to force a serial run of the query chainer by using the following syntax:</p><pre class="dark-blue"><code class="javascript">new Sequelize.Utils.QueryChainer()
  .add(Model, 'function', [param1, param2])
  .add(Model, 'function2', [param1, param2])
  .runSerially()
  .success(function() { /* no problems :) */ })
  .error(function(err) { /* hmm not good :> */ })
&nbsp;
// and with options:
&nbsp;
new Sequelize.Utils.QueryChainer()
  .add(Model, 'function', [param1, param2], {
    // Will be executed before Model#function is called
    before: function(model) {},
&nbsp;
    /*
      Will be executed after Model#function was called
      and the function emitted a success or error event.
      If the following success option is passed, the function
      will be executed after the success function.
    */
    after: function(migration) {},
&nbsp;
    // Will be executed if Model#function emits a success event.
    success: function(migration, callback) {}
  })
  // skipOnError: don't execute functions once one has emitted an failure event.
  .runSerially({ skipOnError: true })
  .success(function() { /* no problems :) */ })
  .error(function(err) { /* hmm not good :> */ })</code></pre><p>If the success callbacks of the added methods are passing values&comma; they can be utilized in the actual<code>success</code>method of the query chainer&colon;</p><pre class="dark-blue"><code class="javascript">chainer.add(Project.getTasks())
chainer.add(Project.getTeam())
chainer.run().success(function(results){
  var tasks = results[0]
  var team = results[1]
})</code></pre><h3 id="custom-event-emitter">CustomEventEmitter</h3><p>One of the core components of the library is the <code>CustomEventEmitter</code>,
which takes an (asynchronous) function, allows the binding to certain events
and finally runs the passed function. Within the function, the user gets
access to the emitter instance and can (once the function's logic is done)
emit success / error events. The basic look is the following:</p><pre class="dark-blue"><code class="javascript">new Sequelize.Utils.CustomEventEmitter(function(emitter) {
  doAsyncLogic(function(err) {
    if (err) {
      emitter.emit('error', err)
    } else {
      emitter.emit('success')
    }
  })
})
.success(function() { /* success! */ })
.error(function(err) { /* error */ })
.run()</code></pre><p>As you can probably see, the event observing is the very same
as for all the asynchronous methods in the Sequelize universe.
That's because every asynchronouse function in Sequelize
returns an instance of the CustomEventEmitter.</p><p>If you are afraid, that the passed function might have been
executed already just before you bound the event observers:
The execution of the function is delayed minimally.
Because of that you can also just call <code>.run()</code>
and bind the events afterwards.</p><p>Because there is a fair chance, that you already have an emitter
and you just want to pipe the events from one emitter to the other,
each instance has a method called <code>.proxy()</code>:</p><pre class="dark-blue"><code class="javascript">new Sequelize.Utils.CustomEventEmitter(function(emitter) {
  asyncAuthLogic(function(err) {
    if (err) {
      return emitter.emit('err')
    }
&nbsp;
    Model
      .find()
      .proxy(emitter, { events: ['error'] })
      .success(function(result) {
        emitter.emit('success', parseInt(result.stringifiedAge, 10))
      })
  })
})
.error(function(err) { console.log(err) })
.success(function(ageAsInteger) { console.log(ageAsInteger) })
.run()</code></pre><p>In this example we first do an asynchronous authentication check,
receive an instance from the database afterwards and finally
transform its data. As we aren't interested in a special treatment
for the different error case, we will just observe the error event
once and pipe the error cases of the <code>Model.find()</code> call
to the outer emitter.</p></div></section></div></div></div><div class="imprint very-dark-blue"><div class="container"><div class="col-sm-4">&copy;
Sascha Depold,
<a href="https://github.com/sequelize/sequelize-doc/graphs/contributors" target="_blank" rel="nofollow">et al.</a>
2006 -&nbsp;2022</div><div style="text-align: right" class="col-sm-8"><a href="../../imprint.html">Imprint</a></div></div></div><script src="../../javascripts/bootstrap.min.js"></script><script src="../../javascripts/highlight.pack.js"></script><script src="../../javascripts/main.js"></script><script src="../../javascripts/documentation.js"></script><script type="text/javascript">(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','http://www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-9039631-4', 'sequelizejs.com');
ga('send', 'pageview');</script></body>
<!-- Mirrored from localhost:3000/docs/1.7.6/utils by HTTrack Website Copier/3.x [XR&CO'2014], Sat, 19 Mar 2022 11:45:49 GMT -->
</html>