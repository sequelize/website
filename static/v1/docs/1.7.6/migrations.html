<!DOCTYPE html><html><!-- Mirrored from localhost:3000/docs/1.7.6/migrations by HTTrack Website Copier/3.x [XR&CO'2014], Sat, 19 Mar 2022 11:45:49 GMT --><!-- Added by HTTrack --><head><meta http-equiv="content-type" content="text/html;charset=utf-8"><!-- /Added by HTTrack -->
<title>Sequelize - Documentation - Migrations</title><link rel="shortcut icon" type="image/x-icon" href="../../favicon.ico"><link rel="stylesheet" href="../../stylesheets/style.css"><script src="../../javascripts/jquery-1.10.2.min.js"></script><script>fromGithub = function (partialId, url) {
  var $partial = $("#" + partialId)

  $partial.load(url, function () {
    hljs.highlightBlock($partial.get(0));
  });
}</script><meta name="robots" content="noindex"></head><body id="documentation"><div role="navigation" class="navbar navbar-default navbar-fixed-top"><div class="container-liquid"><div class="col-sm-3 navbar-left"><section><a href="../../index.html" class="navbar-brand"><img src="../../images/logo-small.png"><span>Sequelize</span></a><div class="clearfix"></div></section></div><div class="col-sm-8 navbar-right"><section><button type="button" data-toggle="collapse" data-target=".navbar-collapse" class="navbar-toggle"><span class="sr-only">Toggle navigation</span><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></button><div class="navbar-collapse collapse"><ul class="nav navbar-nav"></ul><ul class="nav navbar-nav navbar-right"><li><a href="../../index.html"><span class="glyphicon glyphicon-home"></span><span class="spacer">&nbsp;</span><span class="text">Home</span></a></li><li class="active"><a href="../1.7.8/installation.html"><span class="glyphicon glyphicon-info-sign"></span><span class="spacer">&nbsp;</span><span class="text">Docs</span></a></li><li><a href="../../articles/getting-started.html"><span class="glyphicon glyphicon-book"></span><span class="spacer">&nbsp;</span><span class="text">Articles</span></a></li><li><a href="../../blog.html"><span class="glyphicon glyphicon-comment"></span><span class="spacer">&nbsp;</span><span class="text">Blog</span></a></li><li><a href="../../search.html" class="search"><i class="fa fa-search"></i><span class="spacer">&nbsp;</span><span class="text">Search</span></a></li></ul></div></section></div></div></div><div class="container-liquid"><div class="row documentation"><div class="col-sm-2 mid-blue sidebar"><div class="headline-spacer"></div><section class="navigation"><ul><li><a href="installation.html">Installation</a></li><li><a href="usage.html">Usage</a><ul><li><a href="usage.html#basics">Basic usage</a></li><li><a href="usage.html#options">Options</a></li><li><a href="usage.html#read-replication">Read replication</a></li><li><a href="usage.html#dialects">Dialects</a></li><li><a href="usage.html#raw-queries">Executing raw SQL queries</a></li></ul></li><li><a href="models.html">Models</a><ul><li><a href="models.html#definition">Definition</a></li><li><a href="models.html#data-types">Data types</a></li><li><a href="models.html#getters---setters">Getters &amp; setters</a></li><li><a href="models.html#validations">Validations</a></li><li><a href="models.html#configuration">Configuration</a></li><li><a href="models.html#import">Import</a></li><li><a href="models.html#database-synchronization">Database synchronization</a></li><li><a href="models.html#expansion-of-models">Expansion of models</a></li><li><a href="models.html#finders">Data retrieval / Finders</a></li><li><a href="models.html#eager-loading">Eager loading</a></li><li><a href="models.html#ordered-eager-loading">Ordering Eager Loaded Associations</a></li><li><a href="models.html#nested-eager-loading">Nested eager loading</a></li></ul></li><li><a href="instances.html">Instances</a><ul><li><a href="instances.html#build">Building a not-persistant instance</a></li><li><a href="instances.html#create">Creating persistant instances</a></li><li><a href="instances.html#update">Updating / Saving / Persisting an instance</a></li><li><a href="instances.html#destroy">Destroying / Deleting persistant instances</a></li><li><a href="instances.html#bulk">Working in bulk (updating multiple rows at once)</a></li><li><a href="instances.html#values">Values of an instance</a></li><li><a href="instances.html#reload">Reloading instances</a></li><li><a href="instances.html#increment">Incrementing certain values of an instance</a></li><li><a href="instances.html#decrement">Decrementing certain values of an instance</a></li></ul></li><li><a href="associations.html">Associations</a><ul><li><a href="associations.html#one-to-one">One-To-One associations</a></li><li><a href="associations.html#one-to-many">One-To-Many associations</a></li><li><a href="associations.html#many-to-many">Many-To-Many associations</a></li><li><a href="associations.html#associating-objects">Associating objects</a></li><li><a href="associations.html#check-associations">Check associations</a></li><li><a href="associations.html#foreign-keys">Foreign Keys</a></li></ul></li><li><a href="hooks.html">Hooks</a><ul><li><a href="hooks.html#order-of-operations">Order of Operations</a></li><li><a href="hooks.html#declaring-hooks">Declaring Hooks</a></li></ul></li><li><a href="transactions.html">Transactions</a></li><li class="active"><a href="migrations.html">Migrations</a><ul><li><a href="migrations.html#the-binary">The binary</a></li><li><a href="migrations.html#skeleton">Skeleton</a></li><li><a href="migrations.html#functions">Functions</a></li><li><a href="migrations.html#programmatic-use">Programmatic use</a></li></ul></li><li><a href="utils.html">Utils</a><ul><li><a href="utils.html#lodash-js">Lodash.js</a></li><li><a href="utils.html#querychainer">QueryChainer</a></li><li><a href="utils.html#custom-event-emitter">CustomEventEmitter</a></li></ul></li><li><a href="misc.html">Misc</a><ul><li><a href="misc.html#compatibility">Compatibility</a></li><li><a href="misc.html#asynchronicity">Asynchronicity</a></li><li><a href="misc.html#links(data-nav-value='Links')">Additional links</a></li><li><a href="misc.html#company---projects">Company &amp; Projects</a></li></ul></li><li><a>Versions</a><ul><li><a href="../latest/installation.html">Latest</a></li><li><a href="../1.7.8/installation.html">1.7.8</a></li><li><a href="installation.html">1.7.6</a></li><li><a href="../1.7.0-beta.1/installation.html">1.7.0-beta.1</a></li></ul></li></ul></section><div class="clearfix"></div></div><div class="col-sm-9 col-sm-offset-1 beige content"><section><div><h2>Migrations</h2><p>Sequelize<code>v1.3.0</code>introduced migrations. With those mechanism you can transform your existing database into another state and vice versa. Those state transitions are saved in migration files, which describe the way how to get to the new state and how to revert the changes in order to get back to the old state.</p><h3 id="the-binary">The binary</h3><p>In order to run migrations, sequelize comes with a handy binary file which can setup your project and run migrations. The following snippet shows the possible things:</p><pre class="dark-blue"><code class="bash">sequelize -h
sequelize --help
# prints the help

sequelize -V
sequelize --version
# prints the version

sequelize -i
sequelize --init
# creates a migration folder
# creates a config folder
# saves a config.json inside the config folder

sequelize -e [environment]
sequelize --env [environment]
# Use the passed environment. Default: development

sequelize -i -f
sequelize --init --force
# forced creation of migration and config folder
# existing data will be deleted first

sequelize -m
sequelize --migrate
# needs a valid config.json
# runs pending migrations
# saves successfully executed migrations inside the database

sequelize -m -u
sequelize --migrate --undo
# needs a valid config.json
# reverts the last successfull migration
# when there were multiple executed migrations, all of them are reverted

sequelize -c [migration-name]
sequelize --create-migration [migration-name]
# creates the migrations folder
# creates a file with current timestamp + migration-name
# migration-name has the default 'unnamed-migration'

sequelize -p [path]
sequelize --migration-path [path]
# Defines the path to the migration directory.

sequelize -o [path]
sequelize --options-path [path]
# Defines the path to the options file.
# The options file (.js or .json) needs to return an object.
# Keys / values references cli options
# e.g.: { migrationPath: 'db/migrations' }

sequelize --config [path]
# Defines the path to the configuration file.

sequelize --coffee
# Enables coffeescript support.
</code></pre><h3 id="skeleton">Skeleton</h3><p>The following skeleton shows a typical migration file. All migrations are expected to be located in a folder called<code>migrations</code>at the very top of the project. Sequelize<code>1.4.1</code>added the possibility to let the sequelize binary generate a migration skeleton. See the aboves section for more details.</p><pre class="dark-blue"><code class="javascript">module.exports = {
  up: function(migration, DataTypes, done) {
    // logic for transforming into the new state
    done() // sets the migration as finished
  },
&nbsp;
  down: function(migration, DataTypes, done) {
    // logic for reverting the changes
    done() // sets the migration as finished
  }
}</code></pre><p>The passed<code>migration</code>object can be used to modify the database. The<code>DataTypes</code>object stores the available data types such as<code>STRING</code>or<code>INTEGER</code>. The third parameter is a callback function which needs to be called once everything was executed. The first parameter of the callback function can be used to pass a possible error. In that case, the migration will be marked as failed. Here is some code:</p><pre class="dark-blue"><code class="javascript">module.exports = {
  up: function(migration, DataTypes, done) {
    migration.dropAllTables().complete(done)
&nbsp;
    // equals:
    migration.dropAllTables().complete(function(err) {
      if (err) {
        done(err)
      } else {
        done(null)
      }
    })
  }
}</code></pre><p>The available methods of the migration object are the following.</p><h3 id="functions">Functions</h3><p>Using the<code>migration</code>object describe before, you will have access to most of already introduced functions. Furthermore there are some other methods, which are designed to actually change the database schema.</p><h4 id="functions-createtable">createTable(tableName, attributes, options)</h4><p>This method allows creation of new tables. It is allowed to pass simple or complex attribute definitions. You can define the encoding of the table and the table's engine via options</p><pre class="dark-blue"><code class="javascript">migration.createTable(
  'nameOfTheNewTable',
  {
    id: {
      type: DataTypes.INTEGER,
      primaryKey: true,
      autoIncrement: true
    },
    createdAt: {
      type: DataTypes.DATE
    },
    updatedAt: {
      type: DataTypes.DATE
    },
    attr1: DataTypes.STRING,
    attr2: DataTypes.INTEGER,
    attr3: {
      type: DataTypes.BOOLEAN,
      defaultValue: false,
      allowNull: false
    }
  },
  {
    engine: 'MYISAM', // default: 'InnoDB'
    charset: 'latin1' // default: null
  }
)</code></pre><h4 id="functions-droptable">dropTable(tableName)</h4><p>This method allows deletion of an existing table.</p><pre class="dark-blue"><code class="javascript">migration.dropTable('nameOfTheExistingTable')</code></pre><h4 id="functions-dropalltables">dropAllTables()</h4><p>This method allows deletion of all existing tables in the database.</p><pre class="dark-blue"><code class="javascript">migration.dropAllTables()</code></pre><h4 id="functions-renametable">renameTable(before, after)</h4><p>This method allows renaming of an existing table.</p><pre class="dark-blue"><code class="javascript">migration.renameTable('Person', 'User')</code></pre><h4 id="functions-showalltables">showAllTables()</h4><p>This method returns the name of all existing tables in the database.</p><pre class="dark-blue"><code class="javascript">migration.showAllTables().success(function(tableNames) {})</code></pre><h4 id="functions-describetable">describeTable(tableName)</h4><p>This method returns an array of hashes containing information about all attributes in the table.</p><pre class="dark-blue"><code class="javascript">migration.describeTable('Person').success(function(attributes) {
  /*
    attributes will be something like:
&nbsp;
    {
      name: {
        type:         'VARCHAR(255)', // this will be 'CHARACTER VARYING' for pg!
        allowNull:    true,
        defaultValue: null
      },
      isBetaMember: {
        type:         'TINYINT(1)', // this will be 'BOOLEAN' for pg!
        allowNull:    false,
        defaultValue: false
      }
    }
  */
})</code></pre><h4 id="functions-addcolumn">addColumn(tableName, attributeName, dataTypeOrOptions)</h4><p>This method allows adding columns to an existing table. The data type can be simple or complex.</p><pre class="dark-blue"><code class="javascript">migration.addColumn(
  'nameOfAnExistingTable',
  'nameOfTheNewAttribute',
  DataTypes.STRING
)
&nbsp;
// or
&nbsp;
migration.addColumn(
  'nameOfAnExistingTable',
  'nameOfTheNewAttribute',
  {
    type: DataTypes.STRING,
    allowNull: false
  }
)</code></pre><h4 id="functions-removecolumn">removeColumn(tableName, attributeName)</h4><p>This method allows deletion of a specific column of an existing table.</p><pre class="dark-blue"><code class="javascript">migration.removeColumn('Person', 'signature')</code></pre><h4 id="functions-changecolumn">changeColumn(tableName, attributeName, dataTypeOrOptions)</h4><p>This method changes the meta data of an attribute. It is possible to change the default value, allowance of null or the data type. Please make sure, that you are completely describing the new data type. Missing information are expected to be defaults.</p><pre class="dark-blue"><code class="javascript">migration.changeColumn(
  'nameOfAnExistingTable',
  'nameOfAnExistingAttribute',
  DataTypes.STRING
)
&nbsp;
// or
&nbsp;
migration.changeColumn(
  'nameOfAnExistingTable',
  'nameOfAnExistingAttribute',
  {
    type: DataTypes.FLOAT,
    allowNull: false,
    default: 0.0
  }
)</code></pre><h4 id="functions-renamecolumn">renameColumn(tableName, attrNameBefore, attrNameAfter)</h4><p>This methods allows renaming attributes.</p><pre class="dark-blue"><code class="javascript">migration.renameColumn('Person', 'signature', 'sig')</code></pre><h4 id="functions-addindex">addIndex(tableName, attributes, options)</h4><p>This methods creates indexes for specific attributes of a table. The index name will be automatically generated if it is not passed via in the options (see below).</p><pre class="dark-blue"><code class="javascript">// This example will create the index person_firstname_lastname
migration.addIndex('Person', ['firstname', 'lastname'])</code></pre><pre class="dark-blue"><code class="javascript">// This example will create a unique index with the name SuperDuperIndex using the optional 'options' field.
// Possible options:
// - indicesType: UNIQUE|FULLTEXT|SPATIAL
// - indexName: The name of the index. Default is <tablename>_<attrname1>_<attrname2>
// - parser: For FULLTEXT columns set your parser
// - indexType: Set a type for the index, e.g. BTREE. See the documentation of the used dialect
migration.addIndex(
  'Person',
  ['firstname', 'lastname'],
  {
    indexName: 'SuperDuperIndex',
    indicesType: 'UNIQUE'
  }
)</attrname2></attrname1></tablename></code></pre><h4 id="functions-removeindex">removeIndex(tableName, indexNameOrAttributes)</h4><p>This method deletes an existing index of a table.</p><pre class="dark-blue"><code class="javascript">migration.removeIndex('Person', 'SuperDuperIndex')
&nbsp;
// or
&nbsp;
migration.removeIndex('Person', ['firstname', 'lastname'])</code></pre><h3 id="programmatic-use">Programmatic use</h3><p>If you need to interact with the migrator within your code,
you can easily achieve that via <code>sequelize.getMigrator</code>.
You can specify the path to your migrations as well as a pattern
which represents the files that contain the migrations.</p><pre class="dark-blue"><code class="javascript">var migrator = sequelize.getMigrator({
  path:        process.cwd() + '/database/migrations',
  filesFilter: /\.coffee$/
})</code></pre><p>Once you have a migrator object, you can run its migration
with <code>migrator.migrate</code>. By default, this will
execute all the up methods within your pending migrations.
If you want to rollback a migration, just call it like this:</p><pre class="dark-blue"><code class="javascript">migrator
  .migrate({ method: 'down' })
  .success(function() {
    // The migrations have been executed!
  })</code></pre></div></section></div></div></div><div class="imprint very-dark-blue"><div class="container"><div class="col-sm-4">©
Sascha Depold,
<a href="https://github.com/sequelize/sequelize-doc/graphs/contributors" target="_blank" rel="nofollow">et al.</a>
2006 -&nbsp;2022</div><div style="text-align: right" class="col-sm-8"><a href="../../imprint.html">Imprint</a></div></div></div><script src="../../javascripts/bootstrap.min.js"></script><script src="../../javascripts/highlight.pack.js"></script><script src="../../javascripts/main.js"></script><script src="../../javascripts/documentation.js"></script><script type="text/javascript">(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','http://www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-9039631-4', 'sequelizejs.com');
ga('send', 'pageview');</script>

</body><!-- Mirrored from localhost:3000/docs/1.7.6/migrations by HTTrack Website Copier/3.x [XR&CO'2014], Sat, 19 Mar 2022 11:45:49 GMT --></html>