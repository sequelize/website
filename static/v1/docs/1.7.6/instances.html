<!DOCTYPE html><html><!-- Mirrored from localhost:3000/docs/1.7.6/instances by HTTrack Website Copier/3.x [XR&CO'2014], Sat, 19 Mar 2022 11:45:49 GMT --><!-- Added by HTTrack --><head><meta http-equiv="content-type" content="text/html;charset=utf-8"><!-- /Added by HTTrack -->
<title>Sequelize - Documentation - Instances</title><link rel="shortcut icon" type="image/x-icon" href="../../favicon.ico"><link rel="stylesheet" href="../../stylesheets/style.css"><script src="../../javascripts/jquery-1.10.2.min.js"></script><script>fromGithub = function (partialId, url) {
  var $partial = $("#" + partialId)

  $partial.load(url, function () {
    hljs.highlightBlock($partial.get(0));
  });
}</script><meta name="robots" content="noindex"></head><body id="documentation"><div role="navigation" class="navbar navbar-default navbar-fixed-top"><div class="container-liquid"><div class="col-sm-3 navbar-left"><section><a href="../../index.html" class="navbar-brand"><img src="../../images/logo-small.png"><span>Sequelize</span></a><div class="clearfix"></div></section></div><div class="col-sm-8 navbar-right"><section><button type="button" data-toggle="collapse" data-target=".navbar-collapse" class="navbar-toggle"><span class="sr-only">Toggle navigation</span><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></button><div class="navbar-collapse collapse"><ul class="nav navbar-nav"></ul><ul class="nav navbar-nav navbar-right"><li><a href="../../index.html"><span class="glyphicon glyphicon-home"></span><span class="spacer">&nbsp;</span><span class="text">Home</span></a></li><li class="active"><a href="../1.7.8/installation.html"><span class="glyphicon glyphicon-info-sign"></span><span class="spacer">&nbsp;</span><span class="text">Docs</span></a></li><li><a href="../../articles/getting-started.html"><span class="glyphicon glyphicon-book"></span><span class="spacer">&nbsp;</span><span class="text">Articles</span></a></li><li><a href="../../blog.html"><span class="glyphicon glyphicon-comment"></span><span class="spacer">&nbsp;</span><span class="text">Blog</span></a></li><li><a href="../../search.html" class="search"><i class="fa fa-search"></i><span class="spacer">&nbsp;</span><span class="text">Search</span></a></li></ul></div></section></div></div></div><div class="container-liquid"><div class="row documentation"><div class="col-sm-2 mid-blue sidebar"><div class="headline-spacer"></div><section class="navigation"><ul><li><a href="installation.html">Installation</a></li><li><a href="usage.html">Usage</a><ul><li><a href="usage.html#basics">Basic usage</a></li><li><a href="usage.html#options">Options</a></li><li><a href="usage.html#read-replication">Read replication</a></li><li><a href="usage.html#dialects">Dialects</a></li><li><a href="usage.html#raw-queries">Executing raw SQL queries</a></li></ul></li><li><a href="models.html">Models</a><ul><li><a href="models.html#definition">Definition</a></li><li><a href="models.html#data-types">Data types</a></li><li><a href="models.html#getters---setters">Getters &amp; setters</a></li><li><a href="models.html#validations">Validations</a></li><li><a href="models.html#configuration">Configuration</a></li><li><a href="models.html#import">Import</a></li><li><a href="models.html#database-synchronization">Database synchronization</a></li><li><a href="models.html#expansion-of-models">Expansion of models</a></li><li><a href="models.html#finders">Data retrieval / Finders</a></li><li><a href="models.html#eager-loading">Eager loading</a></li><li><a href="models.html#ordered-eager-loading">Ordering Eager Loaded Associations</a></li><li><a href="models.html#nested-eager-loading">Nested eager loading</a></li></ul></li><li class="active"><a href="instances.html">Instances</a><ul><li><a href="instances.html#build">Building a not-persistant instance</a></li><li><a href="instances.html#create">Creating persistant instances</a></li><li><a href="instances.html#update">Updating / Saving / Persisting an instance</a></li><li><a href="instances.html#destroy">Destroying / Deleting persistant instances</a></li><li><a href="instances.html#bulk">Working in bulk (updating multiple rows at once)</a></li><li><a href="instances.html#values">Values of an instance</a></li><li><a href="instances.html#reload">Reloading instances</a></li><li><a href="instances.html#increment">Incrementing certain values of an instance</a></li><li><a href="instances.html#decrement">Decrementing certain values of an instance</a></li></ul></li><li><a href="associations.html">Associations</a><ul><li><a href="associations.html#one-to-one">One-To-One associations</a></li><li><a href="associations.html#one-to-many">One-To-Many associations</a></li><li><a href="associations.html#many-to-many">Many-To-Many associations</a></li><li><a href="associations.html#associating-objects">Associating objects</a></li><li><a href="associations.html#check-associations">Check associations</a></li><li><a href="associations.html#foreign-keys">Foreign Keys</a></li></ul></li><li><a href="hooks.html">Hooks</a><ul><li><a href="hooks.html#order-of-operations">Order of Operations</a></li><li><a href="hooks.html#declaring-hooks">Declaring Hooks</a></li></ul></li><li><a href="transactions.html">Transactions</a></li><li><a href="migrations.html">Migrations</a><ul><li><a href="migrations.html#the-binary">The binary</a></li><li><a href="migrations.html#skeleton">Skeleton</a></li><li><a href="migrations.html#functions">Functions</a></li><li><a href="migrations.html#programmatic-use">Programmatic use</a></li></ul></li><li><a href="utils.html">Utils</a><ul><li><a href="utils.html#lodash-js">Lodash.js</a></li><li><a href="utils.html#querychainer">QueryChainer</a></li><li><a href="utils.html#custom-event-emitter">CustomEventEmitter</a></li></ul></li><li><a href="misc.html">Misc</a><ul><li><a href="misc.html#compatibility">Compatibility</a></li><li><a href="misc.html#asynchronicity">Asynchronicity</a></li><li><a href="misc.html#links(data-nav-value='Links')">Additional links</a></li><li><a href="misc.html#company---projects">Company &amp; Projects</a></li></ul></li><li><a>Versions</a><ul><li><a href="../latest/installation.html">Latest</a></li><li><a href="../1.7.8/installation.html">1.7.8</a></li><li><a href="installation.html">1.7.6</a></li><li><a href="../1.7.0-beta.1/installation.html">1.7.0-beta.1</a></li></ul></li></ul></section><div class="clearfix"></div></div><div class="col-sm-9 col-sm-offset-1 beige content"><section><div><h2>Instances</h2><h3 id="build">Building a not-persistant instance</h3><p>In order to create instances of defined classes just do as follows. You might recognize the syntax if you coded Ruby in the past. Using the<code>build</code>-method will return an unsaved object, which you explicitly have to save.</p><pre class="dark-blue"><code class="javascript">var project = Project.build({
  title: 'my awesome project',
  description: 'woot woot. this will make me a rich man'
})
&nbsp;
var task = Task.build({
  title: 'specify the project idea',
  description: 'bla',
  deadline: new Date()
})</code></pre><p>Built instances will automatically get default values when they were defined:</p><pre class="dark-blue"><code class="javascript">// first define the model
var Task = sequelize.define('Project', {
  title: Sequelize.STRING,
  rating: { type: Sequelize.STRING, defaultValue: 3 }
})
&nbsp;
// now instantiate an object
var task = Task.build({title: 'very important task'})
&nbsp;
task.title  // ==&gt; 'very important task'
task.rating // ==&gt; 3</code></pre><p>To get it stored in the database, use the<code>save</code>-method and catch the events … if needed:</p><pre class="dark-blue"><code class="javascript">project.save().success(function() {
  // my nice callback stuff
})
&nbsp;
task.save().error(function(error) {
  // mhhh, wth!
})
&nbsp;
// you can also build, save and access the object with chaining:
Task
  .build({ title: 'foo', description: 'bar', deadline: new Date() })
  .save()
  .success(function(anotherTask) {
    // you can now access the currently saved task with the variable anotherTask... nice!
  }).error(function(error) {
    // Ooops, do some error-handling
  })</code></pre><h3 id="create">Creating persistant instances</h3><p>Besides constructing objects, that needs an explicit save call to get stored in the database, there is also the possibility to do all those steps with one single command. It's called<code>create</code>.</p><pre class="dark-blue"><code class="javascript">Task.create({ title: 'foo', description: 'bar', deadline: new Date() }).success(function(task) {
  // you can now access the newly created task via the variable task
})</code></pre><p>Sequelize<code>v1.5.0</code>introduced the possibility to define attributes which can be set via the create method. This can be especially very handy if you create database entries based on a form which can be filled by a user. Using that would for example allow you to restrict the<code>User</code>model to set only a username and an address but not an admin flag:</p><pre class="dark-blue"><code class="javascript">User.create({ username: 'barfooz', isAdmin: true }, [ 'username' ]).success(function(user) {
  // let's assume the default of isAdmin is false:
  console.log(user.values) // =&gt; { username: 'barfooz', isAdmin: false }
})</code></pre><h3 id="update">Updating / Saving / Persisting an instance</h3><p>Now lets change some values and save changes to the database... There are two ways to do that:</p><pre class="dark-blue"><code class="javascript">// way 1
task.title = 'a very different title now'
task.save().success(function() {})
&nbsp;
// way 2
task.updateAttributes({
  title: 'a very different title now'
}).success(function() {})</code></pre><p>Since<code>v1.4.1</code>it's also possible to define which attributes should be saved when calling<code>save</code>, by passing an array of column names. This is useful when you set attributes based on a previously defined object. E.g. if you get the values of an object via a form of a web app. Furthermore this is used internally for<code>updateAttributes</code>. This is how it looks like:</p><pre class="dark-blue"><code class="javascript">task.title = 'foooo'
task.description = 'baaaaaar'
task.save(['title']).success(function() {
 // title will now be 'foooo' but description is the very same as before
})
&nbsp;
// The equivalent call using updateAttributes looks like this:
task.updateAttributes({ title: 'foooo', description: 'baaaaaar'}, ['title']).success(function() {
 // title will now be 'foooo' but description is the very same as before
})</code></pre><h3 id="destroy">Destroying / Deleting persistant instances</h3><p>Once you created an object and got a reference to it, you can delete it from the database. The relevant method is<code>destroy</code>:</p><pre class="dark-blue"><code class="javascript">Task.create({ title: 'a task' }).success(function(task) {
  // now you see me...
&nbsp;
  task.destroy().success(function() {
    // now i'm gone :)
  })
})</code></pre><h3 id="bulk">Working in bulk (updating multiple rows at once)</h3><p>In addition to updating a single instance, you can also create, update, and delete multiple instances at once. The functions you are looking for are called</p><ul><li> <code>Model.bulkCreate</code></li><li> <code>Model.update</code></li><li> <code>Model.destroy</code></li></ul><p></p><p>Since you are working with multiple models, the callbacks will not return DAO instances. BulkCreate will return an array of model instances/DAOs, they will however, unlike <code>create</code>, not have the resulting values of autoIncrement attributes. <code>update </code>and <code>destroy</code>will return the number of affected rows.</p><p>First lets look at bulkCreate</p><pre class="dark-blue"><code class="javascript">User.bulkCreate([
  { username: 'barfooz', isAdmin: true },
  { username: 'foo', isAdmin: true },
  { username: 'bar', isAdmin: false }
]).success(function() { // Notice: There are no arguments here, as of right now you'll have to...
  User.findAll().success(function(users) {
    console.log(users) // ... in order to get the array of user objects
  })
})</code></pre><p>To update several rows at once:</p><pre class="dark-blue"><code class="javascript">Task.bulkCreate([
  {subject: 'programming', status: 'executing'},
  {subject: 'reading', status: 'executing'},
  {subject: 'programming', status: 'finished'}
]).success(function() {
  Task.update(
    {status: 'inactive'} /* set attributes' value */, 
    {subject: 'programming'} /* where criteria */
  ).success(function(affectedRows) {
    // affectedRows will be 2
    Task.findAll().success(function(tasks) {
      console.log(tasks) // the 'programming' tasks will both have a status of 'inactive'
    })
  })
})</code></pre><p>And delete them:</p><pre class="dark-blue"><code class="javascript">Task.bulkCreate([
  {subject: 'programming', status: 'executing'},
  {subject: 'reading', status: 'executing'},
  {subject: 'programming', status: 'finished'}
]).success(function() {
  Task.destroy(
    {subject: 'programming'} /* where criteria */,
    {truncate: true /* truncate the whole table, ignoring where criteria */} /* options */
  ).success(function(affectedRows) {
    // affectedRows will be 2
    Task.findAll().success(function(tasks) {
      console.log(tasks) // no programming, just reading :(
    })
  })
})</code></pre><p>If you are accepting values directly from the user, it might be beneficial to limit the columns that you want to actually insert.<code>bulkCreate()</code>accepts a second parameter (an array) to let it know which fields you want to build explicitly</p><pre class="dark-blue"><code class="javascript">User.bulkCreate([
  { username: 'foo' },
  { username: 'bar', admin: true}
], ['username']).success(function() {
  // nope bar, you can't be admin! 
})
&nbsp;
// an easier way to keep track of which fields you want to explicitly build, use Object.keys() like so
var objects = [
  { username: 'foo' },
  { username: 'bar' }
]
&nbsp;
User.bulkCreate(objects, Object.keys(objects)).success(function() {
  // ...
})</code></pre><p><code>bulkCreate()</code>was originally made to be a mainstream/fast way of inserting records, however, sometimes you want the luxury of being able to insert multiple rows at once without sacrificing model validations even when you explicitly tell Sequelize which columns to sift through. You can do by adding a third parameter of an object with the value of<code>{validate: true}</code></p><pre class="dark-blue"><code class="javascript">var Tasks = sequelize.define('Task', {
  name: {
    type: Sequelize.STRING,
    validate: {
      notNull: { args: true, msg: 'name cannot be null' }
    }
  },
  code: {
    type: Sequelize.STRING,
    validate: {
      len: [3, 10]
    }
  }
})
&nbsp;
Tasks.bulkCreate([
  {name: 'foo', code: '123'},
  {code: '1234'},
  {name: 'bar', code: '1'}
], null, {validate: true}).error(function(errors) {
  /* console.log(errors) would look like:
  [
    {
      "record": {
        "code": "1234"
      },
      "errors": {
        "name": [
          "name cannot be null"
        ]
      }
    },
    {
      "record": {
        "name": "bar",
        "code": "1"
      },
      "errors": {
        "code": [
          "String is not in range: code"
        ]
      }
    }
  ]
  */
})</code></pre><h3 id="values">Values of an instance</h3><p>If you log an instance you will notice, that there is a lot of additional stuff. In order to hide such stuff and reduce it to the very interesting information, you can use the<code>values</code>-attribute. Calling it will return only the values of an instance.</p><pre class="dark-blue"><code class="javascript">Person.create({
  name: 'Rambow',
  firstname: 'John'
}).success(function(john) {
  console.log(john.values)
})
&nbsp;
// result:
&nbsp;
// { name: 'Rambow',
//   firstname: 'John',
//   id: 1,
//   createdAt: Tue, 01 May 2012 19:12:16 GMT,
//   updatedAt: Tue, 01 May 2012 19:12:16 GMT
// }</code></pre><p><strong>Hint:</strong>You can also transform an instance into JSON by using<code>JSON.stringify(instance)</code>. This will basically return the very same as<code>values</code>.</p><h3 id="reload">Reloading instances</h3><p>If you need to get your instance in sync, you can use the method<code>reload</code>. It will fetch the current data from the database and overwrite the attributes of the model on which the method has been called on.</p><pre class="dark-blue"><code class="javascript">Person.find({ where: { name: 'john' } }).success(function(person) {
  person.name = 'jane'
  console.log(person.name) // 'jane'
&nbsp;
  person.reload().success(function() {
    console.log(person.name) // 'john'
  })
})</code></pre><h3 id="increment">Incrementing certain values of an instance</h3><p>In order to increment values of an instance without running into concurrency issues, you may use<code>increment</code>.</p><p>First of all you can define a field and the value you want to add to it.</p><pre class="dark-blue"><code class="javascript">User.find(1).success(function(user) {
  user.increment('my-integer-field', 2).success(/* ... */)
})</code></pre><p>Second, you can define multiple fields and the value you want to add to them.</p><pre class="dark-blue"><code class="javascript">User.find(1).success(function(user) {
  user.increment([ 'my-integer-field', 'my-very-other-field' ], 2).success(/* ... */)
})</code></pre><p>Third, you can define an object containing fields and its increment values.</p><pre class="dark-blue"><code class="javascript">User.find(1).success(function(user) {
  user.increment({
    'my-integer-field':    2,
    'my-very-other-field': 3
  }).success(/* ... */)
})</code></pre><h3 id="decrement">Decrementing certain values of an instance</h3><p>In order to decrement values of an instance without running into concurrency issues, you may use<code>decrement</code>.</p><p>First of all you can define a field and the value you want to add to it.</p><pre class="dark-blue"><code class="javascript">User.find(1).success(function(user) {
  user.decrement('my-integer-field', 2).success(/* ... */)
})</code></pre><p>Second, you can define multiple fields and the value you want to add to them.</p><pre class="dark-blue"><code class="javascript">User.find(1).success(function(user) {
  user.decrement([ 'my-integer-field', 'my-very-other-field' ], 2).success(/* ... */)
})</code></pre><p>Third, you can define an object containing fields and its decrement values.</p><pre class="dark-blue"><code class="javascript">User.find(1).success(function(user) {
  user.decrement({
    'my-integer-field':    2,
    'my-very-other-field': 3
  }).success(/* ... */)
})</code></pre></div></section></div></div></div><div class="imprint very-dark-blue"><div class="container"><div class="col-sm-4">©
Sascha Depold,
<a href="https://github.com/sequelize/sequelize-doc/graphs/contributors" target="_blank" rel="nofollow">et al.</a>
2006 -&nbsp;2022</div><div style="text-align: right" class="col-sm-8"><a href="../../imprint.html">Imprint</a></div></div></div><script src="../../javascripts/bootstrap.min.js"></script><script src="../../javascripts/highlight.pack.js"></script><script src="../../javascripts/main.js"></script><script src="../../javascripts/documentation.js"></script><script type="text/javascript">(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','http://www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-9039631-4', 'sequelizejs.com');
ga('send', 'pageview');</script>

</body><!-- Mirrored from localhost:3000/docs/1.7.6/instances by HTTrack Website Copier/3.x [XR&CO'2014], Sat, 19 Mar 2022 11:45:49 GMT --></html>