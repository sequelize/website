<!DOCTYPE html><html><head>
  <meta charset="utf-8">
  <base data-ice="baseUrl" href="/v4/./">
  <title data-ice="title">Manual |  Sequelize | The node.js ORM for PostgreSQL, MySQL, SQLite and MSSQL</title>
  <link type="text/css" rel="stylesheet" href="/v4/css/style.css">
  <link type="text/css" rel="stylesheet" href="/v4/css/prettify-tomorrow.css">
  <script src="/v4/script/prettify/prettify.js"></script>
  
  
  <script src="/v4/script/manual.js"></script>
<script data-ice="userScript" src="/v4/user/script/0-script.js"></script>
<link data-ice="userStyle" rel="stylesheet" href="/v4/user/css/0-style.css">
<link data-ice="userStyle" rel="stylesheet" href="/v4/user/css/1-theme.css">
<link rel="shortcut icon" type="image/x-icon" href="/v4/favicon.ico"><meta name="robots" content="noindex"></head>
<body class="layout-container manual-root manual-index" data-ice="rootContainer">

<header><a href="/v4/"><img src="/v4/manual/asset/logo-small.png" class="header-logo"></a>
  <a href="/v4/./">Home</a>
  
  <a href="/v4/identifiers.html">Reference</a>
  <a href="/v4/source.html">Source</a>
  
  <a data-ice="repoURL" href="https://github.com/sequelize/sequelize.git" class="repo-url-github">Repository</a><a href="http://sequelize-slack.herokuapp.com/" class="slack-link"><img class="slack-logo" src="/v4/manual/asset/slack.svg">Join us on Slack</a>
  <div class="search-box">
  <span>
    <img src="/v4/./image/search.png">
    <span class="search-input-edge"></span><input class="search-input"><span class="search-input-edge"></span>
  </span>
    <ul class="search-result"></ul>
  </div>
</header>

<nav class="navigation" data-ice="nav"><div class="manual-toc-root">
  
<div data-ice="manual" data-toc-name="installation">
    <ul class="manual-toc">
      
    <li data-ice="manualNav" class="indent-h1 manual-color manual-color-installation" data-section-count="■■" data-link="manual/installation/getting-started.html"><a href="/v4/manual/installation/getting-started.html" data-ice="link">Getting started</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/installation/getting-started.html"><a href="/v4/manual/installation/getting-started.html#installation" data-ice="link">Installation</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/installation/getting-started.html"><a href="/v4/manual/installation/getting-started.html#setting-up-a-connection" data-ice="link">Setting up a connection</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/installation/getting-started.html"><a href="/v4/manual/installation/getting-started.html#test-the-connection" data-ice="link">Test the connection</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/installation/getting-started.html"><a href="/v4/manual/installation/getting-started.html#your-first-model" data-ice="link">Your first model</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/installation/getting-started.html"><a href="/v4/manual/installation/getting-started.html#your-first-query" data-ice="link">Your first query</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/installation/getting-started.html"><a href="/v4/manual/installation/getting-started.html#application-wide-model-options" data-ice="link">Application wide model options</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/installation/getting-started.html"><a href="/v4/manual/installation/getting-started.html#promises" data-ice="link">Promises</a></li>
<li data-ice="manualNav" class="indent-h1 manual-color manual-color-installation" data-section-count="■■" data-link="manual/installation/usage.html"><a href="/v4/manual/installation/usage.html" data-ice="link">Basic usage</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/installation/usage.html"><a href="/v4/manual/installation/usage.html#options" data-ice="link">Options</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/installation/usage.html"><a href="/v4/manual/installation/usage.html#read-replication" data-ice="link">Read replication</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/installation/usage.html"><a href="/v4/manual/installation/usage.html#dialects" data-ice="link">Dialects</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/installation/usage.html"><a href="/v4/manual/installation/usage.html#mysql" data-ice="link">MySQL</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/installation/usage.html"><a href="/v4/manual/installation/usage.html#sqlite" data-ice="link">SQLite</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/installation/usage.html"><a href="/v4/manual/installation/usage.html#postgresql" data-ice="link">PostgreSQL</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/installation/usage.html"><a href="/v4/manual/installation/usage.html#mssql" data-ice="link">MSSQL</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/installation/usage.html"><a href="/v4/manual/installation/usage.html#executing-raw-sql-queries" data-ice="link">Executing raw SQL queries</a></li>
</ul>
  </div>
<div data-ice="manual" data-toc-name="tutorial">
    <ul class="manual-toc">
      
    <li data-ice="manualNav" class="indent-h1 manual-color manual-color-tutorial" data-section-count="■■■■" data-link="manual/tutorial/models-definition.html"><a href="/v4/manual/tutorial/models-definition.html" data-ice="link">Model definition</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/tutorial/models-definition.html"><a href="/v4/manual/tutorial/models-definition.html#timestamps" data-ice="link">Timestamps</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/tutorial/models-definition.html"><a href="/v4/manual/tutorial/models-definition.html#data-types" data-ice="link">Data types</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/tutorial/models-definition.html"><a href="/v4/manual/tutorial/models-definition.html#array-enum-" data-ice="link">Array(ENUM)</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/tutorial/models-definition.html"><a href="/v4/manual/tutorial/models-definition.html#range-types" data-ice="link">Range types</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/tutorial/models-definition.html"><a href="/v4/manual/tutorial/models-definition.html#deferrable" data-ice="link">Deferrable</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/tutorial/models-definition.html"><a href="/v4/manual/tutorial/models-definition.html#getters-setters" data-ice="link">Getters &amp; setters</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/tutorial/models-definition.html"><a href="/v4/manual/tutorial/models-definition.html#defining-as-part-of-a-property" data-ice="link">Defining as part of a property</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/tutorial/models-definition.html"><a href="/v4/manual/tutorial/models-definition.html#defining-as-part-of-the-model-options" data-ice="link">Defining as part of the model options</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/tutorial/models-definition.html"><a href="/v4/manual/tutorial/models-definition.html#helper-functions-for-use-inside-getter-and-setter-definitions" data-ice="link">Helper functions for use inside getter and setter definitions</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/tutorial/models-definition.html"><a href="/v4/manual/tutorial/models-definition.html#validations" data-ice="link">Validations</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/tutorial/models-definition.html"><a href="/v4/manual/tutorial/models-definition.html#validators-and-allownull-" data-ice="link">Validators and allowNull</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/tutorial/models-definition.html"><a href="/v4/manual/tutorial/models-definition.html#model-validations" data-ice="link">Model validations</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/tutorial/models-definition.html"><a href="/v4/manual/tutorial/models-definition.html#configuration" data-ice="link">Configuration</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/tutorial/models-definition.html"><a href="/v4/manual/tutorial/models-definition.html#import" data-ice="link">Import</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/tutorial/models-definition.html"><a href="/v4/manual/tutorial/models-definition.html#optimistic-locking" data-ice="link">Optimistic Locking</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/tutorial/models-definition.html"><a href="/v4/manual/tutorial/models-definition.html#database-synchronization" data-ice="link">Database synchronization</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/tutorial/models-definition.html"><a href="/v4/manual/tutorial/models-definition.html#expansion-of-models" data-ice="link">Expansion of models</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/tutorial/models-definition.html"><a href="/v4/manual/tutorial/models-definition.html#indexes" data-ice="link">Indexes</a></li>
<li data-ice="manualNav" class="indent-h1 manual-color manual-color-tutorial" data-section-count="■■■■" data-link="manual/tutorial/models-usage.html"><a href="/v4/manual/tutorial/models-usage.html" data-ice="link">Model usage</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/tutorial/models-usage.html"><a href="/v4/manual/tutorial/models-usage.html#data-retrieval-finders" data-ice="link">Data retrieval / Finders</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/tutorial/models-usage.html"><a href="/v4/manual/tutorial/models-usage.html#-find-search-for-one-specific-element-in-the-database" data-ice="link">find - Search for one specific element in the database</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/tutorial/models-usage.html"><a href="/v4/manual/tutorial/models-usage.html#-findorcreate-search-for-a-specific-element-or-create-it-if-not-available" data-ice="link">findOrCreate - Search for a specific element or create it if not available</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/tutorial/models-usage.html"><a href="/v4/manual/tutorial/models-usage.html#-findandcountall-search-for-multiple-elements-in-the-database-returns-both-data-and-total-count" data-ice="link">findAndCountAll - Search for multiple elements in the database, returns both data and total count</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/tutorial/models-usage.html"><a href="/v4/manual/tutorial/models-usage.html#-findall-search-for-multiple-elements-in-the-database" data-ice="link">findAll - Search for multiple elements in the database</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/tutorial/models-usage.html"><a href="/v4/manual/tutorial/models-usage.html#complex-filtering-or-not-queries" data-ice="link">Complex filtering / OR / NOT queries</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/tutorial/models-usage.html"><a href="/v4/manual/tutorial/models-usage.html#manipulating-the-dataset-with-limit-offset-order-and-group" data-ice="link">Manipulating the dataset with limit, offset, order and group</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/tutorial/models-usage.html"><a href="/v4/manual/tutorial/models-usage.html#raw-queries" data-ice="link">Raw queries</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/tutorial/models-usage.html"><a href="/v4/manual/tutorial/models-usage.html#-count-count-the-occurrences-of-elements-in-the-database" data-ice="link">count - Count the occurrences of elements in the database</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/tutorial/models-usage.html"><a href="/v4/manual/tutorial/models-usage.html#-max-get-the-greatest-value-of-a-specific-attribute-within-a-specific-table" data-ice="link">max - Get the greatest value of a specific attribute within a specific table</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/tutorial/models-usage.html"><a href="/v4/manual/tutorial/models-usage.html#-min-get-the-least-value-of-a-specific-attribute-within-a-specific-table" data-ice="link">min - Get the least value of a specific attribute within a specific table</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/tutorial/models-usage.html"><a href="/v4/manual/tutorial/models-usage.html#-sum-sum-the-value-of-specific-attributes" data-ice="link">sum - Sum the value of specific attributes</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/tutorial/models-usage.html"><a href="/v4/manual/tutorial/models-usage.html#eager-loading" data-ice="link">Eager loading</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/tutorial/models-usage.html"><a href="/v4/manual/tutorial/models-usage.html#top-level-where-with-eagerly-loaded-models" data-ice="link">Top level where with eagerly loaded models</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/tutorial/models-usage.html"><a href="/v4/manual/tutorial/models-usage.html#including-everything" data-ice="link">Including everything</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/tutorial/models-usage.html"><a href="/v4/manual/tutorial/models-usage.html#including-soft-deleted-records" data-ice="link">Including soft deleted records</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/tutorial/models-usage.html"><a href="/v4/manual/tutorial/models-usage.html#ordering-eager-loaded-associations" data-ice="link">Ordering Eager Loaded Associations</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/tutorial/models-usage.html"><a href="/v4/manual/tutorial/models-usage.html#nested-eager-loading" data-ice="link">Nested eager loading</a></li>
<li data-ice="manualNav" class="indent-h1 manual-color manual-color-tutorial" data-section-count="■■■■■" data-link="manual/tutorial/querying.html"><a href="/v4/manual/tutorial/querying.html" data-ice="link">Querying</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/tutorial/querying.html"><a href="/v4/manual/tutorial/querying.html#attributes" data-ice="link">Attributes</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/tutorial/querying.html"><a href="/v4/manual/tutorial/querying.html#where" data-ice="link">Where</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/tutorial/querying.html"><a href="/v4/manual/tutorial/querying.html#basics" data-ice="link">Basics</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/tutorial/querying.html"><a href="/v4/manual/tutorial/querying.html#operators" data-ice="link">Operators</a></li>
<li data-ice="manualNav" class="indent-h4" data-link="manual/tutorial/querying.html"><a href="/v4/manual/tutorial/querying.html#range-operators" data-ice="link">Range Operators</a></li>
<li data-ice="manualNav" class="indent-h4" data-link="manual/tutorial/querying.html"><a href="/v4/manual/tutorial/querying.html#combinations" data-ice="link">Combinations</a></li>
<li data-ice="manualNav" class="indent-h4" data-link="manual/tutorial/querying.html"><a href="/v4/manual/tutorial/querying.html#operators-aliases" data-ice="link">Operators Aliases</a></li>
<li data-ice="manualNav" class="indent-h4" data-link="manual/tutorial/querying.html"><a href="/v4/manual/tutorial/querying.html#operators-security" data-ice="link">Operators security</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/tutorial/querying.html"><a href="/v4/manual/tutorial/querying.html#json" data-ice="link">JSON</a></li>
<li data-ice="manualNav" class="indent-h4" data-link="manual/tutorial/querying.html"><a href="/v4/manual/tutorial/querying.html#postgresql" data-ice="link">PostgreSQL</a></li>
<li data-ice="manualNav" class="indent-h4" data-link="manual/tutorial/querying.html"><a href="/v4/manual/tutorial/querying.html#mssql" data-ice="link">MSSQL</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/tutorial/querying.html"><a href="/v4/manual/tutorial/querying.html#jsonb" data-ice="link">JSONB</a></li>
<li data-ice="manualNav" class="indent-h4" data-link="manual/tutorial/querying.html"><a href="/v4/manual/tutorial/querying.html#nested-object" data-ice="link">Nested object</a></li>
<li data-ice="manualNav" class="indent-h4" data-link="manual/tutorial/querying.html"><a href="/v4/manual/tutorial/querying.html#nested-key" data-ice="link">Nested key</a></li>
<li data-ice="manualNav" class="indent-h4" data-link="manual/tutorial/querying.html"><a href="/v4/manual/tutorial/querying.html#containment" data-ice="link">Containment</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/tutorial/querying.html"><a href="/v4/manual/tutorial/querying.html#relations-associations" data-ice="link">Relations / Associations</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/tutorial/querying.html"><a href="/v4/manual/tutorial/querying.html#pagination-limiting" data-ice="link">Pagination / Limiting</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/tutorial/querying.html"><a href="/v4/manual/tutorial/querying.html#ordering" data-ice="link">Ordering</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/tutorial/querying.html"><a href="/v4/manual/tutorial/querying.html#table-hint" data-ice="link">Table Hint</a></li>
<li data-ice="manualNav" class="indent-h1 manual-color manual-color-tutorial" data-section-count="■■■" data-link="manual/tutorial/instances.html"><a href="/v4/manual/tutorial/instances.html" data-ice="link">Instances</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/tutorial/instances.html"><a href="/v4/manual/tutorial/instances.html#building-a-non-persistent-instance" data-ice="link">Building a non-persistent instance</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/tutorial/instances.html"><a href="/v4/manual/tutorial/instances.html#creating-persistent-instances" data-ice="link">Creating persistent instances</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/tutorial/instances.html"><a href="/v4/manual/tutorial/instances.html#updating-saving-persisting-an-instance" data-ice="link">Updating / Saving / Persisting an instance</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/tutorial/instances.html"><a href="/v4/manual/tutorial/instances.html#destroying-deleting-persistent-instances" data-ice="link">Destroying / Deleting persistent instances</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/tutorial/instances.html"><a href="/v4/manual/tutorial/instances.html#working-in-bulk-creating-updating-and-destroying-multiple-rows-at-once-" data-ice="link">Working in bulk (creating, updating and destroying multiple rows at once)</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/tutorial/instances.html"><a href="/v4/manual/tutorial/instances.html#values-of-an-instance" data-ice="link">Values of an instance</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/tutorial/instances.html"><a href="/v4/manual/tutorial/instances.html#reloading-instances" data-ice="link">Reloading instances</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/tutorial/instances.html"><a href="/v4/manual/tutorial/instances.html#incrementing" data-ice="link">Incrementing</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/tutorial/instances.html"><a href="/v4/manual/tutorial/instances.html#decrementing" data-ice="link">Decrementing</a></li>
<li data-ice="manualNav" class="indent-h1 manual-color manual-color-tutorial" data-section-count="■■■■■" data-link="manual/tutorial/associations.html"><a href="/v4/manual/tutorial/associations.html" data-ice="link">Associations</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/tutorial/associations.html"><a href="/v4/manual/tutorial/associations.html#one-to-one-associations" data-ice="link">One-To-One associations</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/tutorial/associations.html"><a href="/v4/manual/tutorial/associations.html#belongsto" data-ice="link">BelongsTo</a></li>
<li data-ice="manualNav" class="indent-h4" data-link="manual/tutorial/associations.html"><a href="/v4/manual/tutorial/associations.html#foreign-keys" data-ice="link">Foreign keys</a></li>
<li data-ice="manualNav" class="indent-h4" data-link="manual/tutorial/associations.html"><a href="/v4/manual/tutorial/associations.html#target-keys" data-ice="link">Target keys</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/tutorial/associations.html"><a href="/v4/manual/tutorial/associations.html#hasone" data-ice="link">HasOne</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/tutorial/associations.html"><a href="/v4/manual/tutorial/associations.html#difference-between-hasone-and-belongsto" data-ice="link">Difference between HasOne and BelongsTo</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/tutorial/associations.html"><a href="/v4/manual/tutorial/associations.html#one-to-many-associations-hasmany-" data-ice="link">One-To-Many associations (hasMany)</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/tutorial/associations.html"><a href="/v4/manual/tutorial/associations.html#belongs-to-many-associations" data-ice="link">Belongs-To-Many associations</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/tutorial/associations.html"><a href="/v4/manual/tutorial/associations.html#scopes" data-ice="link">Scopes</a></li>
<li data-ice="manualNav" class="indent-h4" data-link="manual/tutorial/associations.html"><a href="/v4/manual/tutorial/associations.html#1-m" data-ice="link">1:m</a></li>
<li data-ice="manualNav" class="indent-h4" data-link="manual/tutorial/associations.html"><a href="/v4/manual/tutorial/associations.html#n-m" data-ice="link">n:m</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/tutorial/associations.html"><a href="/v4/manual/tutorial/associations.html#naming-strategy" data-ice="link">Naming strategy</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/tutorial/associations.html"><a href="/v4/manual/tutorial/associations.html#associating-objects" data-ice="link">Associating objects</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/tutorial/associations.html"><a href="/v4/manual/tutorial/associations.html#check-associations" data-ice="link">Check associations</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/tutorial/associations.html"><a href="/v4/manual/tutorial/associations.html#foreign-keys" data-ice="link">Foreign Keys</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/tutorial/associations.html"><a href="/v4/manual/tutorial/associations.html#enforcing-a-foreign-key-reference-without-constraints" data-ice="link">Enforcing a foreign key reference without constraints</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/tutorial/associations.html"><a href="/v4/manual/tutorial/associations.html#creating-with-associations" data-ice="link">Creating with associations</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/tutorial/associations.html"><a href="/v4/manual/tutorial/associations.html#creating-elements-of-a-belongsto-has-many-or-hasone-association" data-ice="link">Creating elements of a "BelongsTo", "Has Many" or "HasOne" association</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/tutorial/associations.html"><a href="/v4/manual/tutorial/associations.html#creating-elements-of-a-belongsto-association-with-an-alias" data-ice="link">Creating elements of a "BelongsTo" association with an alias</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/tutorial/associations.html"><a href="/v4/manual/tutorial/associations.html#creating-elements-of-a-hasmany-or-belongstomany-association" data-ice="link">Creating elements of a "HasMany" or "BelongsToMany" association</a></li>
<li data-ice="manualNav" class="indent-h1 manual-color manual-color-tutorial" data-section-count="■■■" data-link="manual/tutorial/transactions.html"><a href="/v4/manual/tutorial/transactions.html" data-ice="link">Transactions</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/tutorial/transactions.html"><a href="/v4/manual/tutorial/transactions.html#managed-transaction-auto-callback-" data-ice="link">Managed transaction (auto-callback)</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/tutorial/transactions.html"><a href="/v4/manual/tutorial/transactions.html#throw-errors-to-rollback" data-ice="link">Throw errors to rollback</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/tutorial/transactions.html"><a href="/v4/manual/tutorial/transactions.html#automatically-pass-transactions-to-all-queries" data-ice="link">Automatically pass transactions to all queries</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/tutorial/transactions.html"><a href="/v4/manual/tutorial/transactions.html#concurrent-partial-transactions" data-ice="link">Concurrent/Partial transactions</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/tutorial/transactions.html"><a href="/v4/manual/tutorial/transactions.html#without-cls-enabled" data-ice="link">Without CLS enabled</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/tutorial/transactions.html"><a href="/v4/manual/tutorial/transactions.html#isolation-levels" data-ice="link">Isolation levels</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/tutorial/transactions.html"><a href="/v4/manual/tutorial/transactions.html#unmanaged-transaction-then-callback-" data-ice="link">Unmanaged transaction (then-callback)</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/tutorial/transactions.html"><a href="/v4/manual/tutorial/transactions.html#options" data-ice="link">Options</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/tutorial/transactions.html"><a href="/v4/manual/tutorial/transactions.html#usage-with-other-sequelize-methods" data-ice="link">Usage with other sequelize methods</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/tutorial/transactions.html"><a href="/v4/manual/tutorial/transactions.html#after-commit-hook" data-ice="link">After commit hook</a></li>
<li data-ice="manualNav" class="indent-h1 manual-color manual-color-tutorial" data-section-count="■■" data-link="manual/tutorial/scopes.html"><a href="/v4/manual/tutorial/scopes.html" data-ice="link">Scopes</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/tutorial/scopes.html"><a href="/v4/manual/tutorial/scopes.html#definition" data-ice="link">Definition</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/tutorial/scopes.html"><a href="/v4/manual/tutorial/scopes.html#usage" data-ice="link">Usage</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/tutorial/scopes.html"><a href="/v4/manual/tutorial/scopes.html#merging" data-ice="link">Merging</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/tutorial/scopes.html"><a href="/v4/manual/tutorial/scopes.html#associations" data-ice="link">Associations</a></li>
<li data-ice="manualNav" class="indent-h1 manual-color manual-color-tutorial" data-section-count="■■■" data-link="manual/tutorial/hooks.html"><a href="/v4/manual/tutorial/hooks.html" data-ice="link">Hooks</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/tutorial/hooks.html"><a href="/v4/manual/tutorial/hooks.html#order-of-operations" data-ice="link">Order of Operations</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/tutorial/hooks.html"><a href="/v4/manual/tutorial/hooks.html#declaring-hooks" data-ice="link">Declaring Hooks</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/tutorial/hooks.html"><a href="/v4/manual/tutorial/hooks.html#removing-hooks" data-ice="link">Removing hooks</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/tutorial/hooks.html"><a href="/v4/manual/tutorial/hooks.html#global-universal-hooks" data-ice="link">Global / universal hooks</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/tutorial/hooks.html"><a href="/v4/manual/tutorial/hooks.html#sequelize-options-define-default-hook-" data-ice="link">Sequelize.options.define (default hook)</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/tutorial/hooks.html"><a href="/v4/manual/tutorial/hooks.html#sequelize-addhook-permanent-hook-" data-ice="link">Sequelize.addHook (permanent hook)</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/tutorial/hooks.html"><a href="/v4/manual/tutorial/hooks.html#instance-hooks" data-ice="link">Instance hooks</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/tutorial/hooks.html"><a href="/v4/manual/tutorial/hooks.html#model-hooks" data-ice="link">Model hooks</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/tutorial/hooks.html"><a href="/v4/manual/tutorial/hooks.html#associations" data-ice="link">Associations</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/tutorial/hooks.html"><a href="/v4/manual/tutorial/hooks.html#a-note-about-transactions" data-ice="link">A Note About Transactions</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/tutorial/hooks.html"><a href="/v4/manual/tutorial/hooks.html#internal-transactions" data-ice="link">Internal Transactions</a></li>
<li data-ice="manualNav" class="indent-h1 manual-color manual-color-tutorial" data-section-count="■" data-link="manual/tutorial/raw-queries.html"><a href="/v4/manual/tutorial/raw-queries.html" data-ice="link">Raw queries</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/tutorial/raw-queries.html"><a href="/v4/manual/tutorial/raw-queries.html#replacements" data-ice="link">Replacements</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/tutorial/raw-queries.html"><a href="/v4/manual/tutorial/raw-queries.html#bind-parameter" data-ice="link">Bind Parameter</a></li>
<li data-ice="manualNav" class="indent-h1 manual-color manual-color-tutorial" data-section-count="■■■■■" data-link="manual/tutorial/migrations.html"><a href="/v4/manual/tutorial/migrations.html" data-ice="link">Migrations</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/tutorial/migrations.html"><a href="/v4/manual/tutorial/migrations.html#the-cli" data-ice="link">The CLI</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/tutorial/migrations.html"><a href="/v4/manual/tutorial/migrations.html#installing-cli" data-ice="link">Installing CLI</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/tutorial/migrations.html"><a href="/v4/manual/tutorial/migrations.html#bootstrapping" data-ice="link">Bootstrapping</a></li>
<li data-ice="manualNav" class="indent-h4" data-link="manual/tutorial/migrations.html"><a href="/v4/manual/tutorial/migrations.html#configuration" data-ice="link">Configuration</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/tutorial/migrations.html"><a href="/v4/manual/tutorial/migrations.html#creating-first-model-and-migration-" data-ice="link">Creating first Model (and Migration)</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/tutorial/migrations.html"><a href="/v4/manual/tutorial/migrations.html#running-migrations" data-ice="link">Running Migrations</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/tutorial/migrations.html"><a href="/v4/manual/tutorial/migrations.html#undoing-migrations" data-ice="link">Undoing Migrations</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/tutorial/migrations.html"><a href="/v4/manual/tutorial/migrations.html#creating-first-seed" data-ice="link">Creating First Seed</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/tutorial/migrations.html"><a href="/v4/manual/tutorial/migrations.html#running-seeds" data-ice="link">Running Seeds</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/tutorial/migrations.html"><a href="/v4/manual/tutorial/migrations.html#undoing-seeds" data-ice="link">Undoing Seeds</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/tutorial/migrations.html"><a href="/v4/manual/tutorial/migrations.html#advance-topics" data-ice="link">Advance Topics</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/tutorial/migrations.html"><a href="/v4/manual/tutorial/migrations.html#migration-skeleton" data-ice="link">Migration Skeleton</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/tutorial/migrations.html"><a href="/v4/manual/tutorial/migrations.html#the-sequelizerc-file" data-ice="link">The .sequelizerc File</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/tutorial/migrations.html"><a href="/v4/manual/tutorial/migrations.html#dynamic-configuration" data-ice="link">Dynamic Configuration</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/tutorial/migrations.html"><a href="/v4/manual/tutorial/migrations.html#using-environment-variables" data-ice="link">Using Environment Variables</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/tutorial/migrations.html"><a href="/v4/manual/tutorial/migrations.html#specifying-dialect-options" data-ice="link">Specifying Dialect Options</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/tutorial/migrations.html"><a href="/v4/manual/tutorial/migrations.html#production-usages" data-ice="link">Production Usages</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/tutorial/migrations.html"><a href="/v4/manual/tutorial/migrations.html#storage" data-ice="link">Storage</a></li>
<li data-ice="manualNav" class="indent-h4" data-link="manual/tutorial/migrations.html"><a href="/v4/manual/tutorial/migrations.html#migration-storage" data-ice="link">Migration Storage</a></li>
<li data-ice="manualNav" class="indent-h4" data-link="manual/tutorial/migrations.html"><a href="/v4/manual/tutorial/migrations.html#seed-storage" data-ice="link">Seed Storage</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/tutorial/migrations.html"><a href="/v4/manual/tutorial/migrations.html#configuration-connection-string" data-ice="link">Configuration Connection String</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/tutorial/migrations.html"><a href="/v4/manual/tutorial/migrations.html#connecting-over-ssl" data-ice="link">Connecting over SSL</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/tutorial/migrations.html"><a href="/v4/manual/tutorial/migrations.html#programmatic-use" data-ice="link">Programmatic use</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/tutorial/migrations.html"><a href="/v4/manual/tutorial/migrations.html#query-interface" data-ice="link">Query Interface</a></li>
<li data-ice="manualNav" class="indent-h1 manual-color manual-color-tutorial" data-section-count="■■■" data-link="manual/tutorial/upgrade-to-v4.html"><a href="/v4/manual/tutorial/upgrade-to-v4.html" data-ice="link">Upgrade to V4</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/tutorial/upgrade-to-v4.html"><a href="/v4/manual/tutorial/upgrade-to-v4.html#changelog" data-ice="link">Changelog</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/tutorial/upgrade-to-v4.html"><a href="/v4/manual/tutorial/upgrade-to-v4.html#breaking-changes" data-ice="link">Breaking Changes</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/tutorial/upgrade-to-v4.html"><a href="/v4/manual/tutorial/upgrade-to-v4.html#node" data-ice="link">Node</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/tutorial/upgrade-to-v4.html"><a href="/v4/manual/tutorial/upgrade-to-v4.html#general" data-ice="link">General</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/tutorial/upgrade-to-v4.html"><a href="/v4/manual/tutorial/upgrade-to-v4.html#config-options" data-ice="link">Config / Options</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/tutorial/upgrade-to-v4.html"><a href="/v4/manual/tutorial/upgrade-to-v4.html#data-types" data-ice="link">Data Types</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/tutorial/upgrade-to-v4.html"><a href="/v4/manual/tutorial/upgrade-to-v4.html#transactions-cls" data-ice="link">Transactions / CLS</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/tutorial/upgrade-to-v4.html"><a href="/v4/manual/tutorial/upgrade-to-v4.html#raw-queries" data-ice="link">Raw Queries</a></li>
<li data-ice="manualNav" class="indent-h3" data-link="manual/tutorial/upgrade-to-v4.html"><a href="/v4/manual/tutorial/upgrade-to-v4.html#others" data-ice="link">Others</a></li>
</ul>
  </div>
<div data-ice="manual" data-toc-name="advanced">
    <ul class="manual-toc">
      
    <li data-ice="manualNav" class="indent-h1 manual-color manual-color-advanced" data-section-count="■■" data-link="manual/advanced/legacy.html"><a href="/v4/manual/advanced/legacy.html" data-ice="link">Working with legacy tables</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/advanced/legacy.html"><a href="/v4/manual/advanced/legacy.html#tables" data-ice="link">Tables</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/advanced/legacy.html"><a href="/v4/manual/advanced/legacy.html#fields" data-ice="link">Fields</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/advanced/legacy.html"><a href="/v4/manual/advanced/legacy.html#primary-keys" data-ice="link">Primary keys</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/advanced/legacy.html"><a href="/v4/manual/advanced/legacy.html#foreign-keys" data-ice="link">Foreign keys</a></li>
</ul>
  </div>
<div data-ice="manual" data-toc-name="reference">
    <ul class="manual-toc">
      
    <li data-ice="manualNav" class="indent-h1 manual-color manual-color-reference" data-section-count="■■■■■" data-link="identifiers.html"><a href="/v4/identifiers.html" data-ice="link">Reference</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="identifiers.html"><a href="/v4/identifiers.html#class" data-ice="link">Class</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="identifiers.html"><a href="/v4/identifiers.html#function" data-ice="link">Function</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="identifiers.html"><a href="/v4/identifiers.html#variable" data-ice="link">Variable</a></li>
</ul>
  </div>
<div data-ice="manual" data-toc-name="faq">
    <ul class="manual-toc">
      
    <li data-ice="manualNav" class="indent-h1 manual-color manual-color-faq" data-section-count="■" data-link="manual/faq/whos-using.html"><a href="/v4/manual/faq/whos-using.html" data-ice="link">Who's using sequelize?</a></li>
<li data-ice="manualNav" class="indent-h1 manual-color manual-color-faq" data-section-count="■" data-link="manual/faq/imprint.html"><a href="/v4/manual/faq/imprint.html" data-ice="link">Imprint</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/faq/imprint.html"><a href="/v4/manual/faq/imprint.html#author-s-" data-ice="link">AUTHOR(S)</a></li>
<li data-ice="manualNav" class="indent-h2" data-link="manual/faq/imprint.html"><a href="/v4/manual/faq/imprint.html#inhaltliche-verantwortung" data-ice="link">INHALTLICHE VERANTWORTUNG</a></li>
</ul>
  </div>
</div>
</nav>

<div class="content" data-ice="content"><div class="github-markdown">
  <div class="manual-user-index" data-ice="manualUserIndex"><p></p><div>
  <div class="center logo">
    <img src="/v4/manual/asset/logo-small.png" alt="logo">
  </div>
  <div class="center sequelize">Sequelize
</div>

</div><p></p>
<p><a href="https://travis-ci.org/sequelize/sequelize"><img src="https://img.shields.io/travis/sequelize/sequelize/master.svg?style=flat-square" alt="Travis build"></a>
<a href="https://npmjs.org/package/sequelize"><img src="https://img.shields.io/npm/dm/sequelize.svg?style=flat-square" alt="npm"></a>
<a href="https://github.com/sequelize/sequelize/releases"><img src="https://img.shields.io/npm/v/sequelize.svg?style=flat-square" alt="npm"></a></p>
<p>Sequelize is a promise-based ORM for Node.js v4 and up. It supports the dialects PostgreSQL, MySQL, SQLite and MSSQL and features solid transaction support, relations, read replication and more.</p>
<h2 id="example-usage">Example usage</h2>
<pre><code class="lang-js"><code class="source-code prettyprint">const Sequelize = require('sequelize');
const sequelize = new Sequelize('database', 'username', 'password', {
  host: 'localhost',
  dialect: 'mysql'|'sqlite'|'postgres'|'mssql',

  pool: {
    max: 5,
    min: 0,
    acquire: 30000,
    idle: 10000
  },

  // SQLite only
  storage: 'path/to/database.sqlite',

  // http://docs.sequelizejs.com/manual/tutorial/querying.html#operators
  operatorsAliases: false
});

const User = sequelize.define('user', {
  username: Sequelize.STRING,
  birthday: Sequelize.DATE
});

sequelize.sync()
  .then(() =&gt; User.create({
    username: 'janedoe',
    birthday: new Date(1980, 6, 20)
  }))
  .then(jane =&gt; {
    console.log(jane.toJSON());
  });</code>
</code></pre>
<p>Please use <a href="/v4/manual/installation/getting-started">Getting Started</a> to learn more. If you wish to learn about Sequelize API please use <a href="/v4/identifiers">API Reference</a></p>
</div>

  <p class="manual-badge" data-ice="manualBadge"><img src="/v4/./manual-badge.svg"></p>

  <div class="manual-cards">
    
  <div class="manual-card-wrap" data-ice="cards">
      <h1 data-ice="label" class="manual-color manual-color-installation" data-section-count="■■"><span data-ice="label-inner">Getting started</span></h1>
      <div class="manual-card">
        <div data-ice="card"><h1>Getting started</h1><h2>Installation</h2><p>Sequelize is available via NPM and Yarn.</p><pre><code class="lang-bash"><code class="source-code prettyprint">// Using NPM
$ npm install --save sequelize

# And one of the following:
$ npm install --save pg pg-hstore
$ npm install --save mysql2
$ npm install --save sqlite3
$ npm install --save tedious // MSSQL

// Using Yarn
$ yarn add sequelize

# And one of the following:
$ yarn add pg pg-hstore
$ yarn add mysql2
$ yarn add sqlite3
$ yarn add tedious // MSSQL</code>
</code></pre><h2>Setting up a connection</h2><p>Sequelize will setup a connection pool on initialization so you should ideally only ever create one instance per database if you're connecting to the DB from a single process. If you're connecting to the DB from multiple processes, you'll have to create one instance per process, but each instance should have a maximum connection pool size of "max connection pool size divided by number of instances".  So, if you wanted a max connection pool size of 90 and you had 3 worker processes, each process's instance should have a max connection pool size of 30.</p><pre><code class="lang-js"><code class="source-code prettyprint">const Sequelize = require('sequelize');
const sequelize = new Sequelize('database', 'username', 'password', {
  host: 'localhost',
  dialect: 'mysql'|'sqlite'|'postgres'|'mssql',
  operatorsAliases: false,

  pool: {
    max: 5,
    min: 0,
    acquire: 30000,
    idle: 10000
  },

  // SQLite only
  storage: 'path/to/database.sqlite'
});

// Or you can simply use a connection uri
const sequelize = new Sequelize('postgres://user:pass@example.com:5432/dbname');</code>
</code></pre><p>The Sequelize constructor takes a whole slew of options that are available via the <a href="/v4/class/lib/sequelize.js~Sequelize.html">API reference</a>.</p><h2>Test the connection</h2><p>You can use the <code>.authenticate()</code> function like this to test the connection.</p><pre><code class="lang-js"><code class="source-code prettyprint">sequelize
  .authenticate()
  .then(() =&gt; {
    console.log('Connection has been established successfully.');
  })
  .catch(err =&gt; {
    console.error('Unable to connect to the database:', err);
  });</code>
</code></pre><h2>Your first model</h2><p>Models are defined with <code>sequelize.define('name', {attributes}, {options})</code>.</p><pre><code class="lang-js"><code class="source-code prettyprint">const User = sequelize.define('user', {
  firstName: {
    type: Sequelize.STRING
  },
  lastName: {
    type: Sequelize.STRING
  }
});

// force: true will drop the table if it already exists
User.sync({force: true}).then(() =&gt; {
  // Table created
  return User.create({
    firstName: 'John',
    lastName: 'Hancock'
  });
});</code>
</code></pre><p>You can read more about creating models at <a href="/v4/class/lib/model.js~Model.html">Model API reference</a></p><h2>Your first query</h2><pre><code class="lang-js"><code class="source-code prettyprint">User.findAll().then(users =&gt; {
  console.log(users)
})</code>
</code></pre><p>You can read more about finder functions on models like <code>.findAll()</code> at <a href="/v4/manual/tutorial/models-usage.html#data-retrieval-finders">Data retrieval</a> or how to do specific queries like <code>WHERE</code> and <code>JSONB</code> at <a href="/v4/manual/tutorial/querying.html">Querying</a>.</p><h3>Application wide model options</h3><p>The Sequelize constructor takes a <code>define</code> option which will be used as the default options for all defined models.</p><pre><code class="lang-js"><code class="source-code prettyprint">const sequelize = new Sequelize('connectionUri', {
  define: {
    timestamps: false // true by default
  }
});

const User = sequelize.define('user', {}); // timestamps is false by default
const Post = sequelize.define('post', {}, {
  timestamps: true // timestamps will now be true
});</code>
</code></pre><h2>Promises</h2><p>Sequelize uses <a href="http://bluebirdjs.com">Bluebird</a> promises to control async control-flow.</p><p><strong>Note:</strong> <em>Sequelize use independent copy of Bluebird instance. You can access it using
 <code>Sequelize.Promise</code> if you want to set any Bluebird specific options</em></p><p>If you are unfamiliar with how promises work, don't worry, you can read up on them <a href="http://bluebirdjs.com/docs/why-promises.html">here</a>.</p><p>Basically, a promise represents a value which will be present at some point - "I promise you I will give you a result or an error at some point". This means that</p><pre><code class="lang-js"><code class="source-code prettyprint">// DON'T DO THIS
user = User.findOne()

console.log(user.get('firstName'));</code>
</code></pre><p><em>will never work!</em> This is because <code>user</code> is a promise object, not a data row from the DB. The right way to do it is:</p><pre><code class="lang-js"><code class="source-code prettyprint">User.findOne().then(user =&gt; {
  console.log(user.get('firstName'));
});</code>
</code></pre><p>When your environment or transpiler supports <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/await">async/await</a> this will work but only in the body of an <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/async_function">async</a> function:</p><pre><code class="lang-js"><code class="source-code prettyprint">user = await User.findOne()

console.log(user.get('firstName'));</code>
</code></pre><p>Once you've got the hang of what promises are and how they work, use the <a href="http://bluebirdjs.com/docs/api-reference.html">bluebird API reference</a> as your go-to tool. In particular, you'll probably be using <a href="http://bluebirdjs.com/docs/api/promise.all.html"><code>.all</code></a> a lot.</p></div>
        <a data-ice="link" href="/v4/manual/installation/getting-started.html"></a>
      </div>
    </div>
<div class="manual-card-wrap" data-ice="cards">
      <h1 data-ice="label" class="manual-color manual-color-installation" data-section-count="■■"><span data-ice="label-inner">Basic usage</span></h1>
      <div class="manual-card">
        <div data-ice="card"><h1>Basic usage</h1><p>To get the ball rollin' you first have to create an instance of Sequelize. Use it the following way:</p><pre><code class="lang-js"><code class="source-code prettyprint">const sequelize = new Sequelize('database', 'username', 'password', {
  dialect: 'mysql'
});</code>
</code></pre><p>This will save the passed database credentials and provide all further methods.</p><p>Furthermore you can specify a non-default host/port:</p><pre><code class="lang-js"><code class="source-code prettyprint">const sequelize = new Sequelize('database', 'username', 'password', {
  dialect: 'mysql',
  host: "my.server.tld",
  port: 9821,
})</code>
</code></pre><p>If you just don't have a password:</p><pre><code class="lang-js"><code class="source-code prettyprint">const sequelize = new Sequelize({
  database: 'db_name',
  username: 'username',
  password: null,
  dialect: 'mysql'
});</code>
</code></pre><p>You can also use a connection string:</p><pre><code class="lang-js"><code class="source-code prettyprint">const sequelize = new Sequelize('mysql://user:pass@example.com:9821/db_name', {
  // Look to the next section for possible options
})</code>
</code></pre><h2>Options</h2><p>Besides the host and the port, Sequelize comes with a whole bunch of options. Here they are:</p><ul>
<li>See <a href="/v4/class/lib/sequelize.js~Sequelize.html">Sequelize API</a></li>
<li>See <a href="/v4/manual/tutorial/models-definition.html#configuration">Model Definition</a></li>
<li>See <a href="/v4/manual/tutorial/transactions.html">Transactions</a></li>
</ul><pre><code class="lang-js"><code class="source-code prettyprint">const sequelize = new Sequelize('database', 'username', 'password', {
  // the sql dialect of the database
  // currently supported: 'mysql', 'sqlite', 'postgres', 'mssql'
  dialect: 'mysql',

  // custom host; default: localhost
  host: 'my.server.tld',

  // custom port; default: dialect default
  port: 12345,

  // custom protocol; default: 'tcp'
  // postgres only, useful for Heroku
  protocol: null,

  // disable logging; default: console.log
  logging: false,

  // you can also pass any dialect options to the underlying dialect library
  // - default is empty
  // - currently supported: 'mysql', 'postgres', 'mssql'
  dialectOptions: {
    socketPath: '/Applications/MAMP/tmp/mysql/mysql.sock',
    supportBigNumbers: true,
    bigNumberStrings: true
  },

  // the storage engine for sqlite
  // - default ':memory:'
  storage: 'path/to/database.sqlite',

  // disable inserting undefined values as NULL
  // - default: false
  omitNull: true,

  // a flag for using a native library or not.
  // in the case of 'pg' -- set this to true will allow SSL support
  // - default: false
  native: true,

  // Specify options, which are used when sequelize.define is called.
  // The following example:
  //   define: { timestamps: false }
  // is basically the same as:
  //   sequelize.define(name, attributes, { timestamps: false })
  // so defining the timestamps for each model will be not necessary
  define: {
    underscored: false
    freezeTableName: false,
    charset: 'utf8',
    dialectOptions: {
      collate: 'utf8_general_ci'
    },
    timestamps: true
  },

  // similar for sync: you can define this to always force sync for models
  sync: { force: true },

  // pool configuration used to pool database connections
  pool: {
    max: 5,
    idle: 30000,
    acquire: 60000,
  },

  // isolation level of each transaction
  // defaults to dialect default
  isolationLevel: Transaction.ISOLATION_LEVELS.REPEATABLE_READ
})</code>
</code></pre><p><strong>Hint:</strong> You can also define a custom function for the logging part. Just pass a function. The first parameter will be the string that is logged.</p><h2>Read replication</h2><p>Sequelize supports read replication, i.e. having multiple servers that you can connect to when you want to do a SELECT query. When you do read replication, you specify one or more servers to act as read replicas, and one server to act as the write master, which handles all writes and updates and propagates them to the replicas (note that the actual replication process is <strong>not</strong> handled by Sequelize, but should be set up by database backend).</p><pre><code class="lang-js"><code class="source-code prettyprint">const sequelize = new Sequelize('database', null, null, {
  dialect: 'mysql',
  port: 3306
  replication: {
    read: [
      { host: '8.8.8.8', username: 'read-username', password: 'some-password' },
      { host: '9.9.9.9', username: 'another-username', password: null }
    ],
    write: { host: '1.1.1.1', username: 'write-username', password: 'any-password' }
  },
  pool: { // If you want to override the options used for the read/write pool you can do so here
    max: 20,
    idle: 30000
  },
})</code>
</code></pre><p>If you have any general settings that apply to all replicas you do not need to provide them for each instance. In the code above, database name and port is propagated to all replicas. The same will happen for user and password, if you leave them out for any of the replicas. Each replica has the following options:<code>host</code>,<code>port</code>,<code>username</code>,<code>password</code>,<code>database</code>.</p><p>Sequelize uses a pool to manage connections to your replicas. Internally Sequelize will maintain two pools created using <code>pool</code> configuration.</p><p>If you want to modify these, you can pass pool as an options when instantiating Sequelize, as shown above.</p><p>Each <code>write</code> or <code>useMaster: true</code> query will use write pool. For <code>SELECT</code> read pool will be used. Read replica are switched using a basic round robin scheduling.</p><h2>Dialects</h2><p>With the release of Sequelize <code>1.6.0</code>, the library got independent from specific dialects. This means, that you'll have to add the respective connector library to your project yourself.</p><h3>MySQL</h3><p>In order to get Sequelize working nicely together with MySQL, you'll need to install<code>mysql2@^1.0.0-rc.10</code>or higher. Once that's done you can use it like this:</p><pre><code class="lang-js"><code class="source-code prettyprint">const sequelize = new Sequelize('database', 'username', 'password', {
  dialect: 'mysql'
})</code>
</code></pre><p><strong>Note:</strong> You can pass options directly to dialect library by setting the
<code>dialectOptions</code> parameter. See <a href="/v4/manual/installation/usage#options">Options</a>
for examples (currently only mysql is supported).</p><h3>SQLite</h3><p>For SQLite compatibility you'll need<code>sqlite3@~3.0.0</code>. Configure Sequelize like this:</p><pre><code class="lang-js"><code class="source-code prettyprint">const sequelize = new Sequelize('database', 'username', 'password', {
  // sqlite! now!
  dialect: 'sqlite',

  // the storage engine for sqlite
  // - default ':memory:'
  storage: 'path/to/database.sqlite'
})</code>
</code></pre><p>Or you can use a connection string as well with a path:</p><pre><code class="lang-js"><code class="source-code prettyprint">const sequelize = new Sequelize('sqlite:/home/abs/path/dbname.db')
const sequelize = new Sequelize('sqlite:relativePath/dbname.db')</code>
</code></pre><h3>PostgreSQL</h3><p>The library for PostgreSQL is<code>pg@^5.0.0 || ^6.0.0</code> You'll just need to define the dialect:</p><pre><code class="lang-js"><code class="source-code prettyprint">const sequelize = new Sequelize('database', 'username', 'password', {
  // gimme postgres, please!
  dialect: 'postgres'
})</code>
</code></pre><h3>MSSQL</h3><p>The library for MSSQL is<code>tedious@^1.7.0</code> You'll just need to define the dialect:</p><pre><code class="lang-js"><code class="source-code prettyprint">const sequelize = new Sequelize('database', 'username', 'password', {
  dialect: 'mssql'
})</code>
</code></pre><h2>Executing raw SQL queries</h2><p>As there are often use cases in which it is just easier to execute raw / already prepared SQL queries, you can utilize the function <code>sequelize.query</code>.</p><ul>
<li>See <a href="/v4/class/lib/sequelize.js~Sequelize.html#instance-method-query">Sequelize.query API</a></li>
<li>See <a href="/v4/variable/index.html#static-variable-QueryTypes">Query Types</a></li>
</ul><p>Here is how it works:</p><pre><code class="lang-js"><code class="source-code prettyprint">// Arguments for raw queries
sequelize.query('your query', [, options])

// Quick example
sequelize.query("SELECT * FROM myTable").then(myTableRows =&gt; {
  console.log(myTableRows)
})

// If you want to return sequelize instances use the model options.
// This allows you to easily map a query to a predefined model for sequelize e.g:
sequelize
  .query('SELECT * FROM projects', { model: Projects })
  .then(projects =&gt; {
    // Each record will now be mapped to the project's model.
    console.log(projects)
  })


// Options is an object with the following keys:
sequelize
  .query('SELECT 1', {
    // A function (or false) for logging your queries
    // Will get called for every SQL query that gets send
    // to the server.
    logging: console.log,

    // If plain is true, then sequelize will only return the first
    // record of the result set. In case of false it will all records.
    plain: false,

    // Set this to true if you don't have a model definition for your query.
    raw: false,

    // The type of query you are executing. The query type affects how results are formatted before they are passed back.
    type: Sequelize.QueryTypes.SELECT
  })

// Note the second argument being null!
// Even if we declared a callee here, the raw: true would
// supersede and return a raw object.
sequelize
  .query('SELECT * FROM projects', { raw: true })
  .then(projects =&gt; {
    console.log(projects)
  })</code>
</code></pre><p>Replacements in a query can be done in two different ways, either using
named parameters (starting with <code>:</code>), or unnamed, represented by a ?</p><p>The syntax used depends on the replacements option passed to the function:</p><ul>
<li>If an array is passed, <code>?</code> will be replaced in the order that they appear in the array</li>
<li>If an object is passed, <code>:key</code> will be replaced with the keys from that object.
If the object contains keys not found in the query or vice versa, an exception
will be thrown.</li>
</ul><pre><code class="lang-js"><code class="source-code prettyprint">sequelize
  .query(
    'SELECT * FROM projects WHERE status = ?',
    { raw: true, replacements: ['active']
  )
  .then(projects =&gt; {
    console.log(projects)
  })

sequelize
  .query(
    'SELECT * FROM projects WHERE status = :status ',
    { raw: true, replacements: { status: 'active' } }
  )
  .then(projects =&gt; {
    console.log(projects)
  })</code>
</code></pre><p><strong>One note:</strong> If the attribute names of the table contain dots, the resulting objects will be nested:</p><pre><code class="lang-js"><code class="source-code prettyprint">sequelize.query('select 1 as `foo.bar.baz`').then(rows =&gt; {
  console.log(JSON.stringify(rows))

  /*
    [{
      "foo": {
        "bar": {
          "baz": 1
        }
      }
    }]
  */
})</code>
</code></pre></div>
        <a data-ice="link" href="/v4/manual/installation/usage.html"></a>
      </div>
    </div>
<div class="manual-card-wrap" data-ice="cards">
      <h1 data-ice="label" class="manual-color manual-color-tutorial" data-section-count="■■■■"><span data-ice="label-inner">Model definition</span></h1>
      <div class="manual-card">
        <div data-ice="card"><h1>Model definition</h1><p>To define mappings between a model and a table, use the <code>define</code> method.</p><pre><code class="lang-js"><code class="source-code prettyprint">const Project = sequelize.define('project', {
  title: Sequelize.STRING,
  description: Sequelize.TEXT
})

const Task = sequelize.define('task', {
  title: Sequelize.STRING,
  description: Sequelize.TEXT,
  deadline: Sequelize.DATE
})</code>
</code></pre><p>You can also set some options on each column:</p><pre><code class="lang-js"><code class="source-code prettyprint">const Foo = sequelize.define('foo', {
 // instantiating will automatically set the flag to true if not set
 flag: { type: Sequelize.BOOLEAN, allowNull: false, defaultValue: true },

 // default values for dates =&gt; current time
 myDate: { type: Sequelize.DATE, defaultValue: Sequelize.NOW },

 // setting allowNull to false will add NOT NULL to the column, which means an error will be
 // thrown from the DB when the query is executed if the column is null. If you want to check that a value
 // is not null before querying the DB, look at the validations section below.
 title: { type: Sequelize.STRING, allowNull: false },

 // Creating two objects with the same value will throw an error. The unique property can be either a
 // boolean, or a string. If you provide the same string for multiple columns, they will form a
 // composite unique key.
 uniqueOne: { type: Sequelize.STRING,  unique: 'compositeIndex' },
 uniqueTwo: { type: Sequelize.INTEGER, unique: 'compositeIndex' },

 // The unique property is simply a shorthand to create a unique constraint.
 someUnique: { type: Sequelize.STRING, unique: true },

 // It's exactly the same as creating the index in the model's options.
 { someUnique: { type: Sequelize.STRING } },
 { indexes: [ { unique: true, fields: [ 'someUnique' ] } ] },

 // Go on reading for further information about primary keys
 identifier: { type: Sequelize.STRING, primaryKey: true },

 // autoIncrement can be used to create auto_incrementing integer columns
 incrementMe: { type: Sequelize.INTEGER, autoIncrement: true },

 // You can specify a custom field name via the 'field' attribute:
 fieldWithUnderscores: { type: Sequelize.STRING, field: 'field_with_underscores' },

 // It is possible to create foreign keys:
 bar_id: {
   type: Sequelize.INTEGER,

   references: {
     // This is a reference to another model
     model: Bar,

     // This is the column name of the referenced model
     key: 'id',

     // This declares when to check the foreign key constraint. PostgreSQL only.
     deferrable: Sequelize.Deferrable.INITIALLY_IMMEDIATE
   }
 }
})</code>
</code></pre><p>The comment option can also be used on a table, see <a href="/v4/manual/tutorial/models-definition.html#configuration">model configuration</a></p><h2>Timestamps</h2><p>By default, Sequelize will add the attributes <code>createdAt</code> and <code>updatedAt</code> to your model so you will be able to know when the database entry went into the db and when it was updated last.</p><p>Note that if you are using Sequelize migrations you will need to add the <code>createdAt</code> and <code>updatedAt</code> fields to your migration definition:</p><pre><code class="lang-js"><code class="source-code prettyprint">module.exports = {
  up(queryInterface, Sequelize) {
    return queryInterface.createTable('my-table', {
      id: {
        type: Sequelize.INTEGER,
        primaryKey: true,
        autoIncrement: true,
      },

      // Timestamps
      createdAt: Sequelize.DATE,
      updatedAt: Sequelize.DATE,
    })
  },
  down(queryInterface, Sequelize) {
    return queryInterface.dropTable('my-table');
  },
}</code>
</code></pre><p>If you do not want timestamps on your models, only want some timestamps, or you are working with an existing database where the columns are named something else, jump straight on to <a href="/v4/manual/tutorial/models-definition.html#configuration">configuration </a>to see how to do that.</p><h2>Data types</h2><p>Below are some of the datatypes supported by sequelize. For a full and updated list, see <a href="/v4/variable/index.html#static-variable-DataTypes">DataTypes</a>.</p><pre><code class="lang-js"><code class="source-code prettyprint">Sequelize.STRING                      // VARCHAR(255)
Sequelize.STRING(1234)                // VARCHAR(1234)
Sequelize.STRING.BINARY               // VARCHAR BINARY
Sequelize.TEXT                        // TEXT
Sequelize.TEXT('tiny')                // TINYTEXT

Sequelize.INTEGER                     // INTEGER
Sequelize.BIGINT                      // BIGINT
Sequelize.BIGINT(11)                  // BIGINT(11)

Sequelize.FLOAT                       // FLOAT
Sequelize.FLOAT(11)                   // FLOAT(11)
Sequelize.FLOAT(11, 12)               // FLOAT(11,12)

Sequelize.REAL                        // REAL        PostgreSQL only.
Sequelize.REAL(11)                    // REAL(11)    PostgreSQL only.
Sequelize.REAL(11, 12)                // REAL(11,12) PostgreSQL only.

Sequelize.DOUBLE                      // DOUBLE
Sequelize.DOUBLE(11)                  // DOUBLE(11)
Sequelize.DOUBLE(11, 12)              // DOUBLE(11,12)

Sequelize.DECIMAL                     // DECIMAL
Sequelize.DECIMAL(10, 2)              // DECIMAL(10,2)

Sequelize.DATE                        // DATETIME for mysql / sqlite, TIMESTAMP WITH TIME ZONE for postgres
Sequelize.DATE(6)                     // DATETIME(6) for mysql 5.6.4+. Fractional seconds support with up to 6 digits of precision
Sequelize.DATEONLY                    // DATE without time.
Sequelize.BOOLEAN                     // TINYINT(1)

Sequelize.ENUM('value 1', 'value 2')  // An ENUM with allowed values 'value 1' and 'value 2'
Sequelize.ARRAY(Sequelize.TEXT)       // Defines an array. PostgreSQL only.
Sequelize.ARRAY(Sequelize.ENUM)       // Defines an array of ENUM. PostgreSQL only.

Sequelize.JSON                        // JSON column. PostgreSQL, SQLite and MySQL only.
Sequelize.JSONB                       // JSONB column. PostgreSQL only.

Sequelize.BLOB                        // BLOB (bytea for PostgreSQL)
Sequelize.BLOB('tiny')                // TINYBLOB (bytea for PostgreSQL. Other options are medium and long)

Sequelize.UUID                        // UUID datatype for PostgreSQL and SQLite, CHAR(36) BINARY for MySQL (use defaultValue: Sequelize.UUIDV1 or Sequelize.UUIDV4 to make sequelize generate the ids automatically)

Sequelize.CIDR                        // CIDR datatype for PostgreSQL
Sequelize.INET                        // INET datatype for PostgreSQL
Sequelize.MACADDR                     // MACADDR datatype for PostgreSQL

Sequelize.RANGE(Sequelize.INTEGER)    // Defines int4range range. PostgreSQL only.
Sequelize.RANGE(Sequelize.BIGINT)     // Defined int8range range. PostgreSQL only.
Sequelize.RANGE(Sequelize.DATE)       // Defines tstzrange range. PostgreSQL only.
Sequelize.RANGE(Sequelize.DATEONLY)   // Defines daterange range. PostgreSQL only.
Sequelize.RANGE(Sequelize.DECIMAL)    // Defines numrange range. PostgreSQL only.

Sequelize.ARRAY(Sequelize.RANGE(Sequelize.DATE)) // Defines array of tstzrange ranges. PostgreSQL only.

Sequelize.GEOMETRY                    // Spatial column.  PostgreSQL (with PostGIS) or MySQL only.
Sequelize.GEOMETRY('POINT')           // Spatial column with geometry type. PostgreSQL (with PostGIS) or MySQL only.
Sequelize.GEOMETRY('POINT', 4326)     // Spatial column with geometry type and SRID.  PostgreSQL (with PostGIS) or MySQL only.</code>
</code></pre><p>The BLOB data type allows you to insert data both as strings and as buffers. When you do a find or findAll on a model which has a BLOB column, that data will always be returned as a buffer.</p><p>If you are working with the PostgreSQL TIMESTAMP WITHOUT TIME ZONE and you need to parse it to a different timezone, please use the pg library's own parser:</p><pre><code class="lang-js"><code class="source-code prettyprint">require('pg').types.setTypeParser(1114, stringValue =&gt; {
  return new Date(stringValue + '+0000');
  // e.g., UTC offset. Use any offset that you would like.
});</code>
</code></pre><p>In addition to the type mentioned above, integer, bigint, float and double also support unsigned and zerofill properties, which can be combined in any order:
Be aware that this does not apply for PostgreSQL!</p><pre><code class="lang-js"><code class="source-code prettyprint">Sequelize.INTEGER.UNSIGNED              // INTEGER UNSIGNED
Sequelize.INTEGER(11).UNSIGNED          // INTEGER(11) UNSIGNED
Sequelize.INTEGER(11).ZEROFILL          // INTEGER(11) ZEROFILL
Sequelize.INTEGER(11).ZEROFILL.UNSIGNED // INTEGER(11) UNSIGNED ZEROFILL
Sequelize.INTEGER(11).UNSIGNED.ZEROFILL // INTEGER(11) UNSIGNED ZEROFILL</code>
</code></pre><p><em>The examples above only show integer, but the same can be done with bigint and float</em></p><p>Usage in object notation:</p><pre><code class="lang-js"><code class="source-code prettyprint">// for enums:
sequelize.define('model', {
  states: {
    type:   Sequelize.ENUM,
    values: ['active', 'pending', 'deleted']
  }
})</code>
</code></pre><h3>Array(ENUM)</h3><p>Its only supported with PostgreSQL.</p><p>Array(Enum) type require special treatment. Whenever Sequelize will talk to database it has to typecast Array values with ENUM name.</p><p>So this enum name must follow this pattern <code>enum_&lt;table_name&gt;_&lt;col_name&gt;</code>. If you are using <code>sync</code> then correct name will automatically be generated.</p><h3>Range types</h3><p>Since range types have extra information for their bound inclusion/exclusion it's not
very straightforward to just use a tuple to represent them in javascript.</p><p>When supplying ranges as values you can choose from the following APIs:</p><pre><code class="lang-js"><code class="source-code prettyprint">// defaults to '["2016-01-01 00:00:00+00:00", "2016-02-01 00:00:00+00:00")'
// inclusive lower bound, exclusive upper bound
Timeline.create({ range: [new Date(Date.UTC(2016, 0, 1)), new Date(Date.UTC(2016, 1, 1))] });

// control inclusion
const range = [new Date(Date.UTC(2016, 0, 1)), new Date(Date.UTC(2016, 1, 1))];
range.inclusive = false; // '()'
range.inclusive = [false, true]; // '(]'
range.inclusive = true; // '[]'
range.inclusive = [true, false]; // '[)'

// or as a single expression
const range = [
  { value: new Date(Date.UTC(2016, 0, 1)), inclusive: false },
  { value: new Date(Date.UTC(2016, 1, 1)), inclusive: true },
];
// '("2016-01-01 00:00:00+00:00", "2016-02-01 00:00:00+00:00"]'

// composite form
const range = [
  { value: new Date(Date.UTC(2016, 0, 1)), inclusive: false },
  new Date(Date.UTC(2016, 1, 1)),
];
// '("2016-01-01 00:00:00+00:00", "2016-02-01 00:00:00+00:00")'

Timeline.create({ range });</code>
</code></pre><p>However, please note that whenever you get back a value that is range you will
receive:</p><pre><code class="lang-js"><code class="source-code prettyprint">// stored value: ("2016-01-01 00:00:00+00:00", "2016-02-01 00:00:00+00:00"]
range // [Date, Date]
range.inclusive // [false, true]</code>
</code></pre><p>Make sure you turn that into a serializable format before serialization since array
extra properties will not be serialized.</p><p><strong>Special Cases</strong></p><pre><code class="lang-js"><code class="source-code prettyprint">// empty range:
Timeline.create({ range: [] }); // range = 'empty'

// Unbounded range:
Timeline.create({ range: [null, null] }); // range = '[,)'
// range = '[,"2016-01-01 00:00:00+00:00")'
Timeline.create({ range: [null, new Date(Date.UTC(2016, 0, 1))] });

// Infinite range:
// range = '[-infinity,"2016-01-01 00:00:00+00:00")'
Timeline.create({ range: [-Infinity, new Date(Date.UTC(2016, 0, 1))] });</code>
</code></pre><h2>Deferrable</h2><p>When you specify a foreign key column it is optionally possible to declare the deferrable
type in PostgreSQL. The following options are available:</p><pre><code class="lang-js"><code class="source-code prettyprint">// Defer all foreign key constraint check to the end of a transaction
Sequelize.Deferrable.INITIALLY_DEFERRED

// Immediately check the foreign key constraints
Sequelize.Deferrable.INITIALLY_IMMEDIATE

// Don't defer the checks at all
Sequelize.Deferrable.NOT</code>
</code></pre><p>The last option is the default in PostgreSQL and won't allow you to dynamically change
the rule in a transaction. See <a href="/v4/manual/tutorial/transactions.html#options">the transaction section</a> for further information.</p><h2>Getters &amp; setters</h2><p>It is possible to define 'object-property' getters and setter functions on your models, these can be used both for 'protecting' properties that map to database fields and for defining 'pseudo' properties.</p><p>Getters and Setters can be defined in 2 ways (you can mix and match these 2 approaches):</p><ul>
<li>as part of a single property definition</li>
<li>as part of a model options</li>
</ul><p><strong>N.B:</strong> If a getter or setter is defined in both places then the function found in the relevant property definition will always take precedence.</p><h3>Defining as part of a property</h3><pre><code class="lang-js"><code class="source-code prettyprint">const Employee = sequelize.define('employee', {
  name: {
    type: Sequelize.STRING,
    allowNull: false,
    get() {
      const title = this.getDataValue('title');
      // 'this' allows you to access attributes of the instance
      return this.getDataValue('name') + ' (' + title + ')';
    },
  },
  title: {
    type: Sequelize.STRING,
    allowNull: false,
    set(val) {
      this.setDataValue('title', val.toUpperCase());
    }
  }
});

Employee
  .create({ name: 'John Doe', title: 'senior engineer' })
  .then(employee =&gt; {
    console.log(employee.get('name')); // John Doe (SENIOR ENGINEER)
    console.log(employee.get('title')); // SENIOR ENGINEER
  })</code>
</code></pre><h3>Defining as part of the model options</h3><p>Below is an example of defining the getters and setters in the model options. The <code>fullName</code> getter,  is an example of how you can define pseudo properties on your models - attributes which are not actually part of your database schema. In fact, pseudo properties can be defined in two ways: using model getters, or by using a column with the <a href="/v4/variable/index.html#static-variable-DataTypes"><code>VIRTUAL</code> datatype</a>. Virtual datatypes can have validations, while getters for virtual attributes cannot.</p><p>Note that the <code>this.firstname</code> and <code>this.lastname</code> references in the <code>fullName</code> getter function will trigger a call to the respective getter functions. If you do not want that then use the <code>getDataValue()</code> method to access the raw value (see below).</p><pre><code class="lang-js"><code class="source-code prettyprint">const Foo = sequelize.define('foo', {
  firstname: Sequelize.STRING,
  lastname: Sequelize.STRING
}, {
  getterMethods: {
    fullName() {
      return this.firstname + ' ' + this.lastname
    }
  },

  setterMethods: {
    fullName(value) {
      const names = value.split(' ');

      this.setDataValue('firstname', names.slice(0, -1).join(' '));
      this.setDataValue('lastname', names.slice(-1).join(' '));
    },
  }
});</code>
</code></pre><h3>Helper functions for use inside getter and setter definitions</h3><ul>
<li>retrieving an underlying property value - always use <code>this.getDataValue()</code></li>
</ul><pre><code class="lang-js"><code class="source-code prettyprint">/* a getter for 'title' property */
get() {
  return this.getDataValue('title')
}</code>
</code></pre><ul>
<li>setting an underlying property value - always use <code>this.setDataValue()</code></li>
</ul><pre><code class="lang-js"><code class="source-code prettyprint">/* a setter for 'title' property */
set(title) {
  this.setDataValue('title', title.toString().toLowerCase());
}</code>
</code></pre><p><strong>N.B:</strong> It is important to stick to using the <code>setDataValue()</code> and <code>getDataValue()</code> functions (as opposed to accessing the underlying "data values" property directly) - doing so protects your custom getters and setters from changes in the underlying model implementations.</p><h2>Validations</h2><p>Model validations, allow you to specify format/content/inheritance validations for each attribute of the model.</p><p>Validations are automatically run on <code>create</code>, <code>update</code> and <code>save</code>. You can also call <code>validate()</code> to manually validate an instance.</p><p>The validations are implemented by <a href="https://github.com/chriso/validator.js">validator.js</a>.</p><pre><code class="lang-js"><code class="source-code prettyprint">const ValidateMe = sequelize.define('foo', {
  foo: {
    type: Sequelize.STRING,
    validate: {
      is: ["^[a-z]+$",'i'],     // will only allow letters
      is: /^[a-z]+$/i,          // same as the previous example using real RegExp
      not: ["[a-z]",'i'],       // will not allow letters
      isEmail: true,            // checks for email format (foo@bar.com)
      isUrl: true,              // checks for url format (http://foo.com)
      isIP: true,               // checks for IPv4 (129.89.23.1) or IPv6 format
      isIPv4: true,             // checks for IPv4 (129.89.23.1)
      isIPv6: true,             // checks for IPv6 format
      isAlpha: true,            // will only allow letters
      isAlphanumeric: true,     // will only allow alphanumeric characters, so "_abc" will fail
      isNumeric: true,          // will only allow numbers
      isInt: true,              // checks for valid integers
      isFloat: true,            // checks for valid floating point numbers
      isDecimal: true,          // checks for any numbers
      isLowercase: true,        // checks for lowercase
      isUppercase: true,        // checks for uppercase
      notNull: true,            // won't allow null
      isNull: true,             // only allows null
      notEmpty: true,           // don't allow empty strings
      equals: 'specific value', // only allow a specific value
      contains: 'foo',          // force specific substrings
      notIn: [['foo', 'bar']],  // check the value is not one of these
      isIn: [['foo', 'bar']],   // check the value is one of these
      notContains: 'bar',       // don't allow specific substrings
      len: [2,10],              // only allow values with length between 2 and 10
      isUUID: 4,                // only allow uuids
      isDate: true,             // only allow date strings
      isAfter: "2011-11-05",    // only allow date strings after a specific date
      isBefore: "2011-11-05",   // only allow date strings before a specific date
      max: 23,                  // only allow values &lt;= 23
      min: 23,                  // only allow values &gt;= 23
      isCreditCard: true,       // check for valid credit card numbers

      // custom validations are also possible:
      isEven(value) {
        if (parseInt(value) % 2 != 0) {
          throw new Error('Only even values are allowed!')
          // we also are in the model's context here, so this.otherField
          // would get the value of otherField if it existed
        }
      }
    }
  }
});</code>
</code></pre><p>Note that where multiple arguments need to be passed to the built-in validation functions, the arguments to be passed must be in an array. But if a single array argument is to be passed, for instance an array of acceptable strings for <code>isIn</code>, this will be interpreted as multiple string arguments instead of one array argument. To work around this pass a single-length array of arguments, such as <code>[['one', 'two']]</code> as shown above.</p><p>To use a custom error message instead of that provided by validator.js, use an object instead of the plain value or array of arguments, for example a validator which needs no argument can be given a custom message with</p><pre><code class="lang-js"><code class="source-code prettyprint">isInt: {
  msg: "Must be an integer number of pennies"
}</code>
</code></pre><p>or if arguments need to also be passed add an<code>args</code>property:</p><pre><code class="lang-js"><code class="source-code prettyprint">isIn: {
  args: [['en', 'zh']],
  msg: "Must be English or Chinese"
}</code>
</code></pre><p>When using custom validator functions the error message will be whatever message the thrown<code>Error</code>object holds.</p><p>See <a href="https://github.com/chriso/validator.js">the validator.js project</a> for more details on the built in validation methods.</p><p><strong>Hint: </strong>You can also define a custom function for the logging part. Just pass a function. The first parameter will be the string that is logged.</p><h3>Validators and <code>allowNull</code></h3><p>If a particular field of a model is set to allow null (with <code>allowNull: true</code>) and that value has been set to <code>null</code> , its validators do not run. This means you can, for instance, have a string field which validates its length to be at least 5 characters, but which also allows<code>null</code>.</p><h3>Model validations</h3><p>Validations can also be defined to check the model after the field-specific validators. Using this you could, for example, ensure either neither of <code>latitude</code> and <code>longitude</code> are set or both, and fail if one but not the other is set.</p><p>Model validator methods are called with the model object's context and are deemed to fail if they throw an error, otherwise pass. This is just the same as with custom field-specific validators.</p><p>Any error messages collected are put in the validation result object alongside the field validation errors, with keys named after the failed validation method's key in the <code>validate</code> option object. Even though there can only be one error message for each model validation method at any one time, it is presented as a single string error in an array, to maximize consistency with the field errors.</p><p>An example:</p><pre><code class="lang-js"><code class="source-code prettyprint">const Pub = Sequelize.define('pub', {
  name: { type: Sequelize.STRING },
  address: { type: Sequelize.STRING },
  latitude: {
    type: Sequelize.INTEGER,
    allowNull: true,
    defaultValue: null,
    validate: { min: -90, max: 90 }
  },
  longitude: {
    type: Sequelize.INTEGER,
    allowNull: true,
    defaultValue: null,
    validate: { min: -180, max: 180 }
  },
}, {
  validate: {
    bothCoordsOrNone() {
      if ((this.latitude === null) !== (this.longitude === null)) {
        throw new Error('Require either both latitude and longitude or neither')
      }
    }
  }
})</code>
</code></pre><p>In this simple case an object fails validation if either latitude or longitude is given, but not both. If we try to build one with an out-of-range latitude and no longitude, <code>raging_bullock_arms.validate()</code> might return</p><pre><code class="lang-js"><code class="source-code prettyprint">{
  'latitude': ['Invalid number: latitude'],
  'bothCoordsOrNone': ['Require either both latitude and longitude or neither']
}</code>
</code></pre><h2>Configuration</h2><p>You can also influence the way Sequelize handles your column names:</p><pre><code class="lang-js"><code class="source-code prettyprint">const Bar = sequelize.define('bar', { /* bla */ }, {
  // don't add the timestamp attributes (updatedAt, createdAt)
  timestamps: false,

  // don't delete database entries but set the newly added attribute deletedAt
  // to the current date (when deletion was done). paranoid will only work if
  // timestamps are enabled
  paranoid: true,

  // don't use camelcase for automatically added attributes but underscore style
  // so updatedAt will be updated_at
  underscored: true,

  // disable the modification of table names; By default, sequelize will automatically
  // transform all passed model names (first parameter of define) into plural.
  // if you don't want that, set the following
  freezeTableName: true,

  // define the table's name
  tableName: 'my_very_custom_table_name',

  // Enable optimistic locking.  When enabled, sequelize will add a version count attribute
  // to the model and throw an OptimisticLockingError error when stale instances are saved.
  // Set to true or a string with the attribute name you want to use to enable.
  version: true
})</code>
</code></pre><p>If you want sequelize to handle timestamps, but only want some of them, or want your timestamps to be called something else, you can override each column individually:</p><pre><code class="lang-js"><code class="source-code prettyprint">const Foo = sequelize.define('foo',  { /* bla */ }, {
  // don't forget to enable timestamps!
  timestamps: true,

  // I don't want createdAt
  createdAt: false,

  // I want updatedAt to actually be called updateTimestamp
  updatedAt: 'updateTimestamp',

  // And deletedAt to be called destroyTime (remember to enable paranoid for this to work)
  deletedAt: 'destroyTime',
  paranoid: true
})</code>
</code></pre><p>You can also change the database engine, e.g. to MyISAM. InnoDB is the default.</p><pre><code class="lang-js"><code class="source-code prettyprint">const Person = sequelize.define('person', { /* attributes */ }, {
  engine: 'MYISAM'
})

// or globally
const sequelize = new Sequelize(db, user, pw, {
  define: { engine: 'MYISAM' }
})</code>
</code></pre><p>Finally you can specify a comment for the table in MySQL and PG</p><pre><code class="lang-js"><code class="source-code prettyprint">const Person = sequelize.define('person', { /* attributes */ }, {
  comment: "I'm a table comment!"
})</code>
</code></pre><h2>Import</h2><p>You can also store your model definitions in a single file using the <code>import</code> method. The returned object is exactly the same as defined in the imported file's function. Since <code>v1:5.0</code> of Sequelize the import is cached, so you won't run into troubles when calling the import of a file twice or more often.</p><pre><code class="lang-js"><code class="source-code prettyprint">// in your server file - e.g. app.js
const Project = sequelize.import(__dirname + "/path/to/models/project")

// The model definition is done in /path/to/models/project.js
// As you might notice, the DataTypes are the very same as explained above
module.exports = (sequelize, DataTypes) =&gt; {
  return sequelize.define("project", {
    name: DataTypes.STRING,
    description: DataTypes.TEXT
  })
}</code>
</code></pre><p>The <code>import</code> method can also accept a callback as an argument.</p><pre><code class="lang-js"><code class="source-code prettyprint">sequelize.import('project', (sequelize, DataTypes) =&gt; {
  return sequelize.define("project", {
    name: DataTypes.STRING,
    description: DataTypes.TEXT
  })
})</code>
</code></pre><p>This extra capability is useful when, for example, <code>Error: Cannot find module</code> is thrown even though <code>/path/to/models/project</code> seems to be correct.  Some frameworks, such as Meteor, overload <code>require</code>, and spit out "surprise" results like :</p><pre><code><code class="source-code prettyprint">Error: Cannot find module '/home/you/meteorApp/.meteor/local/build/programs/server/app/path/to/models/project.js'</code>
</code></pre><p>This is solved by passing in Meteor's version of <code>require</code>. So, while this probably fails ...</p><pre><code class="lang-js"><code class="source-code prettyprint">const AuthorModel = db.import('./path/to/models/project');</code>
</code></pre><p>... this should succeed ...</p><pre><code class="lang-js"><code class="source-code prettyprint">const AuthorModel = db.import('project', require('./path/to/models/project'));</code>
</code></pre><h2>Optimistic Locking</h2><p>Sequelize has built-in support for optimistic locking through a model instance version count.
Optimistic locking is disabled by default and can be enabled by setting the <code>version</code> property to true in a specific model definition or global model configuration.  See <a href="/v4/manual/tutorial/models-definition.html#configuration">model configuration</a> for more details.</p><p>Optimistic locking allows concurrent access to model records for edits and prevents conflicts from overwriting data.  It does this by checking whether another process has made changes to a record since it was read and throws an OptimisticLockError when a conflict is detected.</p><h2>Database synchronization</h2><p>When starting a new project you won't have a database structure and using Sequelize you won't need to. Just specify your model structures and let the library do the rest. Currently supported is the creation and deletion of tables:</p><pre><code class="lang-js"><code class="source-code prettyprint">// Create the tables:
Project.sync()
Task.sync()

// Force the creation!
Project.sync({force: true}) // this will drop the table first and re-create it afterwards

// drop the tables:
Project.drop()
Task.drop()

// event handling:
Project.[sync|drop]().then(() =&gt; {
  // ok ... everything is nice!
}).catch(error =&gt; {
  // oooh, did you enter wrong database credentials?
})</code>
</code></pre><p>Because synchronizing and dropping all of your tables might be a lot of lines to write, you can also let Sequelize do the work for you:</p><pre><code class="lang-js"><code class="source-code prettyprint">// Sync all models that aren't already in the database
sequelize.sync()

// Force sync all models
sequelize.sync({force: true})

// Drop all tables
sequelize.drop()

// emit handling:
sequelize.[sync|drop]().then(() =&gt; {
  // woot woot
}).catch(error =&gt; {
  // whooops
})</code>
</code></pre><p>Because <code>.sync({ force: true })</code> is destructive operation, you can use <code>match</code> option as an additional safety check.
<code>match</code> option tells sequelize to match a regex against the database name before syncing - a safety check for cases
where <code>force: true</code> is used in tests but not live code.</p><pre><code class="lang-js"><code class="source-code prettyprint">// This will run .sync() only if database name ends with '_test'
sequelize.sync({ force: true, match: /_test$/ });</code>
</code></pre><h2>Expansion of models</h2><p>Sequelize Models are ES6 classes. You can very easily add custom instance or class level methods.</p><pre><code class="lang-js"><code class="source-code prettyprint">const User = sequelize.define('user', { firstname: Sequelize.STRING });

// Adding a class level method
User.classLevelMethod = function() {
  return 'foo';
};

// Adding an instance level method
User.prototype.instanceLevelMethod = function() {
  return 'bar';
};</code>
</code></pre><p>Of course you can also access the instance's data and generate virtual getters:</p><pre><code class="lang-js"><code class="source-code prettyprint">const User = sequelize.define('user', { firstname: Sequelize.STRING, lastname: Sequelize.STRING });

User.prototype.getFullname = function() {
  return [this.firstname, this.lastname].join(' ');
};

// Example:
User.build({ firstname: 'foo', lastname: 'bar' }).getFullname() // 'foo bar'</code>
</code></pre><h3>Indexes</h3><p>Sequelize supports adding indexes to the model definition which will be created during <code>Model.sync()</code> or <code>sequelize.sync</code>.</p><pre><code class="lang-js"><code class="source-code prettyprint">sequelize.define('user', {}, {
  indexes: [
    // Create a unique index on email
    {
      unique: true,
      fields: ['email']
    },

    // Creates a gin index on data with the jsonb_path_ops operator
    {
      fields: ['data'],
      using: 'gin',
      operator: 'jsonb_path_ops'
    },

    // By default index name will be [table]_[fields]
    // Creates a multi column partial index
    {
      name: 'public_by_author',
      fields: ['author', 'status'],
      where: {
        status: 'public'
      }
    },

    // A BTREE index with a ordered field
    {
      name: 'title_index',
      method: 'BTREE',
      fields: ['author', {attribute: 'title', collate: 'en_US', order: 'DESC', length: 5}]
    }
  ]
})</code>
</code></pre></div>
        <a data-ice="link" href="/v4/manual/tutorial/models-definition.html"></a>
      </div>
    </div>
<div class="manual-card-wrap" data-ice="cards">
      <h1 data-ice="label" class="manual-color manual-color-tutorial" data-section-count="■■■■"><span data-ice="label-inner">Model usage</span></h1>
      <div class="manual-card">
        <div data-ice="card"><h1>Model usage</h1><h2>Data retrieval / Finders</h2><p>Finder methods are intended to query data from the database. They do <em>not</em> return plain objects but instead return model instances. Because finder methods return model instances you can call any model instance member on the result as described in the documentation for <a href="/v4/manual/tutorial/instances.html"><em>instances</em></a>.</p><p>In this document we'll explore what finder methods can do:</p><h3><code>find</code> - Search for one specific element in the database</h3><pre><code class="lang-js"><code class="source-code prettyprint">// search for known ids
Project.findById(123).then(project =&gt; {
  // project will be an instance of Project and stores the content of the table entry
  // with id 123. if such an entry is not defined you will get null
})

// search for attributes
Project.findOne({ where: {title: 'aProject'} }).then(project =&gt; {
  // project will be the first entry of the Projects table with the title 'aProject' || null
})


Project.findOne({
  where: {title: 'aProject'},
  attributes: ['id', ['name', 'title']]
}).then(project =&gt; {
  // project will be the first entry of the Projects table with the title 'aProject' || null
  // project.title will contain the name of the project
})</code>
</code></pre><h3><code>findOrCreate</code> - Search for a specific element or create it if not available</h3><p>The method <code>findOrCreate</code> can be used to check if a certain element already exists in the database. If that is the case the method will result in a respective instance. If the element does not yet exist, it will be created.</p><p>Let's assume we have an empty database with a <code>User</code> model which has a <code>username</code> and a <code>job</code>.</p><pre><code class="lang-js"><code class="source-code prettyprint">User
  .findOrCreate({where: {username: 'sdepold'}, defaults: {job: 'Technical Lead JavaScript'}})
  .spread((user, created) =&gt; {
    console.log(user.get({
      plain: true
    }))
    console.log(created)

    /*
     findOrCreate returns an array containing the object that was found or created and a boolean that will be true if a new object was created and false if not, like so:

    [ {
        username: 'sdepold',
        job: 'Technical Lead JavaScript',
        id: 1,
        createdAt: Fri Mar 22 2013 21: 28: 34 GMT + 0100(CET),
        updatedAt: Fri Mar 22 2013 21: 28: 34 GMT + 0100(CET)
      },
      true ]

 In the example above, the "spread" on line 39 divides the array into its 2 parts and passes them as arguments to the callback function defined beginning at line 39, which treats them as "user" and "created" in this case. (So "user" will be the object from index 0 of the returned array and "created" will equal "true".)
    */
  })</code>
</code></pre><p>The code created a new instance. So when we already have an instance ...</p><pre><code class="lang-js"><code class="source-code prettyprint">User.create({ username: 'fnord', job: 'omnomnom' })
  .then(() =&gt; User.findOrCreate({where: {username: 'fnord'}, defaults: {job: 'something else'}}))
  .spread((user, created) =&gt; {
    console.log(user.get({
      plain: true
    }))
    console.log(created)

    /*
    In this example, findOrCreate returns an array like this:
    [ {
        username: 'fnord',
        job: 'omnomnom',
        id: 2,
        createdAt: Fri Mar 22 2013 21: 28: 34 GMT + 0100(CET),
        updatedAt: Fri Mar 22 2013 21: 28: 34 GMT + 0100(CET)
      },
      false
    ]
    The array returned by findOrCreate gets spread into its 2 parts by the "spread" on line 69, and the parts will be passed as 2 arguments to the callback function beginning on line 69, which will then treat them as "user" and "created" in this case. (So "user" will be the object from index 0 of the returned array and "created" will equal "false".)
    */
  })</code>
</code></pre><p>... the existing entry will not be changed. See the <code>job</code> of the second user, and the fact that created was false.</p><h3><code>findAndCountAll</code> - Search for multiple elements in the database, returns both data and total count</h3><p>This is a convenience method that combines<code>findAll</code> and <code>count</code> (see below) this is useful when dealing with queries related to pagination where you want to retrieve data with a <code>limit</code> and <code>offset</code> but also need to know the total number of records that match the query:</p><p>The success handler will always receive an object with two properties:</p><ul>
<li><code>count</code> - an integer, total number records matching the where clause and other filters due to associations</li>
<li><code>rows</code> - an array of objects, the records matching the where clause and other filters due to associations, within the limit and offset range</li>
</ul><pre><code class="lang-js"><code class="source-code prettyprint">Project
  .findAndCountAll({
     where: {
        title: {
          [Op.like]: 'foo%'
        }
     },
     offset: 10,
     limit: 2
  })
  .then(result =&gt; {
    console.log(result.count);
    console.log(result.rows);
  });</code>
</code></pre><p>It support includes. Only the includes that are marked as <code>required</code> will be added to the count part:</p><p>Suppose you want to find all users who have a profile attached:</p><pre><code class="lang-js"><code class="source-code prettyprint">User.findAndCountAll({
  include: [
     { model: Profile, required: true}
  ],
  limit: 3
});</code>
</code></pre><p>Because the include for <code>Profile</code> has <code>required</code> set it will result in an inner join, and only the users who have a profile will be counted. If we remove <code>required</code> from the include, both users with and without profiles will be counted. Adding a <code>where</code> clause to the include automatically makes it required:</p><pre><code class="lang-js"><code class="source-code prettyprint">User.findAndCountAll({
  include: [
     { model: Profile, where: { active: true }}
  ],
  limit: 3
});</code>
</code></pre><p>The query above will only count users who have an active profile, because <code>required</code> is implicitly set to true when you add a where clause to the include.</p><p>The options object that you pass to <code>findAndCountAll</code> is the same as for <code>findAll</code> (described below).</p><h3><code>findAll</code> - Search for multiple elements in the database</h3><pre><code class="lang-js"><code class="source-code prettyprint">// find multiple entries
Project.findAll().then(projects =&gt; {
  // projects will be an array of all Project instances
})

// also possible:
Project.all().then(projects =&gt; {
  // projects will be an array of all Project instances
})

// search for specific attributes - hash usage
Project.findAll({ where: { name: 'A Project' } }).then(projects =&gt; {
  // projects will be an array of Project instances with the specified name
})

// search within a specific range
Project.findAll({ where: { id: [1,2,3] } }).then(projects =&gt; {
  // projects will be an array of Projects having the id 1, 2 or 3
  // this is actually doing an IN query
})

Project.findAll({
  where: {
    id: {
      [Op.and]: {a: 5},           // AND (a = 5)
      [Op.or]: [{a: 5}, {a: 6}],  // (a = 5 OR a = 6)
      [Op.gt]: 6,                // id &gt; 6
      [Op.gte]: 6,               // id &gt;= 6
      [Op.lt]: 10,               // id &lt; 10
      [Op.lte]: 10,              // id &lt;= 10
      [Op.ne]: 20,               // id != 20
      [Op.between]: [6, 10],     // BETWEEN 6 AND 10
      [Op.notBetween]: [11, 15], // NOT BETWEEN 11 AND 15
      [Op.in]: [1, 2],           // IN [1, 2]
      [Op.notIn]: [1, 2],        // NOT IN [1, 2]
      [Op.like]: '%hat',         // LIKE '%hat'
      [Op.notLike]: '%hat',       // NOT LIKE '%hat'
      [Op.iLike]: '%hat',         // ILIKE '%hat' (case insensitive)  (PG only)
      [Op.notILike]: '%hat',      // NOT ILIKE '%hat'  (PG only)
      [Op.overlap]: [1, 2],       // &amp;&amp; [1, 2] (PG array overlap operator)
      [Op.contains]: [1, 2],      // @&gt; [1, 2] (PG array contains operator)
      [Op.contained]: [1, 2],     // &lt;@ [1, 2] (PG array contained by operator)
      [Op.any]: [2,3]            // ANY ARRAY[2, 3]::INTEGER (PG only)
    },
    status: {
      [Op.not]: false           // status NOT FALSE
    }
  }
})</code>
</code></pre><h3>Complex filtering / OR / NOT queries</h3><p>It's possible to do complex where queries with multiple levels of nested AND, OR and NOT conditions. In order to do that you can use <code>or</code>, <code>and</code> or <code>not</code> <code>Operators</code>:</p><pre><code class="lang-js"><code class="source-code prettyprint">Project.findOne({
  where: {
    name: 'a project',
    [Op.or]: [
      { id: [1,2,3] },
      { id: { [Op.gt]: 10 } }
    ]
  }
})

Project.findOne({
  where: {
    name: 'a project',
    id: {
      [Op.or]: [
        [1,2,3],
        { [Op.gt]: 10 }
      ]
    }
  }
})</code>
</code></pre><p>Both pieces of code will generate the following:</p><pre><code class="lang-sql"><code class="source-code prettyprint">SELECT *
FROM `Projects`
WHERE (
  `Projects`.`name` = 'a project'
   AND (`Projects`.`id` IN (1,2,3) OR `Projects`.`id` &gt; 10)
)
LIMIT 1;</code>
</code></pre><p><code>not</code> example:</p><pre><code class="lang-js"><code class="source-code prettyprint">Project.findOne({
  where: {
    name: 'a project',
    [Op.not]: [
      { id: [1,2,3] },
      { array: { [Op.contains]: [3,4,5] } }
    ]
  }
});</code>
</code></pre><p>Will generate:</p><pre><code class="lang-sql"><code class="source-code prettyprint">SELECT *
FROM `Projects`
WHERE (
  `Projects`.`name` = 'a project'
   AND NOT (`Projects`.`id` IN (1,2,3) OR `Projects`.`array` @&gt; ARRAY[3,4,5]::INTEGER[])
)
LIMIT 1;</code>
</code></pre><h3>Manipulating the dataset with limit, offset, order and group</h3><p>To get more relevant data, you can use limit, offset, order and grouping:</p><pre><code class="lang-js"><code class="source-code prettyprint">// limit the results of the query
Project.findAll({ limit: 10 })

// step over the first 10 elements
Project.findAll({ offset: 10 })

// step over the first 10 elements, and take 2
Project.findAll({ offset: 10, limit: 2 })</code>
</code></pre><p>The syntax for grouping and ordering are equal, so below it is only explained with a single example for group, and the rest for order. Everything you see below can also be done for group</p><pre><code class="lang-js"><code class="source-code prettyprint">Project.findAll({order: 'title DESC'})
// yields ORDER BY title DESC

Project.findAll({group: 'name'})
// yields GROUP BY name</code>
</code></pre><p>Notice how in the two examples above, the string provided is inserted verbatim into the query, i.e. column names are not escaped. When you provide a string to order/group, this will always be the case. If you want to escape column names, you should provide an array of arguments, even though you only want to order/group by a single column</p><pre><code class="lang-js"><code class="source-code prettyprint">something.findOne({
  order: [
    // will return `name`
    ['name'],
    // will return `username` DESC
    ['username', 'DESC'],
    // will return max(`age`)
    sequelize.fn('max', sequelize.col('age')),
    // will return max(`age`) DESC
    [sequelize.fn('max', sequelize.col('age')), 'DESC'],
    // will return otherfunction(`col1`, 12, 'lalala') DESC
    [sequelize.fn('otherfunction', sequelize.col('col1'), 12, 'lalala'), 'DESC'],
    // will return otherfunction(awesomefunction(`col`)) DESC, This nesting is potentially infinite!
    [sequelize.fn('otherfunction', sequelize.fn('awesomefunction', sequelize.col('col'))), 'DESC']
  ]
})</code>
</code></pre><p>To recap, the elements of the order/group array can be the following:</p><ul>
<li>String - will be quoted</li>
<li>Array - first element will be quoted, second will be appended verbatim</li>
<li>Object -<ul>
<li>Raw will be added verbatim without quoting</li>
<li>Everything else is ignored, and if raw is not set, the query will fail</li>
</ul>
</li>
<li>Sequelize.fn and Sequelize.col returns functions and quoted column names</li>
</ul><h3>Raw queries</h3><p>Sometimes you might be expecting a massive dataset that you just want to display, without manipulation. For each row you select, Sequelize creates an instance with functions for update, delete, get associations etc. If you have thousands of rows, this might take some time. If you only need the raw data and don't want to update anything, you can do like this to get the raw data.</p><pre><code class="lang-js"><code class="source-code prettyprint">// Are you expecting a massive dataset from the DB,
// and don't want to spend the time building DAOs for each entry?
// You can pass an extra query option to get the raw data instead:
Project.findAll({ where: { ... }, raw: true })</code>
</code></pre><h3><code>count</code> - Count the occurrences of elements in the database</h3><p>There is also a method for counting database objects:</p><pre><code class="lang-js"><code class="source-code prettyprint">Project.count().then(c =&gt; {
  console.log("There are " + c + " projects!")
})

Project.count({ where: {'id': {[Op.gt]: 25}} }).then(c =&gt; {
  console.log("There are " + c + " projects with an id greater than 25.")
})</code>
</code></pre><h3><code>max</code> - Get the greatest value of a specific attribute within a specific table</h3><p>And here is a method for getting the max value of an attribute:f</p><pre><code class="lang-js"><code class="source-code prettyprint">/*
  Let's assume 3 person objects with an attribute age.
  The first one is 10 years old,
  the second one is 5 years old,
  the third one is 40 years old.
*/
Project.max('age').then(max =&gt; {
  // this will return 40
})

Project.max('age', { where: { age: { [Op.lt]: 20 } } }).then(max =&gt; {
  // will be 10
})</code>
</code></pre><h3><code>min</code> - Get the least value of a specific attribute within a specific table</h3><p>And here is a method for getting the min value of an attribute:</p><pre><code class="lang-js"><code class="source-code prettyprint">/*
  Let's assume 3 person objects with an attribute age.
  The first one is 10 years old,
  the second one is 5 years old,
  the third one is 40 years old.
*/
Project.min('age').then(min =&gt; {
  // this will return 5
})

Project.min('age', { where: { age: { [Op.gt]: 5 } } }).then(min =&gt; {
  // will be 10
})</code>
</code></pre><h3><code>sum</code> - Sum the value of specific attributes</h3><p>In order to calculate the sum over a specific column of a table, you can
use the <code>sum</code> method.</p><pre><code class="lang-js"><code class="source-code prettyprint">/*
  Let's assume 3 person objects with an attribute age.
  The first one is 10 years old,
  the second one is 5 years old,
  the third one is 40 years old.
*/
Project.sum('age').then(sum =&gt; {
  // this will return 55
})

Project.sum('age', { where: { age: { [Op.gt]: 5 } } }).then(sum =&gt; {
  // will be 50
})</code>
</code></pre><h2>Eager loading</h2><p>When you are retrieving data from the database there is a fair chance that you also want to get associations with the same query - this is called eager loading. The basic idea behind that, is the use of the attribute <code>include</code> when you are calling <code>find</code> or <code>findAll</code>. Lets assume the following setup:</p><pre><code class="lang-js"><code class="source-code prettyprint">const User = sequelize.define('user', { name: Sequelize.STRING })
const Task = sequelize.define('task', { name: Sequelize.STRING })
const Tool = sequelize.define('tool', { name: Sequelize.STRING })

Task.belongsTo(User)
User.hasMany(Task)
User.hasMany(Tool, { as: 'Instruments' })

sequelize.sync().then(() =&gt; {
  // this is where we continue ...
})</code>
</code></pre><p>OK. So, first of all, let's load all tasks with their associated user.</p><pre><code class="lang-js"><code class="source-code prettyprint">Task.findAll({ include: [ User ] }).then(tasks =&gt; {
  console.log(JSON.stringify(tasks))

  /*
    [{
      "name": "A Task",
      "id": 1,
      "createdAt": "2013-03-20T20:31:40.000Z",
      "updatedAt": "2013-03-20T20:31:40.000Z",
      "userId": 1,
      "user": {
        "name": "John Doe",
        "id": 1,
        "createdAt": "2013-03-20T20:31:45.000Z",
        "updatedAt": "2013-03-20T20:31:45.000Z"
      }
    }]
  */
})</code>
</code></pre><p>Notice that the accessor (the <code>User</code> property in the resulting instance) is singular because the association is one-to-something.</p><p>Next thing: Loading of data with many-to-something associations!</p><pre><code class="lang-js"><code class="source-code prettyprint">User.findAll({ include: [ Task ] }).then(users =&gt; {
  console.log(JSON.stringify(users))

  /*
    [{
      "name": "John Doe",
      "id": 1,
      "createdAt": "2013-03-20T20:31:45.000Z",
      "updatedAt": "2013-03-20T20:31:45.000Z",
      "tasks": [{
        "name": "A Task",
        "id": 1,
        "createdAt": "2013-03-20T20:31:40.000Z",
        "updatedAt": "2013-03-20T20:31:40.000Z",
        "userId": 1
      }]
    }]
  */
})</code>
</code></pre><p>Notice that the accessor (the <code>Tasks</code> property in the resulting instance) is plural because the association is many-to-something.</p><p>If an association is aliased (using the <code>as</code> option), you must specify this alias when including the model. Notice how the user's <code>Tool</code>s are aliased as <code>Instruments</code> above. In order to get that right you have to specify the model you want to load, as well as the alias:</p><pre><code class="lang-js"><code class="source-code prettyprint">User.findAll({ include: [{ model: Tool, as: 'Instruments' }] }).then(users =&gt; {
  console.log(JSON.stringify(users))

  /*
    [{
      "name": "John Doe",
      "id": 1,
      "createdAt": "2013-03-20T20:31:45.000Z",
      "updatedAt": "2013-03-20T20:31:45.000Z",
      "Instruments": [{
        "name": "Toothpick",
        "id": 1,
        "createdAt": null,
        "updatedAt": null,
        "userId": 1
      }]
    }]
  */
})</code>
</code></pre><p>You can also include by alias name by specifying a string that matches the association alias:</p><pre><code class="lang-js"><code class="source-code prettyprint">User.findAll({ include: ['Instruments'] }).then(users =&gt; {
  console.log(JSON.stringify(users))

  /*
    [{
      "name": "John Doe",
      "id": 1,
      "createdAt": "2013-03-20T20:31:45.000Z",
      "updatedAt": "2013-03-20T20:31:45.000Z",
      "Instruments": [{
        "name": "Toothpick",
        "id": 1,
        "createdAt": null,
        "updatedAt": null,
        "userId": 1
      }]
    }]
  */
})

User.findAll({ include: [{ association: 'Instruments' }] }).then(users =&gt; {
  console.log(JSON.stringify(users))

  /*
    [{
      "name": "John Doe",
      "id": 1,
      "createdAt": "2013-03-20T20:31:45.000Z",
      "updatedAt": "2013-03-20T20:31:45.000Z",
      "Instruments": [{
        "name": "Toothpick",
        "id": 1,
        "createdAt": null,
        "updatedAt": null,
        "userId": 1
      }]
    }]
  */
})</code>
</code></pre><p>When eager loading we can also filter the associated model using <code>where</code>. This will return all <code>User</code>s in which the <code>where</code> clause of <code>Tool</code> model matches rows.</p><pre><code class="lang-js"><code class="source-code prettyprint">User.findAll({
    include: [{
        model: Tool,
        as: 'Instruments',
        where: { name: { [Op.like]: '%ooth%' } }
    }]
}).then(users =&gt; {
    console.log(JSON.stringify(users))

    /*
      [{
        "name": "John Doe",
        "id": 1,
        "createdAt": "2013-03-20T20:31:45.000Z",
        "updatedAt": "2013-03-20T20:31:45.000Z",
        "Instruments": [{
          "name": "Toothpick",
          "id": 1,
          "createdAt": null,
          "updatedAt": null,
          "userId": 1
        }]
      }],

      [{
        "name": "John Smith",
        "id": 2,
        "createdAt": "2013-03-20T20:31:45.000Z",
        "updatedAt": "2013-03-20T20:31:45.000Z",
        "Instruments": [{
          "name": "Toothpick",
          "id": 1,
          "createdAt": null,
          "updatedAt": null,
          "userId": 1
        }]
      }],
    */
  })</code>
</code></pre><p>When an eager loaded model is filtered using <code>include.where</code> then <code>include.required</code> is implicitly set to
<code>true</code>. This means that an inner join is done returning parent models with any matching children.</p><h3>Top level where with eagerly loaded models</h3><p>To move the where conditions from an included model from the <code>ON</code> condition to the top level <code>WHERE</code> you can use the <code>'$nested.column$'</code> syntax:</p><pre><code class="lang-js"><code class="source-code prettyprint">User.findAll({
    where: {
        '$Instruments.name$': { [Op.iLike]: '%ooth%' }
    },
    include: [{
        model: Tool,
        as: 'Instruments'
    }]
}).then(users =&gt; {
    console.log(JSON.stringify(users));

    /*
      [{
        "name": "John Doe",
        "id": 1,
        "createdAt": "2013-03-20T20:31:45.000Z",
        "updatedAt": "2013-03-20T20:31:45.000Z",
        "Instruments": [{
          "name": "Toothpick",
          "id": 1,
          "createdAt": null,
          "updatedAt": null,
          "userId": 1
        }]
      }],

      [{
        "name": "John Smith",
        "id": 2,
        "createdAt": "2013-03-20T20:31:45.000Z",
        "updatedAt": "2013-03-20T20:31:45.000Z",
        "Instruments": [{
          "name": "Toothpick",
          "id": 1,
          "createdAt": null,
          "updatedAt": null,
          "userId": 1
        }]
      }],
    */</code>
</code></pre><h3>Including everything</h3><p>To include all attributes, you can pass a single object with <code>all: true</code>:</p><pre><code class="lang-js"><code class="source-code prettyprint">User.findAll({ include: [{ all: true }]});</code>
</code></pre><h3>Including soft deleted records</h3><p>In case you want to eager load soft deleted records you can do that by setting <code>include.paranoid</code> to <code>false</code></p><pre><code class="lang-js"><code class="source-code prettyprint">User.findAll({
    include: [{
        model: Tool,
        where: { name: { [Op.like]: '%ooth%' } },
        paranoid: false // query and loads the soft deleted records
    }]
});</code>
</code></pre><h3>Ordering Eager Loaded Associations</h3><p>In the case of a one-to-many relationship.</p><pre><code class="lang-js"><code class="source-code prettyprint">Company.findAll({ include: [ Division ], order: [ [ Division, 'name' ] ] });
Company.findAll({ include: [ Division ], order: [ [ Division, 'name', 'DESC' ] ] });
Company.findAll({
  include: [ { model: Division, as: 'Div' } ],
  order: [ [ { model: Division, as: 'Div' }, 'name' ] ]
});
Company.findAll({
  include: [ { model: Division, as: 'Div' } ],
  order: [ [ { model: Division, as: 'Div' }, 'name', 'DESC' ] ]
});
Company.findAll({
  include: [ { model: Division, include: [ Department ] } ],
  order: [ [ Division, Department, 'name' ] ]
});</code>
</code></pre><p>In the case of many-to-many joins, you are also able to sort by attributes in the through table.</p><pre><code class="lang-js"><code class="source-code prettyprint">Company.findAll({
  include: [ { model: Division, include: [ Department ] } ],
  order: [ [ Division, DepartmentDivision, 'name' ] ]
});</code>
</code></pre><h3>Nested eager loading</h3><p>You can use nested eager loading to load all related models of a related model:</p><pre><code class="lang-js"><code class="source-code prettyprint">User.findAll({
  include: [
    {model: Tool, as: 'Instruments', include: [
      {model: Teacher, include: [ /* etc */]}
    ]}
  ]
}).then(users =&gt; {
  console.log(JSON.stringify(users))

  /*
    [{
      "name": "John Doe",
      "id": 1,
      "createdAt": "2013-03-20T20:31:45.000Z",
      "updatedAt": "2013-03-20T20:31:45.000Z",
      "Instruments": [{ // 1:M and N:M association
        "name": "Toothpick",
        "id": 1,
        "createdAt": null,
        "updatedAt": null,
        "userId": 1,
        "Teacher": { // 1:1 association
          "name": "Jimi Hendrix"
        }
      }]
    }]
  */
})</code>
</code></pre><p>This will produce an outer join. However, a <code>where</code> clause on a related model will create an inner join and return only the instances that have matching sub-models. To return all parent instances, you should add <code>required: false</code>.</p><pre><code class="lang-js"><code class="source-code prettyprint">User.findAll({
  include: [{
    model: Tool,
    as: 'Instruments',
    include: [{
      model: Teacher,
      where: {
        school: "Woodstock Music School"
      },
      required: false
    }]
  }]
}).then(users =&gt; {
  /* ... */
})</code>
</code></pre><p>The query above will return all users, and all their instruments, but only those teachers associated with <code>Woodstock Music School</code>.</p><p>Include all also supports nested loading:</p><pre><code class="lang-js"><code class="source-code prettyprint">User.findAll({ include: [{ all: true, nested: true }]});</code>
</code></pre></div>
        <a data-ice="link" href="/v4/manual/tutorial/models-usage.html"></a>
      </div>
    </div>
<div class="manual-card-wrap" data-ice="cards">
      <h1 data-ice="label" class="manual-color manual-color-tutorial" data-section-count="■■■■■"><span data-ice="label-inner">Querying</span></h1>
      <div class="manual-card">
        <div data-ice="card"><h1>Querying</h1><h2>Attributes</h2><p>To select only some attributes, you can use the <code>attributes</code> option. Most often, you pass an array:</p><pre><code class="lang-js"><code class="source-code prettyprint">Model.findAll({
  attributes: ['foo', 'bar']
});</code>
</code></pre><pre><code class="lang-sql"><code class="source-code prettyprint">SELECT foo, bar ...</code>
</code></pre><p>Attributes can be renamed using a nested array:</p><pre><code class="lang-js"><code class="source-code prettyprint">Model.findAll({
  attributes: ['foo', ['bar', 'baz']]
});</code>
</code></pre><pre><code class="lang-sql"><code class="source-code prettyprint">SELECT foo, bar AS baz ...</code>
</code></pre><p>You can use <code>sequelize.fn</code> to do aggregations:</p><pre><code class="lang-js"><code class="source-code prettyprint">Model.findAll({
  attributes: [[sequelize.fn('COUNT', sequelize.col('hats')), 'no_hats']]
});</code>
</code></pre><pre><code class="lang-sql"><code class="source-code prettyprint">SELECT COUNT(hats) AS no_hats ...</code>
</code></pre><p>When using aggregation function, you must give it an alias to be able to access it from the model. In the example above you can get the number of hats with <code>instance.get('no_hats')</code>.</p><p>Sometimes it may be tiresome to list all the attributes of the model if you only want to add an aggregation:</p><pre><code class="lang-js"><code class="source-code prettyprint">// This is a tiresome way of getting the number of hats...
Model.findAll({
  attributes: ['id', 'foo', 'bar', 'baz', 'quz', [sequelize.fn('COUNT', sequelize.col('hats')), 'no_hats']]
});

// This is shorter, and less error prone because it still works if you add / remove attributes
Model.findAll({
  attributes: { include: [[sequelize.fn('COUNT', sequelize.col('hats')), 'no_hats']] }
});</code>
</code></pre><pre><code class="lang-sql"><code class="source-code prettyprint">SELECT id, foo, bar, baz, quz, COUNT(hats) AS no_hats ...</code>
</code></pre><p>Similarly, it's also possible to remove a selected few attributes:</p><pre><code class="lang-js"><code class="source-code prettyprint">Model.findAll({
  attributes: { exclude: ['baz'] }
});</code>
</code></pre><pre><code class="lang-sql"><code class="source-code prettyprint">SELECT id, foo, bar, quz ...</code>
</code></pre><h2>Where</h2><p>Whether you are querying with findAll/find or doing bulk updates/destroys you can pass a <code>where</code> object to filter the query.</p><p><code>where</code> generally takes an object from attribute:value pairs, where value can be primitives for equality matches or keyed objects for other operators.</p><p>It's also possible to generate complex AND/OR conditions by nesting sets of <code>or</code> and <code>and</code> <code>Operators</code>.</p><h3>Basics</h3><pre><code class="lang-js"><code class="source-code prettyprint">const Op = Sequelize.Op;

Post.findAll({
  where: {
    authorId: 2
  }
});
// SELECT * FROM post WHERE authorId = 2

Post.findAll({
  where: {
    authorId: 12,
    status: 'active'
  }
});
// SELECT * FROM post WHERE authorId = 12 AND status = 'active';

Post.findAll({
  where: {
    [Op.or]: [{authorId: 12}, {authorId: 13}]
  }
});
// SELECT * FROM post WHERE authorId = 12 OR authorId = 13;

Post.findAll({
  where: {
    authorId: {
      [Op.or]: [12, 13]
    }
  }
});
// SELECT * FROM post WHERE authorId = 12 OR authorId = 13;

Post.destroy({
  where: {
    status: 'inactive'
  }
});
// DELETE FROM post WHERE status = 'inactive';

Post.update({
  updatedAt: null,
}, {
  where: {
    deletedAt: {
      [Op.ne]: null
    }
  }
});
// UPDATE post SET updatedAt = null WHERE deletedAt NOT NULL;

Post.findAll({
  where: sequelize.where(sequelize.fn('char_length', sequelize.col('status')), 6)
});
// SELECT * FROM post WHERE char_length(status) = 6;</code>
</code></pre><h3>Operators</h3><p>Sequelize exposes symbol operators that can be used for to create more complex comparisons -</p><pre><code class="lang-js"><code class="source-code prettyprint">const Op = Sequelize.Op

[Op.and]: {a: 5}           // AND (a = 5)
[Op.or]: [{a: 5}, {a: 6}]  // (a = 5 OR a = 6)
[Op.gt]: 6,                // &gt; 6
[Op.gte]: 6,               // &gt;= 6
[Op.lt]: 10,               // &lt; 10
[Op.lte]: 10,              // &lt;= 10
[Op.ne]: 20,               // != 20
[Op.eq]: 3,                // = 3
[Op.not]: true,            // IS NOT TRUE
[Op.between]: [6, 10],     // BETWEEN 6 AND 10
[Op.notBetween]: [11, 15], // NOT BETWEEN 11 AND 15
[Op.in]: [1, 2],           // IN [1, 2]
[Op.notIn]: [1, 2],        // NOT IN [1, 2]
[Op.like]: '%hat',         // LIKE '%hat'
[Op.notLike]: '%hat'       // NOT LIKE '%hat'
[Op.iLike]: '%hat'         // ILIKE '%hat' (case insensitive) (PG only)
[Op.notILike]: '%hat'      // NOT ILIKE '%hat'  (PG only)
[Op.regexp]: '^[h|a|t]'    // REGEXP/~ '^[h|a|t]' (MySQL/PG only)
[Op.notRegexp]: '^[h|a|t]' // NOT REGEXP/!~ '^[h|a|t]' (MySQL/PG only)
[Op.iRegexp]: '^[h|a|t]'    // ~* '^[h|a|t]' (PG only)
[Op.notIRegexp]: '^[h|a|t]' // !~* '^[h|a|t]' (PG only)
[Op.like]: { [Op.any]: ['cat', 'hat']}
                       // LIKE ANY ARRAY['cat', 'hat'] - also works for iLike and notLike
[Op.overlap]: [1, 2]       // &amp;&amp; [1, 2] (PG array overlap operator)
[Op.contains]: [1, 2]      // @&gt; [1, 2] (PG array contains operator)
[Op.contained]: [1, 2]     // &lt;@ [1, 2] (PG array contained by operator)
[Op.any]: [2,3]            // ANY ARRAY[2, 3]::INTEGER (PG only)

[Op.col]: 'user.organization_id' // = "user"."organization_id", with dialect specific column identifiers, PG in this example</code>
</code></pre><h4>Range Operators</h4><p>Range types can be queried with all supported operators.</p><p>Keep in mind, the provided range value can
<a href="/v4/manual/tutorial/models-definition.html#range-types">define the bound inclusion/exclusion</a>
as well.</p><pre><code class="lang-js"><code class="source-code prettyprint">// All the above equality and inequality operators plus the following:

[Op.contains]: 2           // @&gt; '2'::integer (PG range contains element operator)
[Op.contains]: [1, 2]      // @&gt; [1, 2) (PG range contains range operator)
[Op.contained]: [1, 2]     // &lt;@ [1, 2) (PG range is contained by operator)
[Op.overlap]: [1, 2]       // &amp;&amp; [1, 2) (PG range overlap (have points in common) operator)
[Op.adjacent]: [1, 2]      // -|- [1, 2) (PG range is adjacent to operator)
[Op.strictLeft]: [1, 2]    // &lt;&lt; [1, 2) (PG range strictly left of operator)
[Op.strictRight]: [1, 2]   // &gt;&gt; [1, 2) (PG range strictly right of operator)
[Op.noExtendRight]: [1, 2] // &amp;&lt; [1, 2) (PG range does not extend to the right of operator)
[Op.noExtendLeft]: [1, 2]  // &amp;&gt; [1, 2) (PG range does not extend to the left of operator)</code>
</code></pre><h4>Combinations</h4><pre><code class="lang-js"><code class="source-code prettyprint">const Op = Sequelize.Op;

{
  rank: {
    [Op.or]: {
      [Op.lt]: 1000,
      [Op.eq]: null
    }
  }
}
// rank &lt; 1000 OR rank IS NULL

{
  createdAt: {
    [Op.lt]: new Date(),
    [Op.gt]: new Date(new Date() - 24 * 60 * 60 * 1000)
  }
}
// createdAt &lt; [timestamp] AND createdAt &gt; [timestamp]

{
  [Op.or]: [
    {
      title: {
        [Op.like]: 'Boat%'
      }
    },
    {
      description: {
        [Op.like]: '%boat%'
      }
    }
  ]
}
// title LIKE 'Boat%' OR description LIKE '%boat%'</code>
</code></pre><h4>Operators Aliases</h4><p>Sequelize allows setting specific strings as aliases for operators -</p><pre><code class="lang-js"><code class="source-code prettyprint">const Op = Sequelize.Op;
const operatorsAliases = {
  $gt: Op.gt
}
const connection = new Sequelize(db, user, pass, { operatorsAliases })

[Op.gt]: 6 // &gt; 6
$gt: 6 // same as using Op.gt (&gt; 6)</code>
</code></pre><h4>Operators security</h4><p>Using Sequelize without any aliases improves security.
Some frameworks automatically parse user input into js objects and if you fail to sanitize your input it might be possible to inject an Object with string operators to Sequelize.</p><p>Not having any string aliases will make it extremely unlikely that operators could be injected but you should always properly validate and sanitize user input.</p><p>For backward compatibility reasons Sequelize sets the following aliases by default -
$eq, $ne, $gte, $gt, $lte, $lt, $not, $in, $notIn, $is, $like, $notLike, $iLike, $notILike, $regexp, $notRegexp, $iRegexp, $notIRegexp, $between, $notBetween, $overlap, $contains, $contained, $adjacent, $strictLeft, $strictRight, $noExtendRight, $noExtendLeft, $and, $or, $any, $all, $values, $col</p><p>Currently the following legacy aliases are also set but are planned to be fully removed in the near future -
ne, not, in, notIn, gte, gt, lte, lt, like, ilike, $ilike, nlike, $notlike, notilike, .., between, !.., notbetween, nbetween, overlap, &amp;&amp;, @&gt;, &lt;@</p><p>For better security it is highly advised to use <code>Sequelize.Op</code> and not depend on any string alias at all. You can limit alias your application will need by setting <code>operatorsAliases</code> option, remember to sanitize user input especially when you are directly passing them to Sequelize methods.</p><pre><code class="lang-js"><code class="source-code prettyprint">const Op = Sequelize.Op;

//use sequelize without any operators aliases
const connection = new Sequelize(db, user, pass, { operatorsAliases: false });

//use sequelize with only alias for $and =&gt; Op.and
const connection2 = new Sequelize(db, user, pass, { operatorsAliases: { $and: Op.and } });</code>
</code></pre><p>Sequelize will warn you if you're using the default aliases and not limiting them
if you want to keep using all default aliases (excluding legacy ones) without the warning you can pass the following operatorsAliases option -</p><pre><code class="lang-js"><code class="source-code prettyprint">const Op = Sequelize.Op;
const operatorsAliases = {
  $eq: Op.eq,
  $ne: Op.ne,
  $gte: Op.gte,
  $gt: Op.gt,
  $lte: Op.lte,
  $lt: Op.lt,
  $not: Op.not,
  $in: Op.in,
  $notIn: Op.notIn,
  $is: Op.is,
  $like: Op.like,
  $notLike: Op.notLike,
  $iLike: Op.iLike,
  $notILike: Op.notILike,
  $regexp: Op.regexp,
  $notRegexp: Op.notRegexp,
  $iRegexp: Op.iRegexp,
  $notIRegexp: Op.notIRegexp,
  $between: Op.between,
  $notBetween: Op.notBetween,
  $overlap: Op.overlap,
  $contains: Op.contains,
  $contained: Op.contained,
  $adjacent: Op.adjacent,
  $strictLeft: Op.strictLeft,
  $strictRight: Op.strictRight,
  $noExtendRight: Op.noExtendRight,
  $noExtendLeft: Op.noExtendLeft,
  $and: Op.and,
  $or: Op.or,
  $any: Op.any,
  $all: Op.all,
  $values: Op.values,
  $col: Op.col
};

const connection = new Sequelize(db, user, pass, { operatorsAliases });</code>
</code></pre><h3>JSON</h3><p>The JSON data type is supported by the PostgreSQL, SQLite and MySQL dialects only. </p><h4>PostgreSQL</h4><p>The JSON data type in PostgreSQL stores the value as plain text, as opposed to binary representation. If you simply want to store and retrieve a JSON representation, using JSON will take less disk space and less time to build from its input representation. However, if you want to do any operations on the JSON value, you should prefer the JSONB data type described below.</p><h4>MSSQL</h4><p>MSSQL does not have a JSON data type, however it does provide support for JSON stored as strings through certain functions since SQL Server 2016. Using these functions, you will be able to query the JSON stored in the string, but any returned values will need to be parsed separately. </p><pre><code class="lang-js"><code class="source-code prettyprint">// ISJSON - to test if a string contains valid JSON
User.findAll({
  where: sequelize.where(sequelize.fn('ISJSON', sequelize.col('userDetails')), 1)
})

// JSON_VALUE - extract a scalar value from a JSON string
User.findAll({
  attributes: [[ sequelize.fn('JSON_VALUE', sequelize.col('userDetails'), '$.address.Line1'), 'address line 1']]
})

// JSON_VALUE - query a scalar value from a JSON string
User.findAll({
  where: sequelize.where(sequelize.fn('JSON_VALUE', sequelize.col('userDetails'), '$.address.Line1'), '14, Foo Street')
})

// JSON_QUERY - extract an object or array
User.findAll({
  attributes: [[ sequelize.fn('JSON_QUERY', sequelize.col('userDetails'), '$.address'), 'full address']]
})</code>
</code></pre><h3>JSONB</h3><p>JSONB can be queried in three different ways.</p><h4>Nested object</h4><pre><code class="lang-js"><code class="source-code prettyprint">{
  meta: {
    video: {
      url: {
        [Op.ne]: null
      }
    }
  }
}</code>
</code></pre><h4>Nested key</h4><pre><code class="lang-js"><code class="source-code prettyprint">{
  "meta.audio.length": {
    [Op.gt]: 20
  }
}</code>
</code></pre><h4>Containment</h4><pre><code class="lang-js"><code class="source-code prettyprint">{
  "meta": {
    [Op.contains]: {
      site: {
        url: 'http://google.com'
      }
    }
  }
}</code>
</code></pre><h3>Relations / Associations</h3><pre><code class="lang-js"><code class="source-code prettyprint">// Find all projects with a least one task where task.state === project.state
Project.findAll({
    include: [{
        model: Task,
        where: { state: Sequelize.col('project.state') }
    }]
})</code>
</code></pre><h2>Pagination / Limiting</h2><pre><code class="lang-js"><code class="source-code prettyprint">// Fetch 10 instances/rows
Project.findAll({ limit: 10 })

// Skip 8 instances/rows
Project.findAll({ offset: 8 })

// Skip 5 instances and fetch the 5 after that
Project.findAll({ offset: 5, limit: 5 })</code>
</code></pre><h2>Ordering</h2><p><code>order</code> takes an array of items to order the query by or a sequelize method. Generally you will want to use a tuple/array of either attribute, direction or just direction to ensure proper escaping.</p><pre><code class="lang-js"><code class="source-code prettyprint">Subtask.findAll({
  order: [
    // Will escape title and validate DESC against a list of valid direction parameters
    ['title', 'DESC'],

    // Will order by max(age)
    sequelize.fn('max', sequelize.col('age')),

    // Will order by max(age) DESC
    [sequelize.fn('max', sequelize.col('age')), 'DESC'],

    // Will order by  otherfunction(`col1`, 12, 'lalala') DESC
    [sequelize.fn('otherfunction', sequelize.col('col1'), 12, 'lalala'), 'DESC'],

    // Will order an associated model's created_at using the model name as the association's name.
    [Task, 'createdAt', 'DESC'],

    // Will order through an associated model's created_at using the model names as the associations' names.
    [Task, Project, 'createdAt', 'DESC'],

    // Will order by an associated model's created_at using the name of the association.
    ['Task', 'createdAt', 'DESC'],

    // Will order by a nested associated model's created_at using the names of the associations.
    ['Task', 'Project', 'createdAt', 'DESC'],

    // Will order by an associated model's created_at using an association object. (preferred method)
    [Subtask.associations.Task, 'createdAt', 'DESC'],

    // Will order by a nested associated model's created_at using association objects. (preferred method)
    [Subtask.associations.Task, Task.associations.Project, 'createdAt', 'DESC'],

    // Will order by an associated model's created_at using a simple association object.
    [{model: Task, as: 'Task'}, 'createdAt', 'DESC'],

    // Will order by a nested associated model's created_at simple association objects.
    [{model: Task, as: 'Task'}, {model: Project, as: 'Project'}, 'createdAt', 'DESC']
  ]

  // Will order by max age descending
  order: sequelize.literal('max(age) DESC')

  // Will order by max age ascending assuming ascending is the default order when direction is omitted
  order: sequelize.fn('max', sequelize.col('age'))

  // Will order by age ascending assuming ascending is the default order when direction is omitted
  order: sequelize.col('age')

  // Will order randomly based on the dialect (instead of fn('RAND') or fn('RANDOM'))
  order: sequelize.random()
})</code>
</code></pre><h2>Table Hint</h2><p><code>tableHint</code> can be used to optionally pass a table hint when using mssql. The hint must be a value from <code>Sequelize.TableHints</code> and should only be used when absolutely necessary. Only a single table hint is currently supported per query. </p><p>Table hints override the default behavior of mssql query optimizer by specifying certain options. They only affect the table or view referenced in that clause.</p><pre><code class="lang-js"><code class="source-code prettyprint">const TableHints = Sequelize.TableHints;

Project.findAll({
  // adding the table hint NOLOCK
  tableHint: TableHints.NOLOCK
  // this will generate the SQL 'WITH (NOLOCK)'
})</code>
</code></pre></div>
        <a data-ice="link" href="/v4/manual/tutorial/querying.html"></a>
      </div>
    </div>
<div class="manual-card-wrap" data-ice="cards">
      <h1 data-ice="label" class="manual-color manual-color-tutorial" data-section-count="■■■"><span data-ice="label-inner">Instances</span></h1>
      <div class="manual-card">
        <div data-ice="card"><h1>Instances</h1><h2>Building a non-persistent instance</h2><p>In order to create instances of defined classes just do as follows. You might recognize the syntax if you coded Ruby in the past. Using the <code>build</code>-method will return an unsaved object, which you explicitly have to save.</p><pre><code class="lang-js"><code class="source-code prettyprint">const project = Project.build({
  title: 'my awesome project',
  description: 'woot woot. this will make me a rich man'
})

const task = Task.build({
  title: 'specify the project idea',
  description: 'bla',
  deadline: new Date()
})</code>
</code></pre><p>Built instances will automatically get default values when they were defined:</p><pre><code class="lang-js"><code class="source-code prettyprint">// first define the model
const Task = sequelize.define('task', {
  title: Sequelize.STRING,
  rating: { type: Sequelize.STRING, defaultValue: 3 }
})

// now instantiate an object
const task = Task.build({title: 'very important task'})

task.title  // ==&gt; 'very important task'
task.rating // ==&gt; 3</code>
</code></pre><p>To get it stored in the database, use the <code>save</code>-method and catch the events ... if needed:</p><pre><code class="lang-js"><code class="source-code prettyprint">project.save().then(() =&gt; {
  // my nice callback stuff
})

task.save().catch(error =&gt; {
  // mhhh, wth!
})

// you can also build, save and access the object with chaining:
Task
  .build({ title: 'foo', description: 'bar', deadline: new Date() })
  .save()
  .then(anotherTask =&gt; {
    // you can now access the currently saved task with the variable anotherTask... nice!
  })
  .catch(error =&gt; {
    // Ooops, do some error-handling
  })</code>
</code></pre><h2>Creating persistent instances</h2><p>While an instance created with <code>.build()</code> requires an explicit <code>.save()</code> call to be stored in the database, <code>.create()</code> omits that requirement altogether and automatically stores your instance's data once called.</p><pre><code class="lang-js"><code class="source-code prettyprint">Task.create({ title: 'foo', description: 'bar', deadline: new Date() }).then(task =&gt; {
  // you can now access the newly created task via the variable task
})</code>
</code></pre><p>It is also possible to define which attributes can be set via the create method. This can be especially very handy if you create database entries based on a form which can be filled by a user. Using that would for example allow you to restrict the <code>User</code> model to set only a username and an address but not an admin flag:</p><pre><code class="lang-js"><code class="source-code prettyprint">User.create({ username: 'barfooz', isAdmin: true }, { fields: [ 'username' ] }).then(user =&gt; {
  // let's assume the default of isAdmin is false:
  console.log(user.get({
    plain: true
  })) // =&gt; { username: 'barfooz', isAdmin: false }
})</code>
</code></pre><h2>Updating / Saving / Persisting an instance</h2><p>Now lets change some values and save changes to the database... There are two ways to do that:</p><pre><code class="lang-js"><code class="source-code prettyprint">// way 1
task.title = 'a very different title now'
task.save().then(() =&gt; {})

// way 2
task.update({
  title: 'a very different title now'
}).then(() =&gt; {})</code>
</code></pre><p>It's also possible to define which attributes should be saved when calling <code>save</code>, by passing an array of column names. This is useful when you set attributes based on a previously defined object. E.g. if you get the values of an object via a form of a web app. Furthermore this is used internally for <code>update</code>. This is how it looks like:</p><pre><code class="lang-js"><code class="source-code prettyprint">task.title = 'foooo'
task.description = 'baaaaaar'
task.save({fields: ['title']}).then(() =&gt; {
 // title will now be 'foooo' but description is the very same as before
})

// The equivalent call using update looks like this:
task.update({ title: 'foooo', description: 'baaaaaar'}, {fields: ['title']}).then(() =&gt; {
 // title will now be 'foooo' but description is the very same as before
})</code>
</code></pre><p>When you call <code>save</code> without changing any attribute, this method will execute nothing;</p><h2>Destroying / Deleting persistent instances</h2><p>Once you created an object and got a reference to it, you can delete it from the database. The relevant method is <code>destroy</code>:</p><pre><code class="lang-js"><code class="source-code prettyprint">Task.create({ title: 'a task' }).then(task =&gt; {
  // now you see me...
  return task.destroy();
}).then(() =&gt; {
 // now i'm gone :)
})</code>
</code></pre><p>If the <code>paranoid</code> options is true, the object will not be deleted, instead the <code>deletedAt</code> column will be set to the current timestamp. To force the deletion, you can pass <code>force: true</code> to the destroy call:</p><pre><code class="lang-js"><code class="source-code prettyprint">task.destroy({ force: true })</code>
</code></pre><h2>Working in bulk (creating, updating and destroying multiple rows at once)</h2><p>In addition to updating a single instance, you can also create, update, and delete multiple instances at once. The functions you are looking for are called</p><ul>
<li><code>Model.bulkCreate</code></li>
<li><code>Model.update</code></li>
<li><code>Model.destroy</code></li>
</ul><p>Since you are working with multiple models, the callbacks will not return DAO instances. BulkCreate will return an array of model instances/DAOs, they will however, unlike <code>create</code>, not have the resulting values of autoIncrement attributes.<code>update</code> and <code>destroy</code> will return the number of affected rows.</p><p>First lets look at bulkCreate</p><pre><code class="lang-js"><code class="source-code prettyprint">User.bulkCreate([
  { username: 'barfooz', isAdmin: true },
  { username: 'foo', isAdmin: true },
  { username: 'bar', isAdmin: false }
]).then(() =&gt; { // Notice: There are no arguments here, as of right now you'll have to...
  return User.findAll();
}).then(users =&gt; {
  console.log(users) // ... in order to get the array of user objects
})</code>
</code></pre><p>To update several rows at once:</p><pre><code class="lang-js"><code class="source-code prettyprint">Task.bulkCreate([
  {subject: 'programming', status: 'executing'},
  {subject: 'reading', status: 'executing'},
  {subject: 'programming', status: 'finished'}
]).then(() =&gt; {
  return Task.update(
    { status: 'inactive' }, /* set attributes' value */
    { where: { subject: 'programming' }} /* where criteria */
  );
}).spread((affectedCount, affectedRows) =&gt; {
  // .update returns two values in an array, therefore we use .spread
  // Notice that affectedRows will only be defined in dialects which support returning: true

  // affectedCount will be 2
  return Task.findAll();
}).then(tasks =&gt; {
  console.log(tasks) // the 'programming' tasks will both have a status of 'inactive'
})</code>
</code></pre><p>And delete them:</p><pre><code class="lang-js"><code class="source-code prettyprint">Task.bulkCreate([
  {subject: 'programming', status: 'executing'},
  {subject: 'reading', status: 'executing'},
  {subject: 'programming', status: 'finished'}
]).then(() =&gt; {
  return Task.destroy({
    where: {
      subject: 'programming'
    },
    truncate: true /* this will ignore where and truncate the table instead */
  });
}).then(affectedRows =&gt; {
  // affectedRows will be 2
  return Task.findAll();
}).then(tasks =&gt; {
  console.log(tasks) // no programming, just reading :(
})</code>
</code></pre><p>If you are accepting values directly from the user, it might be beneficial to limit the columns that you want to actually insert.<code>bulkCreate()</code>accepts an options object as the second parameter. The object can have a <code>fields</code> parameter, (an array) to let it know which fields you want to build explicitly</p><pre><code class="lang-js"><code class="source-code prettyprint">User.bulkCreate([
  { username: 'foo' },
  { username: 'bar', admin: true}
], { fields: ['username'] }).then(() =&gt; {
  // nope bar, you can't be admin!
})</code>
</code></pre><p><code>bulkCreate</code> was originally made to be a mainstream/fast way of inserting records, however, sometimes you want the luxury of being able to insert multiple rows at once without sacrificing model validations even when you explicitly tell Sequelize which columns to sift through. You can do by adding a <code>validate: true</code> property to the options object.</p><pre><code class="lang-js"><code class="source-code prettyprint">const Tasks = sequelize.define('task', {
  name: {
    type: Sequelize.STRING,
    validate: {
      notNull: { args: true, msg: 'name cannot be null' }
    }
  },
  code: {
    type: Sequelize.STRING,
    validate: {
      len: [3, 10]
    }
  }
})

Tasks.bulkCreate([
  {name: 'foo', code: '123'},
  {code: '1234'},
  {name: 'bar', code: '1'}
], { validate: true }).catch(errors =&gt; {
  /* console.log(errors) would look like:
  [
    { record:
    ...
    name: 'SequelizeBulkRecordError',
    message: 'Validation error',
    errors:
      { name: 'SequelizeValidationError',
        message: 'Validation error',
        errors: [Object] } },
    { record:
      ...
      name: 'SequelizeBulkRecordError',
      message: 'Validation error',
      errors:
        { name: 'SequelizeValidationError',
        message: 'Validation error',
        errors: [Object] } }
  ]
  */
})</code>
</code></pre><h2>Values of an instance</h2><p>If you log an instance you will notice, that there is a lot of additional stuff. In order to hide such stuff and reduce it to the very interesting information, you can use the<code>get</code>-attribute. Calling it with the option <code>plain</code> = true will only return the values of an instance.</p><pre><code class="lang-js"><code class="source-code prettyprint">Person.create({
  name: 'Rambow',
  firstname: 'John'
}).then(john =&gt; {
  console.log(john.get({
    plain: true
  }))
})

// result:

// { name: 'Rambow',
//   firstname: 'John',
//   id: 1,
//   createdAt: Tue, 01 May 2012 19:12:16 GMT,
//   updatedAt: Tue, 01 May 2012 19:12:16 GMT
// }</code>
</code></pre><p><strong>Hint:</strong>You can also transform an instance into JSON by using <code>JSON.stringify(instance)</code>. This will basically return the very same as <code>values</code>.</p><h2>Reloading instances</h2><p>If you need to get your instance in sync, you can use the method<code>reload</code>. It will fetch the current data from the database and overwrite the attributes of the model on which the method has been called on.</p><pre><code class="lang-js"><code class="source-code prettyprint">Person.findOne({ where: { name: 'john' } }).then(person =&gt; {
  person.name = 'jane'
  console.log(person.name) // 'jane'

  person.reload().then(() =&gt; {
    console.log(person.name) // 'john'
  })
})</code>
</code></pre><h2>Incrementing</h2><p>In order to increment values of an instance without running into concurrency issues, you may use <code>increment</code>.</p><p>First of all you can define a field and the value you want to add to it.</p><pre><code class="lang-js"><code class="source-code prettyprint">User.findById(1).then(user =&gt; {
  return user.increment('my-integer-field', {by: 2})
}).then(user =&gt; {
  // Postgres will return the updated user by default (unless disabled by setting { returning: false })
  // In other dialects, you'll want to call user.reload() to get the updated instance...
})</code>
</code></pre><p>Second, you can define multiple fields and the value you want to add to them.</p><pre><code class="lang-js"><code class="source-code prettyprint">User.findById(1).then(user =&gt; {
  return user.increment([ 'my-integer-field', 'my-very-other-field' ], {by: 2})
}).then(/* ... */)</code>
</code></pre><p>Third, you can define an object containing fields and its increment values.</p><pre><code class="lang-js"><code class="source-code prettyprint">User.findById(1).then(user =&gt; {
  return user.increment({
    'my-integer-field':    2,
    'my-very-other-field': 3
  })
}).then(/* ... */)</code>
</code></pre><h2>Decrementing</h2><p>In order to decrement values of an instance without running into concurrency issues, you may use <code>decrement</code>.</p><p>First of all you can define a field and the value you want to add to it.</p><pre><code class="lang-js"><code class="source-code prettyprint">User.findById(1).then(user =&gt; {
  return user.decrement('my-integer-field', {by: 2})
}).then(user =&gt; {
  // Postgres will return the updated user by default (unless disabled by setting { returning: false })
  // In other dialects, you'll want to call user.reload() to get the updated instance...
})</code>
</code></pre><p>Second, you can define multiple fields and the value you want to add to them.</p><pre><code class="lang-js"><code class="source-code prettyprint">User.findById(1).then(user =&gt; {
  return user.decrement([ 'my-integer-field', 'my-very-other-field' ], {by: 2})
}).then(/* ... */)</code>
</code></pre><p>Third, you can define an object containing fields and its decrement values.</p><pre><code class="lang-js"><code class="source-code prettyprint">User.findById(1).then(user =&gt; {
  return user.decrement({
    'my-integer-field':    2,
    'my-very-other-field': 3
  })
}).then(/* ... */)</code>
</code></pre></div>
        <a data-ice="link" href="/v4/manual/tutorial/instances.html"></a>
      </div>
    </div>
<div class="manual-card-wrap" data-ice="cards">
      <h1 data-ice="label" class="manual-color manual-color-tutorial" data-section-count="■■■■■"><span data-ice="label-inner">Associations</span></h1>
      <div class="manual-card">
        <div data-ice="card"><h1>Associations</h1><p>This section describes the various association types in sequelize. When calling a method such as <code>User.hasOne(Project)</code>, we say that the <code>User</code> model (the model that the function is being invoked on) is the <strong>source</strong> and the <code>Project</code> model (the model being passed as an argument) is the <strong>target</strong>.</p><h2>One-To-One associations</h2><p>One-To-One associations are associations between exactly two models connected by a single foreign key.</p><h3>BelongsTo</h3><p>BelongsTo associations are associations where the foreign key for the one-to-one relation exists on the <strong>source model</strong>.</p><p>A simple example would be a <strong>Player</strong> being part of a <strong>Team</strong> with the foreign key on the player.</p><pre><code class="lang-js"><code class="source-code prettyprint">const Player = this.sequelize.define('player', {/* attributes */});
const Team  = this.sequelize.define('team', {/* attributes */});

Player.belongsTo(Team); // Will add a teamId attribute to Player to hold the primary key value for Team</code>
</code></pre><h4>Foreign keys</h4><p>By default the foreign key for a belongsTo relation will be generated from the target model name and the target primary key name.</p><p>The default casing is <code>camelCase</code> however if the source model is configured with <code>underscored: true</code> the foreignKey will be <code>snake_case</code>.</p><pre><code class="lang-js"><code class="source-code prettyprint">const User = this.sequelize.define('user', {/* attributes */})
const Company  = this.sequelize.define('company', {/* attributes */});

User.belongsTo(Company); // Will add companyId to user

const User = this.sequelize.define('user', {/* attributes */}, {underscored: true})
const Company  = this.sequelize.define('company', {
  uuid: {
    type: Sequelize.UUID,
    primaryKey: true
  }
});

User.belongsTo(Company); // Will add company_uuid to user</code>
</code></pre><p>In cases where <code>as</code> has been defined it will be used in place of the target model name.</p><pre><code class="lang-js"><code class="source-code prettyprint">const User = this.sequelize.define('user', {/* attributes */})
const UserRole  = this.sequelize.define('userRole', {/* attributes */});

User.belongsTo(UserRole, {as: 'role'}); // Adds roleId to user rather than userRoleId</code>
</code></pre><p>In all cases the default foreign key can be overwritten with the <code>foreignKey</code> option.
When the foreign key option is used, Sequelize will use it as-is:</p><pre><code class="lang-js"><code class="source-code prettyprint">const User = this.sequelize.define('user', {/* attributes */})
const Company  = this.sequelize.define('company', {/* attributes */});

User.belongsTo(Company, {foreignKey: 'fk_company'}); // Adds fk_company to User</code>
</code></pre><h4>Target keys</h4><p>The target key is the column on the target model that the foreign key column on the source model points to. By default the target key for a belongsTo relation will be the target model's primary key. To define a custom column, use the <code>targetKey</code> option.</p><pre><code class="lang-js"><code class="source-code prettyprint">const User = this.sequelize.define('user', {/* attributes */})
const Company  = this.sequelize.define('company', {/* attributes */});

User.belongsTo(Company, {foreignKey: 'fk_companyname', targetKey: 'name'}); // Adds fk_companyname to User</code>
</code></pre><h3>HasOne</h3><p>HasOne associations are associations where the foreign key for the one-to-one relation exists on the <strong>target model</strong>.</p><pre><code class="lang-js"><code class="source-code prettyprint">const User = sequelize.define('user', {/* ... */})
const Project = sequelize.define('project', {/* ... */})

// One-way associations
Project.hasOne(User)

/*
  In this example hasOne will add an attribute projectId to the User model!
  Furthermore, Project.prototype will gain the methods getUser and setUser according
  to the first parameter passed to define. If you have underscore style
  enabled, the added attribute will be project_id instead of projectId.

  The foreign key will be placed on the users table.

  You can also define the foreign key, e.g. if you already have an existing
  database and want to work on it:
*/

Project.hasOne(User, { foreignKey: 'initiator_id' })

/*
  Because Sequelize will use the model's name (first parameter of define) for
  the accessor methods, it is also possible to pass a special option to hasOne:
*/

Project.hasOne(User, { as: 'Initiator' })
// Now you will get Project.getInitiator and Project.setInitiator

// Or let's define some self references
const Person = sequelize.define('person', { /* ... */})

Person.hasOne(Person, {as: 'Father'})
// this will add the attribute FatherId to Person

// also possible:
Person.hasOne(Person, {as: 'Father', foreignKey: 'DadId'})
// this will add the attribute DadId to Person

// In both cases you will be able to do:
Person.setFather
Person.getFather

// If you need to join a table twice you can double join the same table
Team.hasOne(Game, {as: 'HomeTeam', foreignKey : 'homeTeamId'});
Team.hasOne(Game, {as: 'AwayTeam', foreignKey : 'awayTeamId'});

Game.belongsTo(Team);</code>
</code></pre><p>Even though it is called a HasOne association, for most 1:1 relations you usually want the BelongsTo association since BelongsTo will add the foreignKey on the source where hasOne will add on the target.</p><h3>Difference between HasOne and BelongsTo</h3><p>In Sequelize 1:1 relationship can be set using HasOne and BelongsTo. They are suitable for different scenarios. Lets study this difference using an example.</p><p>Suppose we have two tables to link <strong>Player</strong> and <strong>Team</strong>. Lets define their models.</p><pre><code class="lang-js"><code class="source-code prettyprint">const Player = this.sequelize.define('player', {/* attributes */})
const Team  = this.sequelize.define('team', {/* attributes */});</code>
</code></pre><p>When we link two models in Sequelize we can refer them as pairs of <strong>source</strong> and <strong>target</strong> models. Like this</p><p>Having <strong>Player</strong> as the <strong>source</strong> and <strong>Team</strong> as the <strong>target</strong></p><pre><code class="lang-js"><code class="source-code prettyprint">Player.belongsTo(Team);
//Or
Player.hasOne(Team);</code>
</code></pre><p>Having <strong>Team</strong> as the <strong>source</strong> and <strong>Player</strong> as the <strong>target</strong></p><pre><code class="lang-js"><code class="source-code prettyprint">Team.belongsTo(Player);
//Or
Team.hasOne(Player);</code>
</code></pre><p>HasOne and BelongsTo insert the association key in different models from each other. HasOne inserts the association key in <strong>target</strong> model whereas BelongsTo inserts the association key in the <strong>source</strong> model.</p><p>Here is an example demonstrating use cases of BelongsTo and HasOne.</p><pre><code class="lang-js"><code class="source-code prettyprint">const Player = this.sequelize.define('player', {/* attributes */})
const Coach  = this.sequelize.define('coach', {/* attributes */})
const Team  = this.sequelize.define('team', {/* attributes */});</code>
</code></pre><p>Suppose our <code>Player</code> model has information about its team as <code>teamId</code> column. Information about each Team's <code>Coach</code> is stored in the <code>Team</code> model as <code>coachId</code> column. These both scenarios requires different kind of 1:1 relation because foreign key relation is present on different models each time.</p><p>When information about association is present in <strong>source</strong> model we can use <code>belongsTo</code>. In this case <code>Player</code> is suitable for <code>belongsTo</code> because it has <code>teamId</code> column.</p><pre><code class="lang-js"><code class="source-code prettyprint">Player.belongsTo(Team)  // `teamId` will be added on Player / Source model</code>
</code></pre><p>When information about association is present in <strong>target</strong> model we can use <code>hasOne</code>. In this case <code>Coach</code> is suitable for <code>hasOne</code> because <code>Team</code> model store information about its <code>Coach</code> as <code>coachId</code> field.</p><pre><code class="lang-js"><code class="source-code prettyprint">Coach.hasOne(Team)  // `coachId` will be added on Team / Target model</code>
</code></pre><h2>One-To-Many associations (hasMany)</h2><p>One-To-Many associations are connecting one source with multiple targets. The targets however are again connected to exactly one specific source.</p><pre><code class="lang-js"><code class="source-code prettyprint">const User = sequelize.define('user', {/* ... */})
const Project = sequelize.define('project', {/* ... */})

// OK. Now things get more complicated (not really visible to the user :)).
// First let's define a hasMany association
Project.hasMany(User, {as: 'Workers'})</code>
</code></pre><p>This will add the attribute <code>projectId</code> or <code>project_id</code> to User. Instances of Project will get the accessors <code>getWorkers</code> and <code>setWorkers</code>. </p><p>Sometimes you may need to associate records on different columns, you may use <code>sourceKey</code> option:</p><pre><code class="lang-js"><code class="source-code prettyprint">const City = sequelize.define('city', { countryCode: Sequelize.STRING });
const Country = sequelize.define('country', { isoCode: Sequelize.STRING });

// Here we can connect countries and cities base on country code
Country.hasMany(City, {foreignKey: 'countryCode', sourceKey: 'isoCode'});
City.belongsTo(Country, {foreignKey: 'countryCode', targetKey: 'isoCode'});</code>
</code></pre><p>So far we dealt with a one-way association. But we want more! Let's define it the other way around by creating a many to many association in the next section.</p><h2>Belongs-To-Many associations</h2><p>Belongs-To-Many associations are used to connect sources with multiple targets. Furthermore the targets can also have connections to multiple sources.</p><pre><code class="lang-js"><code class="source-code prettyprint">Project.belongsToMany(User, {through: 'UserProject'});
User.belongsToMany(Project, {through: 'UserProject'});</code>
</code></pre><p>This will create a new model called UserProject with the equivalent foreign keys <code>projectId</code> and <code>userId</code>. Whether the attributes are camelcase or not depends on the two models joined by the table (in this case User and Project).</p><p>Defining <code>through</code> is <strong>required</strong>. Sequelize would previously attempt to autogenerate names but that would not always lead to the most logical setups.</p><p>This will add methods <code>getUsers</code>, <code>setUsers</code>, <code>addUser</code>,<code>addUsers</code> to <code>Project</code>, and <code>getProjects</code>, <code>setProjects</code>, <code>addProject</code>, and <code>addProjects</code> to <code>User</code>.</p><p>Sometimes you may want to rename your models when using them in associations. Let's define users as workers and projects as tasks by using the alias (<code>as</code>) option. We will also manually define the foreign keys to use:</p><pre><code class="lang-js"><code class="source-code prettyprint">User.belongsToMany(Project, { as: 'Tasks', through: 'worker_tasks', foreignKey: 'userId' })
Project.belongsToMany(User, { as: 'Workers', through: 'worker_tasks', foreignKey: 'projectId' })</code>
</code></pre><p><code>foreignKey</code> will allow you to set <strong>source model</strong> key in the <strong>through</strong> relation.
<code>otherKey</code> will allow you to set <strong>target model</strong> key in the <strong>through</strong> relation.</p><pre><code class="lang-js"><code class="source-code prettyprint">User.belongsToMany(Project, { as: 'Tasks', through: 'worker_tasks', foreignKey: 'userId', otherKey: 'projectId'})</code>
</code></pre><p>Of course you can also define self references with belongsToMany:</p><pre><code class="lang-js"><code class="source-code prettyprint">Person.belongsToMany(Person, { as: 'Children', through: 'PersonChildren' })
// This will create the table PersonChildren which stores the ids of the objects.</code>
</code></pre><p>If you want additional attributes in your join table, you can define a model for the join table in sequelize, before you define the association, and then tell sequelize that it should use that model for joining, instead of creating a new one:</p><pre><code class="lang-js"><code class="source-code prettyprint">const User = sequelize.define('user', {})
const Project = sequelize.define('project', {})
const UserProjects = sequelize.define('userProjects', {
    status: DataTypes.STRING
})

User.belongsToMany(Project, { through: UserProjects })
Project.belongsToMany(User, { through: UserProjects })</code>
</code></pre><p>To add a new project to a user and set its status, you pass extra <code>options.through</code> to the setter, which contains the attributes for the join table</p><pre><code class="lang-js"><code class="source-code prettyprint">user.addProject(project, { through: { status: 'started' }})</code>
</code></pre><p>By default the code above will add projectId and userId to the UserProjects table, and <em>remove any previously defined primary key attribute</em> - the table will be uniquely identified by the combination of the keys of the two tables, and there is no reason to have other PK columns. To enforce a primary key on the <code>UserProjects</code> model you can add it manually.</p><pre><code class="lang-js"><code class="source-code prettyprint">const UserProjects = sequelize.define('userProjects', {
  id: {
    type: Sequelize.INTEGER,
    primaryKey: true,
    autoIncrement: true
  },
  status: DataTypes.STRING
})</code>
</code></pre><p>With Belongs-To-Many you can query based on <strong>through</strong> relation and select specific attributes. For example using <code>findAll</code> with <strong>through</strong></p><pre><code class="lang-js"><code class="source-code prettyprint">User.findAll({
  include: [{
    model: Project,
    through: {
      attributes: ['createdAt', 'startedAt', 'finishedAt'],
      where: {completed: true}
    }
  }]
});</code>
</code></pre><p>Belongs-To-Many creates a unique key when primary key is not present on through model. This unique key name can be overridden using <strong>uniqueKey</strong> option.</p><pre><code class="lang-js"><code class="source-code prettyprint">Project.belongsToMany(User, { through: UserProjects, uniqueKey: 'my_custom_unique' })</code>
</code></pre><h2>Scopes</h2><p>This section concerns association scopes. For a definition of association scopes vs. scopes on associated models, see <a href="/v4/manual/tutorial/scopes.html">Scopes</a>.</p><p>Association scopes allow you to place a scope (a set of default attributes for <code>get</code> and <code>create</code>) on the association. Scopes can be placed both on the associated model (the target of the association), and on the through table for n:m relations.</p><h4>1:m</h4><p>Assume we have tables Comment, Post, and Image. A comment can be associated to either an image or a post via <code>commentable_id</code> and <code>commentable</code> - we say that Post and Image are <code>Commentable</code></p><pre><code class="lang-js"><code class="source-code prettyprint">const Comment = this.sequelize.define('comment', {
  title: Sequelize.STRING,
  commentable: Sequelize.STRING,
  commentable_id: Sequelize.INTEGER
});

Comment.prototype.getItem = function(options) {
  return this['get' + this.get('commentable').substr(0, 1).toUpperCase() + this.get('commentable').substr(1)](options);
};

Post.hasMany(this.Comment, {
  foreignKey: 'commentable_id',
  constraints: false,
  scope: {
    commentable: 'post'
  }
});
Comment.belongsTo(this.Post, {
  foreignKey: 'commentable_id',
  constraints: false,
  as: 'post'
});

Image.hasMany(this.Comment, {
  foreignKey: 'commentable_id',
  constraints: false,
  scope: {
    commentable: 'image'
  }
});
Comment.belongsTo(this.Image, {
  foreignKey: 'commentable_id',
  constraints: false,
  as: 'image'
});</code>
</code></pre><p><code>constraints: false,</code> disables references constraints - since the <code>commentable_id</code> column references several tables, we cannot add a <code>REFERENCES</code> constraint to it. Note that the Image -&gt; Comment and Post -&gt; Comment relations define a scope, <code>commentable: 'image'</code> and <code>commentable: 'post'</code> respectively. This scope is automatically applied when using the association functions:</p><pre><code class="lang-js"><code class="source-code prettyprint">image.getComments()
SELECT * FROM comments WHERE commentable_id = 42 AND commentable = 'image';

image.createComment({
  title: 'Awesome!'
})
INSERT INTO comments (title, commentable_id, commentable) VALUES ('Awesome!', 42, 'image');

image.addComment(comment);
UPDATE comments SET commentable_id = 42, commentable = 'image'</code>
</code></pre><p>The <code>getItem</code> utility function on <code>Comment</code> completes the picture - it simply converts the <code>commentable</code> string into a call to either <code>getImage</code> or <code>getPost</code>, providing an abstraction over whether a comment belongs to a post or an image. You can pass a normal options object as a parameter to <code>getItem(options)</code> to specify any where conditions or includes.</p><h4>n:m</h4><p>Continuing with the idea of a polymorphic model, consider a tag table - an item can have multiple tags, and a tag can be related to several items.</p><p>For brevity, the example only shows a Post model, but in reality Tag would be related to several other models.</p><pre><code class="lang-js"><code class="source-code prettyprint">const ItemTag = sequelize.define('item_tag', {
  id : {
    type: DataTypes.INTEGER,
    primaryKey: true,
    autoIncrement: true
  },
  tag_id: {
    type: DataTypes.INTEGER,
    unique: 'item_tag_taggable'
  },
  taggable: {
    type: DataTypes.STRING,
    unique: 'item_tag_taggable'
  },
  taggable_id: {
    type: DataTypes.INTEGER,
    unique: 'item_tag_taggable',
    references: null
  }
});
const Tag = sequelize.define('tag', {
  name: DataTypes.STRING
});

Post.belongsToMany(Tag, {
  through: {
    model: ItemTag,
    unique: false,
    scope: {
      taggable: 'post'
    }
  },
  foreignKey: 'taggable_id',
  constraints: false
});
Tag.belongsToMany(Post, {
  through: {
    model: ItemTag,
    unique: false
  },
  foreignKey: 'tag_id',
  constraints: false
});</code>
</code></pre><p>Notice that the scoped column (<code>taggable</code>) is now on the through model (<code>ItemTag</code>).</p><p>We could also define a more restrictive association, for example, to get all pending tags for a post by applying a scope of both the through model (<code>ItemTag</code>) and the target model (<code>Tag</code>):</p><pre><code class="lang-js"><code class="source-code prettyprint">Post.hasMany(Tag, {
  through: {
    model: ItemTag,
    unique: false,
    scope: {
      taggable: 'post'
    }
  },
  scope: {
    status: 'pending'
  },
  as: 'pendingTags',
  foreignKey: 'taggable_id',
  constraints: false
});

Post.getPendingTags();</code>
</code></pre><pre><code class="lang-sql"><code class="source-code prettyprint">SELECT `tag`.*  INNER JOIN `item_tags` AS `item_tag`
ON `tag`.`id` = `item_tag`.`tagId`
  AND `item_tag`.`taggable_id` = 42
  AND `item_tag`.`taggable` = 'post'
WHERE (`tag`.`status` = 'pending');</code>
</code></pre><p><code>constraints: false</code> disables references constraints on the <code>taggable_id</code> column. Because the column is polymorphic, we cannot say that it <code>REFERENCES</code> a specific table.</p><h2>Naming strategy</h2><p>By default sequelize will use the model name (the name passed to <code>sequelize.define</code>) to figure out the name of the model when used in associations. For example, a model named <code>user</code> will add the functions <code>get/set/add User</code> to instances of the associated model, and a property named <code>.user</code> in eager loading, while a model named <code>User</code> will add the same functions, but a property named <code>.User</code> (notice the upper case U) in eager loading.</p><p>As we've already seen, you can alias models in associations using <code>as</code>. In single associations (has one and belongs to), the alias should be singular, while for many associations (has many) it should be plural. Sequelize then uses the <a href="https://www.npmjs.org/package/inflection">inflection </a>library to convert the alias to its singular form. However, this might not always work for irregular or non-english words. In this case, you can provide both the plural and the singular form of the alias:</p><pre><code class="lang-js"><code class="source-code prettyprint">User.belongsToMany(Project, { as: { singular: 'task', plural: 'tasks' }})
// Notice that inflection has no problem singularizing tasks, this is just for illustrative purposes.</code>
</code></pre><p>If you know that a model will always use the same alias in associations, you can provide it when creating the model</p><pre><code class="lang-js"><code class="source-code prettyprint">const Project = sequelize.define('project', attributes, {
  name: {
    singular: 'task',
    plural: 'tasks',
  }
})

User.belongsToMany(Project);</code>
</code></pre><p>This will add the functions <code>add/set/get Tasks</code> to user instances.</p><p>Remember, that using <code>as</code> to change the name of the association will also change the name of the foreign key. When using <code>as</code>, it is safest to also specify the foreign key.</p><pre><code class="lang-js"><code class="source-code prettyprint">Invoice.belongsTo(Subscription)
Subscription.hasMany(Invoice)</code>
</code></pre><p>Without <code>as</code>, this adds <code>subscriptionId</code> as expected. However, if you were to say <code>Invoice.belongsTo(Subscription, { as: 'TheSubscription' })</code>, you will have both <code>subscriptionId</code> and <code>theSubscriptionId</code>, because sequelize is not smart enough to figure that the calls are two sides of the same relation. 'foreignKey' fixes this problem;</p><pre><code class="lang-js"><code class="source-code prettyprint">Invoice.belongsTo(Subscription, , { as: 'TheSubscription', foreignKey: 'subscription_id' })
Subscription.hasMany(Invoice, { foreignKey: 'subscription_id' )</code>
</code></pre><h2>Associating objects</h2><p>Because Sequelize is doing a lot of magic, you have to call <code>Sequelize.sync</code> after setting the associations! Doing so will allow you the following:</p><pre><code class="lang-js"><code class="source-code prettyprint">Project.hasMany(Task)
Task.belongsTo(Project)

Project.create()...
Task.create()...
Task.create()...

// save them... and then:
project.setTasks([task1, task2]).then(() =&gt; {
  // saved!
})

// ok, now they are saved... how do I get them later on?
project.getTasks().then(associatedTasks =&gt; {
  // associatedTasks is an array of tasks
})

// You can also pass filters to the getter method.
// They are equal to the options you can pass to a usual finder method.
project.getTasks({ where: 'id &gt; 10' }).then(tasks =&gt; {
  // tasks with an id greater than 10 :)
})

// You can also only retrieve certain fields of a associated object.
project.getTasks({attributes: ['title']}).then(tasks =&gt; {
  // retrieve tasks with the attributes "title" and "id"
})</code>
</code></pre><p>To remove created associations you can just call the set method without a specific id:</p><pre><code class="lang-js"><code class="source-code prettyprint">// remove the association with task1
project.setTasks([task2]).then(associatedTasks =&gt; {
  // you will get task2 only
})

// remove 'em all
project.setTasks([]).then(associatedTasks =&gt; {
  // you will get an empty array
})

// or remove 'em more directly
project.removeTask(task1).then(() =&gt; {
  // it's gone
})

// and add 'em again
project.addTask(task1).then(function() {
  // it's back again
})</code>
</code></pre><p>You can of course also do it vice versa:</p><pre><code class="lang-js"><code class="source-code prettyprint">// project is associated with task1 and task2
task2.setProject(null).then(function() {
  // and it's gone
})</code>
</code></pre><p>For hasOne/belongsTo it's basically the same:</p><pre><code class="lang-js"><code class="source-code prettyprint">Task.hasOne(User, {as: "Author"})
Task.setAuthor(anAuthor)</code>
</code></pre><p>Adding associations to a relation with a custom join table can be done in two ways (continuing with the associations defined in the previous chapter):</p><pre><code class="lang-js"><code class="source-code prettyprint">// Either by adding a property with the name of the join table model to the object, before creating the association
project.UserProjects = {
  status: 'active'
}
u.addProject(project)

// Or by providing a second options.through argument when adding the association, containing the data that should go in the join table
u.addProject(project, { through: { status: 'active' }})


// When associating multiple objects, you can combine the two options above. In this case the second argument
// will be treated as a defaults object, that will be used if no data is provided
project1.UserProjects = {
    status: 'inactive'
}

u.setProjects([project1, project2], { through: { status: 'active' }})
// The code above will record inactive for project one, and active for project two in the join table</code>
</code></pre><p>When getting data on an association that has a custom join table, the data from the join table will be returned as a DAO instance:</p><pre><code class="lang-js"><code class="source-code prettyprint">u.getProjects().then(projects =&gt; {
  const project = projects[0]

  if (project.UserProjects.status === 'active') {
    // .. do magic

    // since this is a real DAO instance, you can save it directly after you are done doing magic
    return project.UserProjects.save()
  }
})</code>
</code></pre><p>If you only need some of the attributes from the join table, you can provide an array with the attributes you want:</p><pre><code class="lang-js"><code class="source-code prettyprint">// This will select only name from the Projects table, and only status from the UserProjects table
user.getProjects({ attributes: ['name'], joinTableAttributes: ['status']})</code>
</code></pre><h2>Check associations</h2><p>You can also check if an object is already associated with another one (N:M only). Here is how you'd do it:</p><pre><code class="lang-js"><code class="source-code prettyprint">// check if an object is one of associated ones:
Project.create({ /* */ }).then(project =&gt; {
  return User.create({ /* */ }).then(user =&gt; {
    return project.hasUser(user).then(result =&gt; {
      // result would be false
      return project.addUser(user).then(() =&gt; {
        return project.hasUser(user).then(result =&gt; {
          // result would be true
        })
      })
    })
  })
})

// check if all associated objects are as expected:
// let's assume we have already a project and two users
project.setUsers([user1, user2]).then(() =&gt; {
  return project.hasUsers([user1]);
}).then(result =&gt; {
  // result would be true
  return project.hasUsers([user1, user2]);
}).then(result =&gt; {
  // result would be true
})</code>
</code></pre><h2>Foreign Keys</h2><p>When you create associations between your models in sequelize, foreign key references with constraints will automatically be created. The setup below:</p><pre><code class="lang-js"><code class="source-code prettyprint">const Task = this.sequelize.define('task', { title: Sequelize.STRING })
const User = this.sequelize.define('user', { username: Sequelize.STRING })

User.hasMany(Task)
Task.belongsTo(User)</code>
</code></pre><p>Will generate the following SQL:</p><pre><code class="lang-sql"><code class="source-code prettyprint">CREATE TABLE IF NOT EXISTS `User` (
  `id` INTEGER PRIMARY KEY,
  `username` VARCHAR(255)
);

CREATE TABLE IF NOT EXISTS `Task` (
  `id` INTEGER PRIMARY KEY,
  `title` VARCHAR(255),
  `user_id` INTEGER REFERENCES `User` (`id`) ON DELETE SET NULL ON UPDATE CASCADE
);</code>
</code></pre><p>The relation between task and user injects the <code>user_id</code> foreign key on tasks, and marks it as a reference to the <code>User</code> table. By default <code>user_id</code> will be set to <code>NULL</code> if the referenced user is deleted, and updated if the id of the user id updated. These options can be overridden by passing <code>onUpdate</code> and <code>onDelete</code> options to the association calls. The validation options are <code>RESTRICT, CASCADE, NO ACTION, SET DEFAULT, SET NULL</code>.</p><p>For 1:1 and 1:m associations the default option is <code>SET NULL</code> for deletion, and <code>CASCADE</code> for updates. For n:m, the default for both is <code>CASCADE</code>. This means, that if you delete or update a row from one side of an n:m association, all the rows in the join table referencing that row will also be deleted or updated.</p><p>Adding constraints between tables means that tables must be created in the database in a certain order, when using <code>sequelize.sync</code>. If Task has a reference to User, the User table must be created before the Task table can be created. This can sometimes lead to circular references, where sequelize cannot find an order in which to sync. Imagine a scenario of documents and versions. A document can have multiple versions, and for convenience, a document has a reference to its current version.</p><pre><code class="lang-js"><code class="source-code prettyprint">const Document = this.sequelize.define('document', {
  author: Sequelize.STRING
})
const Version = this.sequelize.define('version', {
  timestamp: Sequelize.DATE
})

Document.hasMany(Version) // This adds document_id to version
Document.belongsTo(Version, { as: 'Current', foreignKey: 'current_version_id'}) // This adds current_version_id to document</code>
</code></pre><p>However, the code above will result in the following error: <code>Cyclic dependency found. 'Document' is dependent of itself. Dependency Chain: Document -&gt; Version =&gt; Document</code>. In order to alleviate that, we can pass <code>constraints: false</code> to one of the associations:</p><pre><code class="lang-js"><code class="source-code prettyprint">Document.hasMany(Version)
Document.belongsTo(Version, { as: 'Current', foreignKey: 'current_version_id', constraints: false})</code>
</code></pre><p>Which will allow us to sync the tables correctly:</p><pre><code class="lang-sql"><code class="source-code prettyprint">CREATE TABLE IF NOT EXISTS `Document` (
  `id` INTEGER PRIMARY KEY,
  `author` VARCHAR(255),
  `current_version_id` INTEGER
);
CREATE TABLE IF NOT EXISTS `Version` (
  `id` INTEGER PRIMARY KEY,
  `timestamp` DATETIME,
  `document_id` INTEGER REFERENCES `Document` (`id`) ON DELETE SET NULL ON UPDATE CASCADE
);</code>
</code></pre><h3>Enforcing a foreign key reference without constraints</h3><p>Sometimes you may want to reference another table, without adding any constraints, or associations. In that case you can manually add the reference attributes to your schema definition, and mark the relations between them.</p><pre><code class="lang-js"><code class="source-code prettyprint">// Series has a trainer_id=Trainer.id foreign reference key after we call Trainer.hasMany(series)
const Series = sequelize.define('series', {
  title:        DataTypes.STRING,
  sub_title:    DataTypes.STRING,
  description:  DataTypes.TEXT,

  // Set FK relationship (hasMany) with `Trainer`
  trainer_id: {
    type: DataTypes.INTEGER,
    references: {
      model: "trainer",
      key: "id"
    }
  }
})

const Trainer = sequelize.define('trainer', {
  first_name: DataTypes.STRING,
  last_name:  DataTypes.STRING
});

// Video has a series_id=Series.id foreign reference key after we call Series.hasOne(Video)...
const Video = sequelize.define('video', {
  title:        DataTypes.STRING,
  sequence:     DataTypes.INTEGER,
  description:  DataTypes.TEXT,

  // set relationship (hasOne) with `Series`
  series_id: {
    type: DataTypes.INTEGER,
    references: {
      model: Series, // Can be both a string representing the table name, or a reference to the model
      key:   "id"
    }
  }
});

Series.hasOne(Video);
Trainer.hasMany(Series);</code>
</code></pre><h2>Creating with associations</h2><p>An instance can be created with nested association in one step, provided all elements are new.</p><h3>Creating elements of a "BelongsTo", "Has Many" or "HasOne" association</h3><p>Consider the following models:</p><pre><code class="lang-js"><code class="source-code prettyprint">const Product = this.sequelize.define('product', {
  title: Sequelize.STRING
});
const User = this.sequelize.define('user', {
  first_name: Sequelize.STRING,
  last_name: Sequelize.STRING
});
const Address = this.sequelize.define('address', {
  type: Sequelize.STRING,
  line_1: Sequelize.STRING,
  line_2: Sequelize.STRING,
  city: Sequelize.STRING,
  state: Sequelize.STRING,
  zip: Sequelize.STRING,
});

Product.User = Product.belongsTo(User);
User.Addresses = User.hasMany(Address);
// Also works for `hasOne`</code>
</code></pre><p>A new <code>Product</code>, <code>User</code>, and one or more <code>Address</code> can be created in one step in the following way:</p><pre><code class="lang-js"><code class="source-code prettyprint">return Product.create({
  title: 'Chair',
  user: {
    first_name: 'Mick',
    last_name: 'Broadstone',
    addresses: [{
      type: 'home',
      line_1: '100 Main St.',
      city: 'Austin',
      state: 'TX',
      zip: '78704'
    }]
  }
}, {
  include: [{
    association: Product.User,
    include: [ User.Addresses ]
  }]
});</code>
</code></pre><p>Here, our user model is called <code>user</code>, with a lowercase u - This means that the property in the object should also be <code>user</code>. If the name given to <code>sequelize.define</code> was <code>User</code>, the key in the object should also be <code>User</code>. Likewise for <code>addresses</code>, except it's pluralized being a <code>hasMany</code> association.</p><h3>Creating elements of a "BelongsTo" association with an alias</h3><p>The previous example can be extended to support an association alias.</p><pre><code class="lang-js"><code class="source-code prettyprint">const Creator = Product.belongsTo(User, {as: 'creator'});

return Product.create({
  title: 'Chair',
  creator: {
    first_name: 'Matt',
    last_name: 'Hansen'
  }
}, {
  include: [ Creator ]
});</code>
</code></pre><h3>Creating elements of a "HasMany" or "BelongsToMany" association</h3><p>Let's introduce the ability to associate a product with many tags. Setting up the models could look like:</p><pre><code class="lang-js"><code class="source-code prettyprint">const Tag = this.sequelize.define('tag', {
  name: Sequelize.STRING
});

Product.hasMany(Tag);
// Also works for `belongsToMany`.</code>
</code></pre><p>Now we can create a product with multiple tags in the following way:</p><pre><code class="lang-js"><code class="source-code prettyprint">Product.create({
  id: 1,
  title: 'Chair',
  tags: [
    { name: 'Alpha'},
    { name: 'Beta'}
  ]
}, {
  include: [ Tag ]
})</code>
</code></pre><p>And, we can modify this example to support an alias as well:</p><pre><code class="lang-js"><code class="source-code prettyprint">const Categories = Product.hasMany(Tag, {as: 'categories'});

Product.create({
  id: 1,
  title: 'Chair',
  categories: [
    {id: 1, name: 'Alpha'},
    {id: 2, name: 'Beta'}
  ]
}, {
  include: [{
    model: Categories,
    as: 'categories'
  }]
})</code>
</code></pre><hr></div>
        <a data-ice="link" href="/v4/manual/tutorial/associations.html"></a>
      </div>
    </div>
<div class="manual-card-wrap" data-ice="cards">
      <h1 data-ice="label" class="manual-color manual-color-tutorial" data-section-count="■■■"><span data-ice="label-inner">Transactions</span></h1>
      <div class="manual-card">
        <div data-ice="card"><h1>Transactions</h1><p>Sequelize supports two ways of using transactions:</p><ul>
<li>One which will automatically commit or rollback the transaction based on the result of a promise chain and, (if enabled) pass the transaction to all calls within the callback</li>
<li>And one which leaves committing, rolling back and passing the transaction to the user.</li>
</ul><p>The key difference is that the managed transaction uses a callback that expects a promise to be returned to it while the unmanaged transaction returns a promise.</p><h2>Managed transaction (auto-callback)</h2><p>Managed transactions handle committing or rolling back the transaction automagically. You start a managed transaction by passing a callback to <code>sequelize.transaction</code>.</p><p>Notice how the callback passed to <code>transaction</code> returns a promise chain, and does not explicitly call <code>t.commit()</code> nor <code>t.rollback()</code>. If all promises in the returned chain are resolved successfully the transaction is committed. If one or several of the promises are rejected, the transaction is rolled back.</p><pre><code class="lang-js"><code class="source-code prettyprint">return sequelize.transaction(function (t) {

  // chain all your queries here. make sure you return them.
  return User.create({
    firstName: 'Abraham',
    lastName: 'Lincoln'
  }, {transaction: t}).then(function (user) {
    return user.setShooter({
      firstName: 'John',
      lastName: 'Boothe'
    }, {transaction: t});
  });

}).then(function (result) {
  // Transaction has been committed
  // result is whatever the result of the promise chain returned to the transaction callback
}).catch(function (err) {
  // Transaction has been rolled back
  // err is whatever rejected the promise chain returned to the transaction callback
});</code>
</code></pre><h3>Throw errors to rollback</h3><p>When using the managed transaction you should <em>never</em> commit or rollback the transaction manually. If all queries are successful, but you still want to rollback the transaction (for example because of a validation failure) you should throw an error to break and reject the chain:</p><pre><code class="lang-js"><code class="source-code prettyprint">return sequelize.transaction(function (t) {
  return User.create({
    firstName: 'Abraham',
    lastName: 'Lincoln'
  }, {transaction: t}).then(function (user) {
    // Woops, the query was successful but we still want to roll back!
    throw new Error();
  });
});</code>
</code></pre><h3>Automatically pass transactions to all queries</h3><p>In the examples above, the transaction is still manually passed, by passing <code>{ transaction: t }</code> as the second argument. To automatically pass the transaction to all queries you must install the <a href="https://github.com/othiym23/node-continuation-local-storage">continuation local storage</a> (CLS) module and instantiate a namespace in your own code:</p><pre><code class="lang-js"><code class="source-code prettyprint">const cls = require('continuation-local-storage'),
    namespace = cls.createNamespace('my-very-own-namespace');</code>
</code></pre><p>To enable CLS you must tell sequelize which namespace to use by using a static method of the sequelize constructor:</p><pre><code class="lang-js"><code class="source-code prettyprint">const Sequelize = require('sequelize');
Sequelize.useCLS(namespace);

new Sequelize(....);</code>
</code></pre><p>Notice, that the <code>useCLS()</code> method is on the <em>constructor</em>, not on an instance of sequelize. This means that all instances will share the same namespace, and that CLS is all-or-nothing - you cannot enable it only for some instances.</p><p>CLS works like a thread-local storage for callbacks. What this means in practice is that different callback chains can access local variables by using the CLS namespace. When CLS is enabled sequelize will set the <code>transaction</code> property on the namespace when a new transaction is created. Since variables set within a callback chain are private to that chain several concurrent transactions can exist at the same time:</p><pre><code class="lang-js"><code class="source-code prettyprint">sequelize.transaction(function (t1) {
  namespace.get('transaction') === t1; // true
});

sequelize.transaction(function (t2) {
  namespace.get('transaction') === t2; // true
});</code>
</code></pre><p>In most case you won't need to access <code>namespace.get('transaction')</code> directly, since all queries will automatically look for a transaction on the namespace:</p><pre><code class="lang-js"><code class="source-code prettyprint">sequelize.transaction(function (t1) {
  // With CLS enabled, the user will be created inside the transaction
  return User.create({ name: 'Alice' });
});</code>
</code></pre><p>After you've used <code>Sequelize.useCLS()</code> all promises returned from sequelize will be patched to maintain CLS context. CLS is a complicated subject - more details in the docs for <a href="https://www.npmjs.com/package/cls-bluebird">cls-bluebird</a>, the patch used to make bluebird promises work with CLS.</p><p><strong>Note:</strong> _<a href="https://github.com/othiym23/node-continuation-local-storage/issues/98#issuecomment-323503807">CLS only supports async/await, at the moment, when using cls-hooked package</a>. Although, <a href="https://github.com/Jeff-Lewis/cls-hooked/blob/master/README.md">cls-hooked</a> relies on <em>experimental API</em> <a href="https://github.com/nodejs/node/blob/master/doc/api/async_hooks.md">async_hooks</a>_</p><h2>Concurrent/Partial transactions</h2><p>You can have concurrent transactions within a sequence of queries or have some of them excluded from any transactions. Use the <code>{transaction: }</code> option to control which transaction a query belong to:</p><p><strong>Warning:</strong> <em>SQLite does not support more than one transaction at the same time.</em></p><h3>Without CLS enabled</h3><pre><code class="lang-js"><code class="source-code prettyprint">sequelize.transaction(function (t1) {
  return sequelize.transaction(function (t2) {
    // With CLS enable, queries here will by default use t2
    // Pass in the `transaction` option to define/alter the transaction they belong to.
    return Promise.all([
        User.create({ name: 'Bob' }, { transaction: null }),
        User.create({ name: 'Mallory' }, { transaction: t1 }),
        User.create({ name: 'John' }) // this would default to t2
    ]);
  });
});</code>
</code></pre><h2>Isolation levels</h2><p>The possible isolations levels to use when starting a transaction:</p><pre><code class="lang-js"><code class="source-code prettyprint">Sequelize.Transaction.ISOLATION_LEVELS.READ_UNCOMMITTED // "READ UNCOMMITTED"
Sequelize.Transaction.ISOLATION_LEVELS.READ_COMMITTED // "READ COMMITTED"
Sequelize.Transaction.ISOLATION_LEVELS.REPEATABLE_READ  // "REPEATABLE READ"
Sequelize.Transaction.ISOLATION_LEVELS.SERIALIZABLE // "SERIALIZABLE"</code>
</code></pre><p>By default, sequelize uses the isolation level of the database. If you want to use a different isolation level, pass in the desired level as the first argument:</p><pre><code class="lang-js"><code class="source-code prettyprint">return sequelize.transaction({
  isolationLevel: Sequelize.Transaction.ISOLATION_LEVELS.SERIALIZABLE
  }, function (t) {

  // your transactions

  });</code>
</code></pre><p><strong>Note:</strong> <em>The SET ISOLATION LEVEL queries are not logged in case of MSSQL as the specified isolationLevel is passed directly to tedious</em></p><h2>Unmanaged transaction (then-callback)</h2><p>Unmanaged transactions force you to manually rollback or commit the transaction. If you don't do that, the transaction will hang until it times out. To start an unmanaged transaction, call <code>sequelize.transaction()</code> without a callback (you can still pass an options object) and call <code>then</code> on the returned promise. Notice that <code>commit()</code> and <code>rollback()</code> returns a promise.</p><pre><code class="lang-js"><code class="source-code prettyprint">return sequelize.transaction().then(function (t) {
  return User.create({
    firstName: 'Bart',
    lastName: 'Simpson'
  }, {transaction: t}).then(function (user) {
    return user.addSibling({
      firstName: 'Lisa',
      lastName: 'Simpson'
    }, {transaction: t});
  }).then(function () {
    return t.commit();
  }).catch(function (err) {
    return t.rollback();
  });
});</code>
</code></pre><h2>Options</h2><p>The <code>transaction</code> method can be called with an options object as the first argument, that
allows the configuration of the transaction.</p><pre><code class="lang-js"><code class="source-code prettyprint">return sequelize.transaction({ /* options */ });</code>
</code></pre><p>The following options (with their default values) are available:</p><pre><code class="lang-js"><code class="source-code prettyprint">{
  autocommit: true,
  isolationLevel: 'REPEATABLE_READ',
  deferrable: 'NOT DEFERRABLE' // implicit default of postgres
}</code>
</code></pre><p>The <code>isolationLevel</code> can either be set globally when initializing the Sequelize instance or
locally for every transaction:</p><pre><code class="lang-js"><code class="source-code prettyprint">// globally
new Sequelize('db', 'user', 'pw', {
  isolationLevel: Sequelize.Transaction.ISOLATION_LEVELS.SERIALIZABLE
});

// locally
sequelize.transaction({
  isolationLevel: Sequelize.Transaction.ISOLATION_LEVELS.SERIALIZABLE
});</code>
</code></pre><p>The <code>deferrable</code> option triggers an additional query after the transaction start
that optionally set the constraint checks to be deferred or immediate. Please note
that this is only supported in PostgreSQL.</p><pre><code class="lang-js"><code class="source-code prettyprint">sequelize.transaction({
  // to defer all constraints:
  deferrable: Sequelize.Deferrable.SET_DEFERRED,

  // to defer a specific constraint:
  deferrable: Sequelize.Deferrable.SET_DEFERRED(['some_constraint']),

  // to not defer constraints:
  deferrable: Sequelize.Deferrable.SET_IMMEDIATE
})</code>
</code></pre><h2>Usage with other sequelize methods</h2><p>The <code>transaction</code> option goes with most other options, which are usually the first argument of a method.
For methods that take values, like <code>.create</code>, <code>.update()</code>, <code>.updateAttributes()</code> etc. <code>transaction</code> should be passed to the option in the second argument.
If unsure, refer to the API documentation for the method you are using to be sure of the signature.</p><h2>After commit hook</h2><p>A <code>transaction</code> object allows tracking if and when it is committed.</p><p>An <code>afterCommit</code> hook can be added to both managed and unmanaged transaction objects:</p><pre><code class="lang-js"><code class="source-code prettyprint">sequelize.transaction(t =&gt; {
  t.afterCommit((transaction) =&gt; {
    // Your logic
  });
});

sequelize.transaction().then(t =&gt; {
  t.afterCommit((transaction) =&gt; {
    // Your logic
  });

  return t.commit();
})</code>
</code></pre><p>The function passed to <code>afterCommit</code> can optionally return a promise that will resolve before the promise chain
that created the transaction resolves</p><p><code>afterCommit</code> hooks are <em>not</em> raised if a transaction is rolled back</p><p><code>afterCommit</code> hooks do <em>not</em> modify the return value of the transaction, unlike standard hooks</p><p>You can use the <code>afterCommit</code> hook in conjunction with model hooks to know when a instance is saved and available outside
of a transaction</p><p>```js
model.afterSave((instance, options) =&gt; {
  if (options.transaction) {
    // Save done within a transaction, wait until transaction is committed to
    // notify listeners the instance has been saved
    options.transaction.afterCommit(() =&gt; /<em> Notify </em>/)
    return;
  }
  // Save done outside a transaction, safe for callers to fetch the updated model
  // Notify</p></div>
        <a data-ice="link" href="/v4/manual/tutorial/transactions.html"></a>
      </div>
    </div>
<div class="manual-card-wrap" data-ice="cards">
      <h1 data-ice="label" class="manual-color manual-color-tutorial" data-section-count="■■"><span data-ice="label-inner">Scopes</span></h1>
      <div class="manual-card">
        <div data-ice="card"><h1>Scopes</h1><p>Scoping allows you to define commonly used queries that you can easily use later. Scopes can include all the same attributes as regular finders, <code>where</code>, <code>include</code>, <code>limit</code> etc.</p><h2>Definition</h2><p>Scopes are defined in the model definition and can be finder objects, or functions returning finder objects - except for the default scope, which can only be an object:</p><pre><code class="lang-js"><code class="source-code prettyprint">const Project = sequelize.define('project', {
  // Attributes
}, {
  defaultScope: {
    where: {
      active: true
    }
  },
  scopes: {
    deleted: {
      where: {
        deleted: true
      }
    },
    activeUsers: {
      include: [
        { model: User, where: { active: true }}
      ]
    },
    random: function () {
      return {
        where: {
          someNumber: Math.random()
        }
      }
    },
    accessLevel: function (value) {
      return {
        where: {
          accessLevel: {
            [Op.gte]: value
          }
        }
      }
    }
  }
});</code>
</code></pre><p>You can also add scopes after a model has been defined by calling <code>addScope</code>. This is especially useful for scopes with includes, where the model in the include might not be defined at the time the other model is being defined.</p><p>The default scope is always applied. This means, that with the model definition above, <code>Project.findAll()</code> will create the following query:</p><pre><code class="lang-sql"><code class="source-code prettyprint">SELECT * FROM projects WHERE active = true</code>
</code></pre><p>The default scope can be removed by calling <code>.unscoped()</code>, <code>.scope(null)</code>, or by invoking another scope:</p><pre><code class="lang-js"><code class="source-code prettyprint">Project.scope('deleted').findAll(); // Removes the default scope</code>
</code></pre><pre><code class="lang-sql"><code class="source-code prettyprint">SELECT * FROM projects WHERE deleted = true</code>
</code></pre><p>It is also possible to include scoped models in a scope definition. This allows you to avoid duplicating <code>include</code>, <code>attributes</code> or <code>where</code> definitions.
Using the above example, and invoking the <code>active</code> scope on the included User model (rather than specifying the condition directly in that include object):</p><pre><code class="lang-js"><code class="source-code prettyprint">activeUsers: {
  include: [
    { model: User.scope('active')}
  ]
}</code>
</code></pre><h2>Usage</h2><p>Scopes are applied by calling <code>.scope</code> on the model definition, passing the name of one or more scopes. <code>.scope</code> returns a fully functional model instance with all the regular methods: <code>.findAll</code>, <code>.update</code>, <code>.count</code>, <code>.destroy</code> etc. You can save this model instance and reuse it later:</p><pre><code class="lang-js"><code class="source-code prettyprint">const DeletedProjects = Project.scope('deleted');

DeletedProjects.findAll();
// some time passes

// let's look for deleted projects again!
DeletedProjects.findAll();</code>
</code></pre><p>Scopes apply to <code>.find</code>, <code>.findAll</code>, <code>.count</code>, <code>.update</code>, <code>.increment</code> and <code>.destroy</code>.</p><p>Scopes which are functions can be invoked in two ways. If the scope does not take any arguments it can be invoked as normally. If the scope takes arguments, pass an object:</p><pre><code class="lang-js"><code class="source-code prettyprint">Project.scope('random', { method: ['accessLevel', 19]}).findAll();</code>
</code></pre><pre><code class="lang-sql"><code class="source-code prettyprint">SELECT * FROM projects WHERE someNumber = 42 AND accessLevel &gt;= 19</code>
</code></pre><h2>Merging</h2><p>Several scopes can be applied simultaneously by passing an array of scopes to <code>.scope</code>, or by passing the scopes as consecutive arguments.</p><pre><code class="lang-js"><code class="source-code prettyprint">// These two are equivalent
Project.scope('deleted', 'activeUsers').findAll();
Project.scope(['deleted', 'activeUsers']).findAll();</code>
</code></pre><pre><code class="lang-sql"><code class="source-code prettyprint">SELECT * FROM projects
INNER JOIN users ON projects.userId = users.id
AND users.active = true</code>
</code></pre><p>If you want to apply another scope alongside the default scope, pass the key <code>defaultScope</code> to <code>.scope</code>:</p><pre><code class="lang-js"><code class="source-code prettyprint">Project.scope('defaultScope', 'deleted').findAll();</code>
</code></pre><pre><code class="lang-sql"><code class="source-code prettyprint">SELECT * FROM projects WHERE active = true AND deleted = true</code>
</code></pre><p>When invoking several scopes, keys from subsequent scopes will overwrite previous ones (similar to <a href="https://lodash.com/docs#assign">_.assign</a>). Consider two scopes:</p><pre><code class="lang-js"><code class="source-code prettyprint">{
  scope1: {
    where: {
      firstName: 'bob',
      age: {
        [Op.gt]: 20
      }
    },
    limit: 2
  },
  scope2: {
    where: {
      age: {
        [Op.gt]: 30
      }
    },
    limit: 10
  }
}</code>
</code></pre><p>Calling <code>.scope('scope1', 'scope2')</code> will yield the following query</p><pre><code class="lang-sql"><code class="source-code prettyprint">WHERE firstName = 'bob' AND age &gt; 30 LIMIT 10</code>
</code></pre><p>Note how <code>limit</code> and <code>age</code> are overwritten by <code>scope2</code>, while <code>firstName</code> is preserved. <code>limit</code>, <code>offset</code>, <code>order</code>, <code>paranoid</code>, <code>lock</code> and <code>raw</code> are overwritten, while <code>where</code> and <code>include</code> are shallowly merged. This means that identical keys in the where objects, and subsequent includes of the same model will both overwrite each other.</p><p>The same merge logic applies when passing a find object directly to findAll on a scoped model:</p><pre><code class="lang-js"><code class="source-code prettyprint">Project.scope('deleted').findAll({
  where: {
    firstName: 'john'
  }
})</code>
</code></pre><pre><code class="lang-sql"><code class="source-code prettyprint">WHERE deleted = true AND firstName = 'john'</code>
</code></pre><p>Here the <code>deleted</code> scope is merged with the finder. If we were to pass <code>where: { firstName: 'john', deleted: false }</code> to the finder, the <code>deleted</code> scope would be overwritten.</p><h2>Associations</h2><p>Sequelize has two different but related scope concepts in relation to associations. The difference is subtle but important:</p><ul>
<li><strong>Association scopes</strong> Allow you to specify default attributes when getting and setting associations - useful when implementing polymorphic associations. This scope is only invoked on the association between the two models, when using the <code>get</code>, <code>set</code>, <code>add</code> and <code>create</code> associated model functions</li>
<li><strong>Scopes on associated models</strong> Allows you to apply default and other scopes when fetching associations, and allows you to pass a scoped model when creating associations. These scopes both apply to regular finds on the model and to find through the association.</li>
</ul><p>As an example, consider the models Post and Comment. Comment is associated to several other models (Image, Video etc.) and the association between Comment and other models is polymorphic, which means that Comment stores a <code>commentable</code> column, in addition to the foreign key <code>commentable_id</code>.</p><p>The polymorphic association can be implemented with an <em>association scope</em> :</p><pre><code class="lang-js"><code class="source-code prettyprint">this.Post.hasMany(this.Comment, {
  foreignKey: 'commentable_id',
  scope: {
    commentable: 'post'
  }
});</code>
</code></pre><p>When calling <code>post.getComments()</code>, this will automatically add <code>WHERE commentable = 'post'</code>. Similarly, when adding new comments to a post, <code>commentable</code> will automagically be set to <code>'post'</code>. The association scope is meant to live in the background without the programmer having to worry about it - it cannot be disabled. For a more complete polymorphic example, see <a href="/v4/manual/tutorial/associations.html#scopes">Association scopes</a></p><p>Consider then, that Post has a default scope which only shows active posts: <code>where: { active: true }</code>. This scope lives on the associated model (Post), and not on the association like the <code>commentable</code> scope did. Just like the default scope is applied when calling <code>Post.findAll()</code>, it is also applied when calling <code>User.getPosts()</code> - this will only return the active posts for that user.</p><p>To disable the default scope, pass <code>scope: null</code> to the getter: <code>User.getPosts({ scope: null })</code>. Similarly, if you want to apply other scopes, pass an array like you would to <code>.scope</code>:</p><pre><code class="lang-js"><code class="source-code prettyprint">User.getPosts({ scope: ['scope1', 'scope2']});</code>
</code></pre><p>If you want to create a shortcut method to a scope on an associated model, you can pass the scoped model to the association. Consider a shortcut to get all deleted posts for a user:</p><pre><code class="lang-js"><code class="source-code prettyprint">const Post = sequelize.define('post', attributes, {
  defaultScope: {
    where: {
      active: true
    }
  },
  scopes: {
    deleted: {
      where: {
        deleted: true
      }
    }
  }
});

User.hasMany(Post); // regular getPosts association
User.hasMany(Post.scope('deleted'), { as: 'deletedPosts' });</code>
</code></pre><pre><code class="lang-js"><code class="source-code prettyprint">User.getPosts(); // WHERE active = true
User.getDeletedPosts(); // WHERE deleted = true</code>
</code></pre></div>
        <a data-ice="link" href="/v4/manual/tutorial/scopes.html"></a>
      </div>
    </div>
<div class="manual-card-wrap" data-ice="cards">
      <h1 data-ice="label" class="manual-color manual-color-tutorial" data-section-count="■■■"><span data-ice="label-inner">Hooks</span></h1>
      <div class="manual-card">
        <div data-ice="card"><h1>Hooks</h1><p>Hooks (also known as lifecycle events), are functions which are called before and after calls in sequelize are executed. For example, if you want to always set a value on a model before saving it, you can add a <code>beforeUpdate</code> hook.</p><p>For a full list of hooks, see <a href="https://github.com/sequelize/sequelize/blob/master/lib/hooks.js#L7">Hooks file</a>.</p><h2>Order of Operations</h2><pre><code><code class="source-code prettyprint">(1)
  beforeBulkCreate(instances, options)
  beforeBulkDestroy(options)
  beforeBulkUpdate(options)
(2)
  beforeValidate(instance, options)
(-)
  validate
(3)
  afterValidate(instance, options)
  - or -
  validationFailed(instance, options, error)
(4)
  beforeCreate(instance, options)
  beforeDestroy(instance, options)
  beforeUpdate(instance, options)
  beforeSave(instance, options)
  beforeUpsert(values, options)
(-)
  create
  destroy
  update
(5)
  afterCreate(instance, options)
  afterDestroy(instance, options)
  afterUpdate(instance, options)
  afterSave(instance, options)
  afterUpsert(created, options)
(6)
  afterBulkCreate(instances, options)
  afterBulkDestroy(options)
  afterBulkUpdate(options)</code>
</code></pre><h2>Declaring Hooks</h2><p>Arguments to hooks are passed by reference. This means, that you can change the values, and this will be reflected in the insert / update statement. A hook may contain async actions - in this case the hook function should return a promise.</p><p>There are currently three ways to programmatically add hooks:</p><pre><code class="lang-js"><code class="source-code prettyprint">// Method 1 via the .define() method
const User = sequelize.define('user', {
  username: DataTypes.STRING,
  mood: {
    type: DataTypes.ENUM,
    values: ['happy', 'sad', 'neutral']
  }
}, {
  hooks: {
    beforeValidate: (user, options) =&gt; {
      user.mood = 'happy';
    },
    afterValidate: (user, options) =&gt; {
      user.username = 'Toni';
    }
  }
});

// Method 2 via the .hook() method (or its alias .addHook() method)
User.hook('beforeValidate', (user, options) =&gt; {
  user.mood = 'happy';
});

User.addHook('afterValidate', 'someCustomName', (user, options) =&gt; {
  return sequelize.Promise.reject(new Error("I'm afraid I can't let you do that!"));
});

// Method 3 via the direct method
User.beforeCreate((user, options) =&gt; {
  return hashPassword(user.password).then(hashedPw =&gt; {
    user.password = hashedPw;
  });
});

User.afterValidate('myHookAfter', (user, options) =&gt; {
  user.username = 'Toni';
});</code>
</code></pre><h2>Removing hooks</h2><p>Only a hook with name param can be removed.</p><pre><code class="lang-js"><code class="source-code prettyprint">const Book = sequelize.define('book', {
  title: DataTypes.STRING
});

Book.addHook('afterCreate', 'notifyUsers', (book, options) =&gt; {
  // ...
});

Book.removeHook('afterCreate', 'notifyUsers');</code>
</code></pre><p>You can have many hooks with same name. Calling <code>.removeHook()</code> will remove all of them.</p><h2>Global / universal hooks</h2><p>Global hooks are hooks which are run for all models. They can define behaviours that you want for all your models, and are especially useful for plugins. They can be defined in two ways, which have slightly different semantics:</p><h3>Sequelize.options.define (default hook)</h3><pre><code class="lang-js"><code class="source-code prettyprint">const sequelize = new Sequelize(..., {
    define: {
        hooks: {
            beforeCreate: () =&gt; {
                // Do stuff
            }
        }
    }
});</code>
</code></pre><p>This adds a default hook to all models, which is run if the model does not define its own <code>beforeCreate</code> hook:</p><pre><code class="lang-js"><code class="source-code prettyprint">const User = sequelize.define('user');
const Project = sequelize.define('project', {}, {
    hooks: {
        beforeCreate: () =&gt; {
            // Do other stuff
        }
    }
});

User.create() // Runs the global hook
Project.create() // Runs its own hook (because the global hook is overwritten)</code>
</code></pre><h3>Sequelize.addHook (permanent hook)</h3><pre><code class="lang-js"><code class="source-code prettyprint">sequelize.addHook('beforeCreate', () =&gt; {
    // Do stuff
});</code>
</code></pre><p>This hooks is always run before create, regardless of whether the model specifies its own <code>beforeCreate</code> hook:</p><pre><code class="lang-js"><code class="source-code prettyprint">const User = sequelize.define('user');
const Project = sequelize.define('project', {}, {
    hooks: {
        beforeCreate: () =&gt; {
            // Do other stuff
        }
    }
});

User.create() // Runs the global hook
Project.create() // Runs its own hook, followed by the global hook</code>
</code></pre><p>Local hooks are always run before global hooks.</p><h3>Instance hooks</h3><p>The following hooks will emit whenever you're editing a single object</p><pre><code><code class="source-code prettyprint">beforeValidate
afterValidate or validationFailed
beforeCreate / beforeUpdate  / beforeDestroy
afterCreate / afterUpdate / afterDestroy</code>
</code></pre><pre><code class="lang-js"><code class="source-code prettyprint">// ...define ...
User.beforeCreate(user =&gt; {
  if (user.accessLevel &gt; 10 &amp;&amp; user.username !== "Boss") {
    throw new Error("You can't grant this user an access level above 10!")
  }
})</code>
</code></pre><p>This example will return an error:</p><pre><code class="lang-js"><code class="source-code prettyprint">User.create({username: 'Not a Boss', accessLevel: 20}).catch(err =&gt; {
  console.log(err); // You can't grant this user an access level above 10!
});</code>
</code></pre><p>The following example would return successful:</p><pre><code class="lang-js"><code class="source-code prettyprint">User.create({username: 'Boss', accessLevel: 20}).then(user =&gt; {
  console.log(user); // user object with username as Boss and accessLevel of 20
});</code>
</code></pre><h3>Model hooks</h3><p>Sometimes you'll be editing more than one record at a time by utilizing the <code>bulkCreate, update, destroy</code> methods on the model. The following will emit whenever you're using one of those methods:</p><pre><code><code class="source-code prettyprint">beforeBulkCreate(instances, options)
beforeBulkUpdate(options)
beforeBulkDestroy(options)
afterBulkCreate(instances, options)
afterBulkUpdate(options)
afterBulkDestroy(options)</code>
</code></pre><p>If you want to emit hooks for each individual record, along with the bulk hooks you can pass <code>individualHooks: true</code> to the call.</p><pre><code class="lang-js"><code class="source-code prettyprint">Model.destroy({ where: {accessLevel: 0}, individualHooks: true});
// Will select all records that are about to be deleted and emit before- + after- Destroy on each instance

Model.update({username: 'Toni'}, { where: {accessLevel: 0}, individualHooks: true});
// Will select all records that are about to be updated and emit before- + after- Update on each instance</code>
</code></pre><p>The <code>options</code> argument of hook method would be the second argument provided to the corresponding method or its
cloned and extended version.</p><pre><code class="lang-js"><code class="source-code prettyprint">Model.beforeBulkCreate((records, {fields}) =&gt; {
  // records = the first argument sent to .bulkCreate
  // fields = one of the second argument fields sent to .bulkCreate
})

Model.bulkCreate([
    {username: 'Toni'}, // part of records argument
    {username: 'Tobi'} // part of records argument
  ], {fields: ['username']} // options parameter
)

Model.beforeBulkUpdate(({attributes, where}) =&gt; {
  // where - in one of the fields of the clone of second argument sent to .update
  // attributes - is one of the fields that the clone of second argument of .update would be extended with
})

Model.update({gender: 'Male'} /*attributes argument*/, { where: {username: 'Tom'}} /*where argument*/)

Model.beforeBulkDestroy(({where, individualHooks}) =&gt; {
  // individualHooks - default of overridden value of extended clone of second argument sent to Model.destroy
  // where - in one of the fields of the clone of second argument sent to Model.destroy
})

Model.destroy({ where: {username: 'Tom'}} /*where argument*/)</code>
</code></pre><p>If you use <code>Model.bulkCreate(...)</code> with the <code>updatesOnDuplicate</code> option, changes made in the hook to fields that aren't given in the <code>updatesOnDuplicate</code> array will not be persisted to the database. However it is possible to change the updatesOnDuplicate option inside the hook if this is what you want.</p><pre><code class="lang-js"><code class="source-code prettyprint">// Bulk updating existing users with updatesOnDuplicate option
Users.bulkCreate([
  { id: 1, isMember: true },
  { id: 2, isMember: false }
], {
  updatesOnDuplicate: ['isMember']
});

User.beforeBulkCreate((users, options) =&gt; {
  for (const user of users) {
    if (user.isMember) {
      user.memberSince = new Date();
    }
  }

  // Add memberSince to updatesOnDuplicate otherwise the memberSince date wont be
  // saved to the database
  options.updatesOnDuplicate.push('memberSince');
});</code>
</code></pre><h2>Associations</h2><p>For the most part hooks will work the same for instances when being associated except a few things</p><ol>
<li>When using add/set functions the beforeUpdate/afterUpdate hooks will run.</li>
<li>The only way to call beforeDestroy/afterDestroy hooks are on associations with <code>onDelete: 'cascade'</code> and the option <code>hooks: true</code>. For instance:</li>
</ol><pre><code class="lang-js"><code class="source-code prettyprint">const Projects = sequelize.define('projects', {
  title: DataTypes.STRING
});

const Tasks = sequelize.define('tasks', {
  title: DataTypes.STRING
});

Projects.hasMany(Tasks, { onDelete: 'cascade', hooks: true });
Tasks.belongsTo(Projects);</code>
</code></pre><p>This code will run beforeDestroy/afterDestroy on the Tasks table. Sequelize, by default, will try to optimize your queries as much as possible. When calling cascade on delete, Sequelize will simply execute a</p><pre><code class="lang-sql"><code class="source-code prettyprint">DELETE FROM `table` WHERE associatedIdentifier = associatedIdentifier.primaryKey</code>
</code></pre><p>However, adding <code>hooks: true</code> explicitly tells Sequelize that optimization is not of your concern and will perform a <code>SELECT</code> on the associated objects and destroy each instance one by one in order to be able to call the hooks with the right parameters.</p><p>If your association is of type <code>n:m</code>, you may be interested in firing hooks on the through model when using the <code>remove</code> call. Internally, sequelize is using <code>Model.destroy</code> resulting in calling the <code>bulkDestroy</code> instead of the <code>before/afterDestroy</code> hooks on each through instance.</p><p>This can be simply solved by passing <code>{individualHooks: true}</code> to the <code>remove</code> call, resulting on each hook to be called on each removed through instance object.</p><h2>A Note About Transactions</h2><p>Note that many model operations in Sequelize allow you to specify a transaction in the options parameter of the method. If a transaction <em>is</em> specified in the original call, it will be present in the options parameter passed to the hook function. For example, consider the following snippet:</p><pre><code class="lang-js"><code class="source-code prettyprint">// Here we use the promise-style of async hooks rather than
// the callback.
User.hook('afterCreate', (user, options) =&gt; {
  // 'transaction' will be available in options.transaction

  // This operation will be part of the same transaction as the
  // original User.create call.
  return User.update({
    mood: 'sad'
  }, {
    where: {
      id: user.id
    },
    transaction: options.transaction
  });
});


sequelize.transaction(transaction =&gt; {
  User.create({
    username: 'someguy',
    mood: 'happy',
    transaction
  });
});</code>
</code></pre><p>If we had not included the transaction option in our call to <code>User.update</code> in the preceding code, no change would have occurred, since our newly created user does not exist in the database until the pending transaction has been committed.</p><h3>Internal Transactions</h3><p>It is very important to recognize that sequelize may make use of transactions internally for certain operations such as <code>Model.findOrCreate</code>. If your hook functions execute read or write operations that rely on the object's presence in the database, or modify the object's stored values like the example in the preceding section, you should always specify <code>{ transaction: options.transaction }</code>.</p><p>If the hook has been called in the process of a transacted operation, this makes sure that your dependent read/write is a part of that same transaction. If the hook is not transacted, you have simply specified <code>{ transaction: null }</code> and can expect the default behaviour.</p></div>
        <a data-ice="link" href="/v4/manual/tutorial/hooks.html"></a>
      </div>
    </div>
<div class="manual-card-wrap" data-ice="cards">
      <h1 data-ice="label" class="manual-color manual-color-tutorial" data-section-count="■"><span data-ice="label-inner">Raw queries</span></h1>
      <div class="manual-card">
        <div data-ice="card"><h1>Raw queries</h1><p>As there are often use cases in which it is just easier to execute raw / already prepared SQL queries, you can utilize the function <code>sequelize.query</code>.</p><p>By default the function will return two arguments - a results array, and an object containing metadata (affected rows etc.). Note that since this is a raw query, the metadata (property names etc.) is dialect specific. Some dialects return the metadata "within" the results object (as properties on an array). However, two arguments will always be returned, but for MSSQL and MySQL it will be two references to the same object.</p><pre><code class="lang-js"><code class="source-code prettyprint">sequelize.query("UPDATE users SET y = 42 WHERE x = 12").spread((results, metadata) =&gt; {
  // Results will be an empty array and metadata will contain the number of affected rows.
})</code>
</code></pre><p>In cases where you don't need to access the metadata you can pass in a query type to tell sequelize how to format the results. For example, for a simple select query you could do:</p><pre><code class="lang-js"><code class="source-code prettyprint">sequelize.query("SELECT * FROM `users`", { type: sequelize.QueryTypes.SELECT})
  .then(users =&gt; {
    // We don't need spread here, since only the results will be returned for select queries
  })</code>
</code></pre><p>Several other query types are available. <a href="https://github.com/sequelize/sequelize/blob/master/lib/query-types.js">Peek into the source for details</a></p><p>A second option is the model. If you pass a model the returned data will be instances of that model.</p><pre><code class="lang-js"><code class="source-code prettyprint">// Callee is the model definition. This allows you to easily map a query to a predefined model
sequelize
  .query('SELECT * FROM projects', {
    model: Projects,
    mapToModel: true // pass true here if you have any mapped fields
  })
  .then(projects =&gt; {
    // Each record will now be an instance of Project
  })</code>
</code></pre><h2>Replacements</h2><p>Replacements in a query can be done in two different ways, either using named parameters (starting with <code>:</code>), or unnamed, represented by a <code>?</code>. Replacements are passed in the options object.</p><ul>
<li>If an array is passed, <code>?</code> will be replaced in the order that they appear in the array</li>
<li>If an object is passed, <code>:key</code> will be replaced with the keys from that object. If the object contains keys not found in the query or vice versa, an exception will be thrown.</li>
</ul><pre><code class="lang-js"><code class="source-code prettyprint">sequelize.query('SELECT * FROM projects WHERE status = ?',
  { replacements: ['active'], type: sequelize.QueryTypes.SELECT }
).then(projects =&gt; {
  console.log(projects)
})

sequelize.query('SELECT * FROM projects WHERE status = :status ',
  { replacements: { status: 'active' }, type: sequelize.QueryTypes.SELECT }
).then(projects =&gt; {
  console.log(projects)
})</code>
</code></pre><p>Array replacements will automatically be handled, the following query searches for projects where the status matches an array of values.</p><pre><code class="lang-js"><code class="source-code prettyprint">sequelize.query('SELECT * FROM projects WHERE status IN(:status) ',
  { replacements: { status: ['active', 'inactive'] }, type: sequelize.QueryTypes.SELECT }
).then(projects =&gt; {
  console.log(projects)
})</code>
</code></pre><p>To use the wildcard operator %, append it to your replacement. The following query matches users with names that start with 'ben'.</p><pre><code class="lang-js"><code class="source-code prettyprint">sequelize.query('SELECT * FROM users WHERE name LIKE :search_name ',
  { replacements: { search_name: 'ben%'  }, type: sequelize.QueryTypes.SELECT }
).then(projects =&gt; {
  console.log(projects)
})</code>
</code></pre><h2>Bind Parameter</h2><p>Bind parameters are like replacements. Except replacements are escaped and inserted into the query by sequelize before the query is sent to the database, while bind parameters are sent to the database outside the SQL query text. A query can have either bind parameters or replacements. Bind parameters are referred to by either $1, $2, ... (numeric) or $key (alpha-numeric). This is independent of the dialect.</p><ul>
<li>If an array is passed, <code>$1</code> is bound to the 1st element in the array (<code>bind[0]</code>)</li>
<li>If an object is passed, <code>$key</code> is bound to <code>object['key']</code>. Each key must begin with a non-numeric char. <code>$1</code> is not a valid key, even if <code>object['1']</code> exists.</li>
<li>In either case <code>$$</code> can be used to escape a literal <code>$</code> sign.</li>
</ul><p>The array or object must contain all bound values or Sequelize will throw an exception. This applies even to cases in which the database may ignore the bound parameter.</p><p>The database may add further restrictions to this. Bind parameters cannot be SQL keywords, nor table or column names. They are also ignored in quoted text or data. In PostgreSQL it may also be needed to typecast them, if the type cannot be inferred from the context <code>$1::varchar</code>.</p><pre><code class="lang-js"><code class="source-code prettyprint">sequelize.query('SELECT *, "text with literal $$1 and literal $$status" as t FROM projects WHERE status = $1',
  { bind: ['active'], type: sequelize.QueryTypes.SELECT }
).then(projects =&gt; {
  console.log(projects)
})

sequelize.query('SELECT *, "text with literal $$1 and literal $$status" as t FROM projects WHERE status = $status',
  { bind: { status: 'active' }, type: sequelize.QueryTypes.SELECT }
).then(projects =&gt; {
  console.log(projects)
})</code>
</code></pre></div>
        <a data-ice="link" href="/v4/manual/tutorial/raw-queries.html"></a>
      </div>
    </div>
<div class="manual-card-wrap" data-ice="cards">
      <h1 data-ice="label" class="manual-color manual-color-tutorial" data-section-count="■■■■■"><span data-ice="label-inner">Migrations</span></h1>
      <div class="manual-card">
        <div data-ice="card"><h1>Migrations</h1><p>Just like you use Git / SVN to manage changes in your source code, you can use migrations to keep track of changes to the database. With migrations you can transfer your existing database into another state and vice versa: Those state transitions are saved in migration files, which describe how to get to the new state and how to revert the changes in order to get back to the old state.</p><p>You will need <a href="https://github.com/sequelize/cli">Sequelize CLI</a>. The CLI ships support for migrations and project bootstrapping.</p><h2>The CLI</h2><h3>Installing CLI</h3><p>Let's start with installing CLI, you can find instructions <a href="https://github.com/sequelize/cli">here</a>. Most preferred way is installing locally like this</p><pre><code class="lang-bash"><code class="source-code prettyprint">$ npm install --save sequelize-cli</code>
</code></pre><h3>Bootstrapping</h3><p>To create an empty project you will need to execute <code>init</code> command</p><pre><code class="lang-bash"><code class="source-code prettyprint">$ node_modules/.bin/sequelize init</code>
</code></pre><p>This will create following folders</p><ul>
<li><code>config</code>, contains config file, which tells CLI how to connect with database</li>
<li><code>models</code>, contains all models for your project</li>
<li><code>migrations</code>, contains all migration files</li>
<li><code>seeders</code>, contains all seed files</li>
</ul><h4>Configuration</h4><p>Before continuing further we will need to tell CLI how to connect to database. To do that let's open default config file <code>config/config.json</code>. It looks something like this</p><pre><code class="lang-json"><code class="source-code prettyprint">{
  "development": {
    "username": "root",
    "password": null,
    "database": "database_development",
    "host": "127.0.0.1",
    "dialect": "mysql"
  },
  "test": {
    "username": "root",
    "password": null,
    "database": "database_test",
    "host": "127.0.0.1",
    "dialect": "mysql"
  },
  "production": {
    "username": "root",
    "password": null,
    "database": "database_test",
    "host": "127.0.0.1",
    "dialect": "mysql"
  }
}</code>
</code></pre><p>Now edit this file and set correct database credentials and dialect.</p><p><strong>Note:</strong> <em>If your database doesn't exists yet, you can just call <code>db:create</code> command. With proper access it will create that database for you.</em></p><h3>Creating first Model (and Migration)</h3><p>Once you have properly configured CLI config file you are ready to create your first migration. It's as simple as executing a simple command.</p><p>We will use <code>model:generate</code> command. This command requires two options</p><ul>
<li><code>name</code>, Name of the model</li>
<li><code>attributes</code>, List of model attributes</li>
</ul><p>Let's create a model named <code>User</code>.</p><pre><code class="lang-bash"><code class="source-code prettyprint">$ node_modules/.bin/sequelize model:generate --name User --attributes firstName:string,lastName:string,email:string</code>
</code></pre><p>This will do following</p><ul>
<li>Create a model file <code>user</code> in <code>models</code> folder</li>
<li>Create a migration file with name like <code>XXXXXXXXXXXXXX-create-user.js</code> in <code>migrations</code> folder</li>
</ul><p><strong>Note:</strong> <em>Sequelize will only use Model files, it's the table representation. On the other hand, the migration file is a change in that model or more specifically that table, used by CLI. Treat migrations like a commit or a log for some change in database.</em></p><h3>Running Migrations</h3><p>Until this step, we haven't inserted anything into the database. We have just created required model and migration files for our first model <code>User</code>. Now to actually create that table in database you need to run <code>db:migrate</code> command.</p><pre><code class="lang-bash"><code class="source-code prettyprint">$ node_modules/.bin/sequelize db:migrate</code>
</code></pre><p>This command will execute these steps:</p><ul>
<li>Will ensure a table called <code>SequelizeMeta</code> in database. This table is used to record which migrations have run on the current database</li>
<li>Start looking for any migration files which haven't run yet. This is possible by checking <code>SequelizeMeta</code> table. In this case it will run <code>XXXXXXXXXXXXXX-create-user.js</code> migration, which we created in last step.</li>
<li>Creates a table called <code>Users</code> with all columns as specified in its migration file.</li>
</ul><h3>Undoing Migrations</h3><p>Now our table has been created and saved in database. With migration you can revert to old state by just running a command.</p><p>You can use <code>db:migrate:undo</code>, this command will revert most recent migration.</p><pre><code class="lang-bash"><code class="source-code prettyprint">$ node_modules/.bin/sequelize db:migrate:undo</code>
</code></pre><p>You can revert back to initial state by undoing all migrations with <code>db:migrate:undo:all</code> command. You can also revert back to a specific migration by passing its name in <code>--to</code> option.</p><pre><code class="lang-bash"><code class="source-code prettyprint">$ node_modules/.bin/sequelize db:migrate:undo:all --to XXXXXXXXXXXXXX-create-posts.js</code>
</code></pre><h3>Creating First Seed</h3><p>Suppose we want to insert some data into a few tables by default. If we follow up on previous example we can consider creating a demo user for <code>User</code> table.</p><p>To manage all data migrations you can use seeders. Seed files are some change in data that can be used to populate database table with sample data or test data.</p><p>Let's create a seed file which will add a demo user to our <code>User</code> table.</p><pre><code class="lang-bash"><code class="source-code prettyprint">$ node_modules/.bin/sequelize seed:generate --name demo-user</code>
</code></pre><p>This command will create a seed file in <code>seeders</code> folder. File name will look something like <code>XXXXXXXXXXXXXX-demo-user.js</code>. It follows the same <code>up / down</code> semantics as the migration files.</p><p>Now we should edit this file to insert demo user to <code>User</code> table.</p><pre><code class="lang-js"><code class="source-code prettyprint">'use strict';

module.exports = {
  up: (queryInterface, Sequelize) =&gt; {
    return queryInterface.bulkInsert('Users', [{
        firstName: 'John',
        lastName: 'Doe',
        email: 'demo@demo.com'
      }], {});
  },

  down: (queryInterface, Sequelize) =&gt; {
    return queryInterface.bulkDelete('Users', null, {});
  }
};</code>
</code></pre><h3>Running Seeds</h3><p>In last step you have create a seed file. It's still not committed to database. To do that we need to run a simple command.</p><pre><code class="lang-bash"><code class="source-code prettyprint">$ node_modules/.bin/sequelize db:seed:all</code>
</code></pre><p>This will execute that seed file and you will have a demo user inserted into <code>User</code> table.</p><p><strong>Note:</strong> <em>Seeders execution is not stored anywhere unlike migrations, which use the <code>SequelizeMeta</code> table. If you wish to override this please read <code>Storage</code> section</em></p><h3>Undoing Seeds</h3><p>Seeders can be undone if they are using any storage. There are two commands available for that:</p><p>If you wish to undo most recent seed</p><pre><code class="lang-bash"><code class="source-code prettyprint">node_modules/.bin/sequelize db:seed:undo</code>
</code></pre><p>If you wish to undo all seeds</p><pre><code class="lang-bash"><code class="source-code prettyprint">node_modules/.bin/sequelize db:seed:undo:all</code>
</code></pre><h2>Advance Topics</h2><h3>Migration Skeleton</h3><p>The following skeleton shows a typical migration file.</p><pre><code class="lang-js"><code class="source-code prettyprint">module.exports = {
  up: (queryInterface, Sequelize) =&gt; {
    // logic for transforming into the new state
  },

  down: (queryInterface, Sequelize) =&gt; {
    // logic for reverting the changes
  }
}</code>
</code></pre><p>The passed <code>queryInterface</code> object can be used to modify the database. The <code>Sequelize</code> object stores the available data types such as <code>STRING</code> or <code>INTEGER</code>. Function <code>up</code> or <code>down</code> should return a <code>Promise</code>. Let's look at an example:</p><pre><code class="lang-js"><code class="source-code prettyprint">module.exports = {
  up: (queryInterface, Sequelize) =&gt; {
    return queryInterface.createTable('Person', {
        name: Sequelize.STRING,
        isBetaMember: {
          type: Sequelize.BOOLEAN,
          defaultValue: false,
          allowNull: false
        }
      });
  },
  down: (queryInterface, Sequelize) =&gt; {
    return queryInterface.dropTable('Person');
  }
}</code>
</code></pre><h3>The <code>.sequelizerc</code> File</h3><p>This is a special configuration file. It lets you specify various options that you would usually pass as arguments to CLI. Some scenarios where you can use it.</p><ul>
<li>You want to override default path to <code>migrations</code>, <code>models</code>, <code>seeders</code> or <code>config</code> folder.</li>
<li>You want to rename <code>config.json</code> to something else like <code>database.json</code></li>
</ul><p>And a whole lot more. Let's see how you can use this file for custom configuration.</p><p>For starters, let's create an empty file in root directory of your project.</p><pre><code class="lang-bash"><code class="source-code prettyprint">$ touch .sequelizerc</code>
</code></pre><p>Now let's work with an example config.</p><pre><code class="lang-js"><code class="source-code prettyprint">const path = require('path');

module.exports = {
  'config': path.resolve('config', 'database.json'),
  'models-path': path.resolve('db', 'models'),
  'seeders-path': path.resolve('db', 'seeders'),
  'migrations-path': path.resolve('db', 'migrations')
}</code>
</code></pre><p>With this config you are telling CLI to</p><ul>
<li>Use <code>config/database.json</code> file for config settings</li>
<li>Use <code>db/models</code> as models folder</li>
<li>Use <code>db/seeders</code> as seeders folder</li>
<li>Use <code>db/migrations</code> as migrations folder</li>
</ul><h3>Dynamic Configuration</h3><p>Configuration file is by default a JSON file called <code>config.json</code>. But sometimes you want to execute some code or access environment variables which is not possible in JSON files.</p><p>Sequelize CLI can read from both <code>JSON</code> and <code>JS</code> files. This can be setup with <code>.sequelizerc</code> file. Let see how</p><p>First you need to create a <code>.sequelizerc</code> file in root folder of your project. This file should override config path to a <code>JS</code> file. Like this</p><pre><code class="lang-js"><code class="source-code prettyprint">const path = require('path');

module.exports = {
  'config': path.resolve('config', 'config.js')
}</code>
</code></pre><p>Now Sequelize CLI will load <code>config/config.js</code> for getting configuration options. Since this is a JS file you can have any code executed and export final dynamic configuration file.</p><p>An example of <code>config/config.js</code> file</p><pre><code class="lang-js"><code class="source-code prettyprint">const fs = require('fs');

module.exports = {
  development: {
    username: 'database_dev',
    password: 'database_dev',
    database: 'database_dev',
    host: '127.0.0.1',
    dialect: 'mysql'
  },
  test: {
    username: 'database_test',
    password: null,
    database: 'database_test',
    host: '127.0.0.1',
    dialect: 'mysql'
  },
  production: {
    username: process.env.DB_USERNAME,
    password: process.env.DB_PASSWORD,
    database: process.env.DB_NAME,
    host: process.env.DB_HOSTNAME,
    dialect: 'mysql',
    dialectOptions: {
      ssl: {
        ca: fs.readFileSync(__dirname + '/mysql-ca-master.crt')
      }
    }
  }
};</code>
</code></pre><h3>Using Environment Variables</h3><p>With CLI you can directly access the environment variables inside the <code>config/config.js</code>. You can use <code>.sequelizerc</code> to tell CLI to use <code>config/config.js</code> for configuration. This is explained in last section.</p><p>Then you can just expose file with proper environment variables.</p><pre><code class="lang-js"><code class="source-code prettyprint">module.exports = {
  development: {
    username: 'database_dev',
    password: 'database_dev',
    database: 'database_dev',
    host: '127.0.0.1',
    dialect: 'mysql'
  },
  test: {
    username: process.env.CI_DB_USERNAME,
    password: process.env.CI_DB_PASSWORD,
    database: process.env.CI_DB_NAME,
    host: '127.0.0.1',
    dialect: 'mysql'
  },
  production: {
    username: process.env.PROD_DB_USERNAME,
    password: process.env.PROD_DB_PASSWORD,
    database: process.env.PROD_DB_NAME,
    host: process.env.PROD_DB_HOSTNAME,
    dialect: 'mysql'
  }</code>
</code></pre><h3>Specifying Dialect Options</h3><p>Sometime you want to specify a dialectOption, if it's a general config you can just add it in <code>config/config.json</code>. Sometime you want to execute some code to get dialectOptions, you should use dynamic config file for those cases.</p><pre><code class="lang-json"><code class="source-code prettyprint">{
    "production": {
        "dialect":"mysql",
        "dialectOptions": {
            "bigNumberStrings": true
        }
    }
}</code>
</code></pre><h3>Production Usages</h3><p>Some tips around using CLI and migration setup in production environment.</p><p>1) Use environment variables for config settings. This is better achieved with dynamic configuration. A sample production safe configuration may look like.</p><pre><code class="lang-js"><code class="source-code prettyprint">const fs = require('fs');

module.exports = {
  development: {
    username: 'database_dev',
    password: 'database_dev',
    database: 'database_dev',
    host: '127.0.0.1',
    dialect: 'mysql'
  },
  test: {
    username: 'database_test',
    password: null,
    database: 'database_test',
    host: '127.0.0.1',
    dialect: 'mysql'
  },
  production: {
    username: process.env.DB_USERNAME,
    password: process.env.DB_PASSWORD,
    database: process.env.DB_NAME,
    host: process.env.DB_HOSTNAME,
    dialect: 'mysql',
    dialectOptions: {
      ssl: {
        ca: fs.readFileSync(__dirname + '/mysql-ca-master.crt')
      }
    }
  }
};</code>
</code></pre><p>Our goal is to use environment variables for various database secrets and not accidentally check them in to source control.</p><h3>Storage</h3><p>There are three types of storage that you can use: <code>sequelize</code>, <code>json</code>, and <code>none</code>.</p><ul>
<li><code>sequelize</code> : stores migrations and seeds in a table on the sequelize database</li>
<li><code>json</code> : stores migrations and seeds on a json file</li>
<li><code>none</code> : does not store any migration/seed</li>
</ul><h4>Migration Storage</h4><p>By default the CLI will create a table in your database called <code>SequelizeMeta</code> containing an entry
for each executed migration. To change this behavior, there are three options you can add to the
configuration file. Using <code>migrationStorage</code>, you can choose the type of storage to be used for
migrations. If you choose <code>json</code>, you can specify the path of the file using <code>migrationStoragePath</code>
or the CLI will write to the file <code>sequelize-meta.json</code>. If you want to keep the information in the
database, using <code>sequelize</code>, but want to use a different table, you can change the table name using
<code>migrationStorageTableName</code>.</p><pre><code class="lang-json"><code class="source-code prettyprint">{
  "development": {
    "username": "root",
    "password": null,
    "database": "database_development",
    "host": "127.0.0.1",
    "dialect": "mysql",

    // Use a different storage type. Default: sequelize
    "migrationStorage": "json",

    // Use a different file name. Default: sequelize-meta.json
    "migrationStoragePath": "sequelizeMeta.json",

    // Use a different table name. Default: SequelizeMeta
    "migrationStorageTableName": "sequelize_meta"
  }
}</code>
</code></pre><p><strong>Note:</strong> <em>The <code>none</code> storage is not recommended as a migration storage. If you decide to use it, be
aware of the implications of having no record of what migrations did or didn't run.</em></p><h4>Seed Storage</h4><p>By default the CLI will not save any seed that is executed. If you choose to change this behavior (!),
you can use <code>seederStorage</code> in the configuration file to change the storage type. If you choose <code>json</code>,
you can specify the path of the file using <code>seederStoragePath</code> or the CLI will write to the file
<code>sequelize-data.json</code>. If you want to keep the information in the database, using <code>sequelize</code>, you can
specify the table name using <code>seederStorageTableName</code>, or it will default to <code>SequelizeData</code>.</p><pre><code class="lang-json"><code class="source-code prettyprint">{
  "development": {
    "username": "root",
    "password": null,
    "database": "database_development",
    "host": "127.0.0.1",
    "dialect": "mysql",
    // Use a different storage. Default: none
    "seederStorage": "json",
    // Use a different file name. Default: sequelize-data.json
    "seederStoragePath": "sequelizeData.json",
    // Use a different table name. Default: SequelizeData
    "seederStorageTableName": "sequelize_data"
  }
}</code>
</code></pre><h3>Configuration Connection String</h3><p>As an alternative to the <code>--config</code> option with configuration files defining your database, you can
use the <code>--url</code> option to pass in a connection string. For example:</p><pre><code class="lang-bash"><code class="source-code prettyprint">$ node_modules/.bin/sequelize db:migrate --url 'mysql://root:password@mysql_host.com/database_name'</code>
</code></pre><h3>Connecting over SSL</h3><p>Ensure ssl is specified in both <code>dialectOptions</code> and in the base config.</p><pre><code class="lang-json"><code class="source-code prettyprint">{
    "production": {
        "dialect":"postgres",
        "ssl": true,
        "dialectOptions": {
            "ssl": true
        }
    }
}</code>
</code></pre><h3>Programmatic use</h3><p>Sequelize has a <a href="https://github.com/sequelize/umzug">sister library</a> for programmatically handling execution and logging of migration tasks.</p><h2>Query Interface</h2><p>Using <code>queryInterface</code> object described before you can change database schema. To see full list of public methods it supports check <a href="/v4/class/lib/query-interface.js~QueryInterface.html">QueryInterface API</a></p></div>
        <a data-ice="link" href="/v4/manual/tutorial/migrations.html"></a>
      </div>
    </div>
<div class="manual-card-wrap" data-ice="cards">
      <h1 data-ice="label" class="manual-color manual-color-tutorial" data-section-count="■■■"><span data-ice="label-inner">Upgrade to V4</span></h1>
      <div class="manual-card">
        <div data-ice="card"><h1>Upgrade to V4</h1><p>Sequelize v4 is the current release and it introduces some breaking changes. Majority of sequelize codebase has been refactored to use ES2015 features. The following guide lists some of the changes to upgrade from v3 to v4.</p><h2>Changelog</h2><p>Full <a href="https://github.com/sequelize/sequelize/blob/b49f936e9aa316cf4a13bade76585acf4d5d8b04/changelog.md">Changelog</a> for v4 release.</p><h2>Breaking Changes</h2><h3>Node</h3><p>To use new ES2015 features, Sequelize v4 requires at least Node v4 or above.</p><h3>General</h3><ul>
<li>Counter Cache plugin and consequently the <code>counterCache</code> option for associations has been removed.</li>
<li>MariaDB dialect now removed. This was just a thin wrapper around MySQL. You can set <code>dialect: 'mysql'</code> an d Sequelize should be able to work with MariaDB server.</li>
<li><code>Model.Instance</code> and <code>instance.Model</code> are removed. To access the Model from an instance, simply use <a href="https://developer.mozilla.org/en/docs/Web/JavaScript/Reference/Global_Objects/Object/constructor"><code>instance.constructor</code></a>. The Instance class (<code>Model.Instance</code>) is now the Model itself.</li>
<li>Sequelize now uses an independent copy of bluebird library.</li>
<li>Promises returned by sequelize are now instances of <code>Sequelize.Promise</code> instead of global bluebird <code>Promise</code>.</li>
<li>Pooling library was updated to <code>v3</code>, now you will need to call <code>sequelize.close()</code> to shutdown the pool.</li>
</ul><h3>Config / Options</h3><ul>
<li><p>Removed support for old connection pooling configuration keys. Instead of</p>
<p><strong>Old</strong></p>
<pre><code class="lang-js"><code class="source-code prettyprint">  pool: {
    maxIdleTime: 30000,
    minConnections: 20,
    maxConnections: 30
  }</code>
</code></pre>
<p><strong>New</strong></p>
<pre><code class="lang-js"><code class="source-code prettyprint">  pool: {
    idle: 30000,
    min: 20,
    max: 30
  }</code>
</code></pre>
</li>
<li>Removed support for <code>pool: false</code>. To use a single connection, set <code>pool.max</code> to 1.</li>
<li>Removed support for <code>referencesKey</code>, use a references object<pre><code class="lang-js"><code class="source-code prettyprint">  references: {
    key: '',
    model: ''
  }</code>
</code></pre>
</li>
<li><p>Removed <code>classMethods</code> and <code>instanceMethods</code> options from <code>sequelize.define</code>. Sequelize models
are now ES6 classes. You can set class / instance level methods like this</p>
<p><strong>Old</strong></p>
<pre><code class="lang-js"><code class="source-code prettyprint">const Model = sequelize.define('Model', {
    ...
}, {
    classMethods: {
        associate: function (model) {...}
    },
    instanceMethods: {
        someMethod: function () { ...}
    }
});</code>
</code></pre>
<p><strong>New</strong></p>
<pre><code class="lang-js"><code class="source-code prettyprint">const Model = sequelize.define('Model', {
    ...
});

// Class Method
Model.associate = function (models) {
    ...associate the models
};

// Instance Method
Model.prototype.someMethod = function () {..}</code>
</code></pre>
</li>
<li><p><code>options.order</code> now only accepts values with type of array or Sequelize method. Support for string values (ie <code>{order: 'name DESC'}</code>) has been deprecated.</p>
</li>
<li>With <code>BelongsToMany</code> relationships <code>add/set/create</code> setters now set through attributes by passing them as <code>options.through</code> (previously second argument was used as through attributes, now it's considered options with <code>through</code> being a sub option)</li>
<li><p>Raw options for where, order and group like <code>where: { $raw: '..', order: [{ raw: '..' }], group: [{ raw: '..' }] }</code> have been removed to prevent SQL injection attacks.</p>
<p><strong>Old</strong></p>
<pre><code class="lang-js"><code class="source-code prettyprint">user.addProject(project, { status: 'started' });</code>
</code></pre>
<p><strong>New</strong></p>
<pre><code class="lang-js"><code class="source-code prettyprint">user.addProject(project, { through: { status: 'started' } });</code>
</code></pre>
</li>
</ul><h3>Data Types</h3><ul>
<li>(MySQL/Postgres) <code>BIGINT</code> now returned as string.</li>
<li>(MySQL/Postgres) <code>DECIMAL</code> and <code>NEWDECIMAL</code> types now returned as string.</li>
<li>(MSSQL) <code>DataTypes.DATE</code> now uses <code>DATETIMEOFFSET</code> instead of <code>DATETIME2</code> sql datatype in case of MSSQL to record timezone. To migrate existing <code>DATETIME2</code> columns into <code>DATETIMEOFFSET</code>, see <a href="https://github.com/sequelize/sequelize/pull/7201#issuecomment-278899803">#7201</a>.</li>
<li><code>DATEONLY</code> now returns string in <code>YYYY-MM-DD</code> format rather than <code>Date</code> type</li>
</ul><h3>Transactions / CLS</h3><ul>
<li>Removed <code>autocommit: true</code> default, set this option explicitly to have transactions auto commit.</li>
<li>Removed default <code>REPEATABLE_READ</code> transaction isolation. The isolation level now defaults to that of the database. Explicitly pass the required isolation level when initiating the transaction.</li>
<li><p>The CLS patch does not affect global bluebird promise. Transaction will not automatically get passed to methods when used with <code>Promise.all</code> and other bluebird methods. Explicitly patch your bluebird instance to get CLS to work with bluebird methods.</p>
<pre><code class="lang-bash"><code class="source-code prettyprint">  $ npm install --save cls-bluebird</code>
</code></pre>
<pre><code class="lang-js"><code class="source-code prettyprint">  const Sequelize = require('sequelize');
  const Promise = require('bluebird');
  const clsBluebird = require('cls-bluebird');
  const cls = require('continuation-local-storage');

  const ns = cls.createNamespace('transaction-namespace');
  clsBluebird(ns, Promise);

  Sequelize.useCLS(ns);</code>
</code></pre>
</li>
</ul><h3>Raw Queries</h3><ul>
<li>Sequelize now supports bind parameters for all dialects. In v3 <code>bind</code> option would fallback to <code>replacements</code> if dialect didn't supported binding. This could be a breaking change for MySQL / MSSQL where now queries will actually use bind parameters instead of replacements fallback.</li>
</ul><h3>Others</h3><ul>
<li><code>Sequelize.Validator</code> is now an independent copy of <code>validator</code> library.</li>
<li><code>Model.validate</code> instance method now runs validation hooks by default. Previously you needed to pass <code>{ hooks: true }</code>. You can override this behavior by passing <code>{ hooks: false }</code>.</li>
<li>The resulting promise from the <code>Model.validate</code> instance method will be rejected when validation fails. It will fulfill when validation succeeds.</li>
<li><code>Sequelize.Utils</code> is not longer part of the public API, use it at your own risk.</li>
<li><code>Hooks</code> should return Promises now. Callbacks are deprecated.</li>
<li>Getters wont run with <code>instance.get({ raw: true })</code>, use <code>instance.get({ plain: true })</code></li>
<li><p><code>required</code> inside include does not propagate up the include chain.</p>
<p>To get v3 compatible results you'll need to either set <code>required</code> on the containing include.</p>
<p><strong>Old</strong></p>
<pre><code class="lang-js"><code class="source-code prettyprint">user.findOne({
  include: {
    model: project,
    include: {
      model: task,
      required: true
    }
  }
});</code>
</code></pre>
<p><strong>New</strong></p>
<pre><code class="lang-js"><code class="source-code prettyprint">User.findOne({
  include: {
    model: Project,
    required: true,
    include: {
      model: Task,
      required: true
    }
  }
});

User.findOne({
  include: {
    model: Project,
    required: true,
    include: {
      model: Task,
      where: { type: 'important' } //where cause required to default to true
    }
  }
});</code>
</code></pre>
<p>Optionally you can add a <code>beforeFind</code> hook to get v3 compatible behavior -</p>
<pre><code class="lang-js"><code class="source-code prettyprint">function propagateRequired(modelDescriptor) {
  let include = modelDescriptor.include;

  if (!include) return false;
  if (!Array.isArray(include)) include = [include];

  return include.reduce((isRequired, descriptor) =&gt; {
    const hasRequiredChild = propogateRequired(descriptor);
    if ((descriptor.where || hasRequiredChild) &amp;&amp; descriptor.required === undefined) {
      descriptor.required = true;
    }
    return descriptor.required || isRequired;
  }, false);
}

const sequelize = new Sequelize(..., {
  ...,
  define: {
    hooks: {
      beforeFind: propagateRequired
    }
  }
});</code>
</code></pre>
</li>
</ul></div>
        <a data-ice="link" href="/v4/manual/tutorial/upgrade-to-v4.html"></a>
      </div>
    </div>
<div class="manual-card-wrap" data-ice="cards">
      <h1 data-ice="label" class="manual-color manual-color-advanced" data-section-count="■■"><span data-ice="label-inner">Working with legacy tables</span></h1>
      <div class="manual-card">
        <div data-ice="card"><h1>Working with legacy tables</h1><p>While out of the box Sequelize will seem a bit opinionated it's trivial to both legacy and forward proof your application by defining (otherwise generated) table and field names.</p><h2>Tables</h2><pre><code class="lang-js"><code class="source-code prettyprint">sequelize.define('user', {

}, {
  tableName: 'users'
});</code>
</code></pre><h2>Fields</h2><pre><code class="lang-js"><code class="source-code prettyprint">sequelize.define('modelName', {
  userId: {
    type: Sequelize.INTEGER,
    field: 'user_id'
  }
});</code>
</code></pre><h2>Primary keys</h2><p>Sequelize will assume your table has a <code>id</code> primary key property by default.</p><p>To define your own primary key:</p><pre><code class="lang-js"><code class="source-code prettyprint">sequelize.define('collection', {
  uid: {
    type: Sequelize.INTEGER,
    primaryKey: true,
    autoIncrement: true // Automatically gets converted to SERIAL for postgres
  }
});

sequelize.define('collection', {
  uuid: {
    type: Sequelize.UUID,
    primaryKey: true
  }
});</code>
</code></pre><p>And if your model has no primary key at all you can use <code>Model.removeAttribute('id');</code></p><h2>Foreign keys</h2><pre><code class="lang-js"><code class="source-code prettyprint">// 1:1
Organization.belongsTo(User, {foreignKey: 'owner_id'});
User.hasOne(Organization, {foreignKey: 'owner_id'});

// 1:M
Project.hasMany(Task, {foreignKey: 'tasks_pk'});
Task.belongsTo(Project, {foreignKey: 'tasks_pk'});

// N:M
User.hasMany(Role, {through: 'user_has_roles', foreignKey: 'user_role_user_id'});
Role.hasMany(User, {through: 'user_has_roles', foreignKey: 'roles_identifier'});</code>
</code></pre></div>
        <a data-ice="link" href="/v4/manual/advanced/legacy.html"></a>
      </div>
    </div>
<div class="manual-card-wrap" data-ice="cards">
      <h1 data-ice="label" class="manual-color manual-color-reference" data-section-count="■■■■■"><span data-ice="label-inner">References</span></h1>
      <div class="manual-card">
        <div data-ice="card"><h1>References</h1>
<div data-ice="classSummary"><h2 id="class">Class Summary</h2><table class="summary" data-ice="summary">
  <thead><tr><td data-ice="title" colspan="3">Static Public Class Summary</td></tr></thead>
  <tbody>
  
  <tr data-ice="target">
    <td>
      <span class="access" data-ice="access">public</span>
      
      
      
      <span class="override" data-ice="override"></span>
    </td>
    <td>
      <div>
        <p>
          
          
          <span data-ice="name"><span><a href="/v4/class/lib/errors/index.js~AccessDeniedError.html">AccessDeniedError</a></span></span>
        </p>
      </div>
      <div>
        
        
        <div data-ice="description"><p>Thrown when a connection to a database is refused due to insufficient privileges</p>
</div>
      </div>
    </td>
    <td>
      
      
    </td>
  </tr>
<tr data-ice="target">
    <td>
      <span class="access" data-ice="access">public</span>
      
      
      
      <span class="override" data-ice="override"></span>
    </td>
    <td>
      <div>
        <p>
          
          
          <span data-ice="name"><span><a href="/v4/class/lib/associations/base.js~Association.html">Association</a></span></span>
        </p>
      </div>
      <div>
        
        
        <div data-ice="description"><p>Creating associations in sequelize is done by calling one of the belongsTo / hasOne / hasMany / belongsToMany functions on a model (the source), and providing another model as the first argument to the function (the target).</p>
</div>
      </div>
    </td>
    <td>
      
      
    </td>
  </tr>
<tr data-ice="target">
    <td>
      <span class="access" data-ice="access">public</span>
      
      
      
      <span class="override" data-ice="override"></span>
    </td>
    <td>
      <div>
        <p>
          
          
          <span data-ice="name"><span><a href="/v4/class/lib/errors/index.js~AssociationError.html">AssociationError</a></span></span>
        </p>
      </div>
      <div>
        
        
        <div data-ice="description"><p>Thrown when an association is improperly constructed (see message for details)</p>
</div>
      </div>
    </td>
    <td>
      
      
    </td>
  </tr>
<tr data-ice="target">
    <td>
      <span class="access" data-ice="access">public</span>
      
      
      
      <span class="override" data-ice="override"></span>
    </td>
    <td>
      <div>
        <p>
          
          
          <span data-ice="name"><span><a href="/v4/class/lib/errors/index.js~BaseError.html">BaseError</a></span></span>
        </p>
      </div>
      <div>
        
        
        <div data-ice="description"><p>Sequelize provides a host of custom error classes, to allow you to do easier debugging.</p>
</div>
      </div>
    </td>
    <td>
      
      
    </td>
  </tr>
<tr data-ice="target">
    <td>
      <span class="access" data-ice="access">public</span>
      
      
      
      <span class="override" data-ice="override"></span>
    </td>
    <td>
      <div>
        <p>
          
          
          <span data-ice="name"><span><a href="/v4/class/lib/associations/belongs-to.js~BelongsTo.html">BelongsTo</a></span></span>
        </p>
      </div>
      <div>
        
        
        <div data-ice="description"><p>One-to-one association</p>
</div>
      </div>
    </td>
    <td>
      
      
    </td>
  </tr>
<tr data-ice="target">
    <td>
      <span class="access" data-ice="access">public</span>
      
      
      
      <span class="override" data-ice="override"></span>
    </td>
    <td>
      <div>
        <p>
          
          
          <span data-ice="name"><span><a href="/v4/class/lib/associations/belongs-to-many.js~BelongsToMany.html">BelongsToMany</a></span></span>
        </p>
      </div>
      <div>
        
        
        <div data-ice="description"><p>Many-to-many association with a join table.</p>
</div>
      </div>
    </td>
    <td>
      
      
    </td>
  </tr>
<tr data-ice="target">
    <td>
      <span class="access" data-ice="access">public</span>
      
      
      
      <span class="override" data-ice="override"></span>
    </td>
    <td>
      <div>
        <p>
          
          
          <span data-ice="name"><span><a href="/v4/class/lib/errors/index.js~BulkRecordError.html">BulkRecordError</a></span></span><span data-ice="signature">(error: <span>Error</span>, record: <span>Object</span>)</span>
        </p>
      </div>
      <div>
        
        
        <div data-ice="description"><p>Thrown when bulk operation fails, it represent per record level error.</p>
</div>
      </div>
    </td>
    <td>
      
      
    </td>
  </tr>
<tr data-ice="target">
    <td>
      <span class="access" data-ice="access">public</span>
      
      
      
      <span class="override" data-ice="override"></span>
    </td>
    <td>
      <div>
        <p>
          
          
          <span data-ice="name"><span><a href="/v4/class/lib/errors/index.js~ConnectionError.html">ConnectionError</a></span></span>
        </p>
      </div>
      <div>
        
        
        <div data-ice="description"><p>A base class for all connection related errors.</p>
</div>
      </div>
    </td>
    <td>
      
      
    </td>
  </tr>
<tr data-ice="target">
    <td>
      <span class="access" data-ice="access">public</span>
      
      
      
      <span class="override" data-ice="override"></span>
    </td>
    <td>
      <div>
        <p>
          
          
          <span data-ice="name"><span><a href="/v4/class/lib/errors/index.js~ConnectionRefusedError.html">ConnectionRefusedError</a></span></span>
        </p>
      </div>
      <div>
        
        
        <div data-ice="description"><p>Thrown when a connection to a database is refused</p>
</div>
      </div>
    </td>
    <td>
      
      
    </td>
  </tr>
<tr data-ice="target">
    <td>
      <span class="access" data-ice="access">public</span>
      
      
      
      <span class="override" data-ice="override"></span>
    </td>
    <td>
      <div>
        <p>
          
          
          <span data-ice="name"><span><a href="/v4/class/lib/errors/index.js~ConnectionTimedOutError.html">ConnectionTimedOutError</a></span></span>
        </p>
      </div>
      <div>
        
        
        <div data-ice="description"><p>Thrown when a connection to a database times out</p>
</div>
      </div>
    </td>
    <td>
      
      
    </td>
  </tr>
<tr data-ice="target">
    <td>
      <span class="access" data-ice="access">public</span>
      
      
      
      <span class="override" data-ice="override"></span>
    </td>
    <td>
      <div>
        <p>
          
          
          <span data-ice="name"><span><a href="/v4/class/lib/errors/index.js~DatabaseError.html">DatabaseError</a></span></span>
        </p>
      </div>
      <div>
        
        
        <div data-ice="description"><p>A base class for all database related errors.</p>
</div>
      </div>
    </td>
    <td>
      
      
    </td>
  </tr>
<tr data-ice="target">
    <td>
      <span class="access" data-ice="access">public</span>
      
      
      
      <span class="override" data-ice="override"></span>
    </td>
    <td>
      <div>
        <p>
          
          
          <span data-ice="name"><span><a href="/v4/class/lib/errors/index.js~EagerLoadingError.html">EagerLoadingError</a></span></span>
        </p>
      </div>
      <div>
        
        
        <div data-ice="description"><p>Thrown when an include statement is improperly constructed (see message for details)</p>
</div>
      </div>
    </td>
    <td>
      
      
    </td>
  </tr>
<tr data-ice="target">
    <td>
      <span class="access" data-ice="access">public</span>
      
      
      
      <span class="override" data-ice="override"></span>
    </td>
    <td>
      <div>
        <p>
          
          
          <span data-ice="name"><span><a href="/v4/class/lib/errors/index.js~EmptyResultError.html">EmptyResultError</a></span></span>
        </p>
      </div>
      <div>
        
        
        <div data-ice="description"><p>Thrown when a record was not found, Usually used with rejectOnEmpty mode (see message for details)</p>
</div>
      </div>
    </td>
    <td>
      
      
    </td>
  </tr>
<tr data-ice="target">
    <td>
      <span class="access" data-ice="access">public</span>
      
      
      
      <span class="override" data-ice="override"></span>
    </td>
    <td>
      <div>
        <p>
          
          
          <span data-ice="name"><span><a href="/v4/class/lib/errors/index.js~ExclusionConstraintError.html">ExclusionConstraintError</a></span></span>
        </p>
      </div>
      <div>
        
        
        <div data-ice="description"><p>Thrown when an exclusion constraint is violated in the database</p>
</div>
      </div>
    </td>
    <td>
      
      
    </td>
  </tr>
<tr data-ice="target">
    <td>
      <span class="access" data-ice="access">public</span>
      
      
      
      <span class="override" data-ice="override"></span>
    </td>
    <td>
      <div>
        <p>
          
          
          <span data-ice="name"><span><a href="/v4/class/lib/errors/index.js~ForeignKeyConstraintError.html">ForeignKeyConstraintError</a></span></span>
        </p>
      </div>
      <div>
        
        
        <div data-ice="description"><p>Thrown when a foreign key constraint is violated in the database</p>
</div>
      </div>
    </td>
    <td>
      
      
    </td>
  </tr>
<tr data-ice="target">
    <td>
      <span class="access" data-ice="access">public</span>
      
      
      
      <span class="override" data-ice="override"></span>
    </td>
    <td>
      <div>
        <p>
          
          
          <span data-ice="name"><span><a href="/v4/class/lib/associations/has-many.js~HasMany.html">HasMany</a></span></span>
        </p>
      </div>
      <div>
        
        
        <div data-ice="description"><p>One-to-many association</p>
</div>
      </div>
    </td>
    <td>
      
      
    </td>
  </tr>
<tr data-ice="target">
    <td>
      <span class="access" data-ice="access">public</span>
      
      
      
      <span class="override" data-ice="override"></span>
    </td>
    <td>
      <div>
        <p>
          
          
          <span data-ice="name"><span><a href="/v4/class/lib/associations/has-one.js~HasOne.html">HasOne</a></span></span>
        </p>
      </div>
      <div>
        
        
        <div data-ice="description"><p>One-to-one association</p>
</div>
      </div>
    </td>
    <td>
      
      
    </td>
  </tr>
<tr data-ice="target">
    <td>
      <span class="access" data-ice="access">public</span>
      
      
      
      <span class="override" data-ice="override"></span>
    </td>
    <td>
      <div>
        <p>
          
          
          <span data-ice="name"><span><a href="/v4/class/lib/errors/index.js~HostNotFoundError.html">HostNotFoundError</a></span></span>
        </p>
      </div>
      <div>
        
        
        <div data-ice="description"><p>Thrown when a connection to a database has a hostname that was not found</p>
</div>
      </div>
    </td>
    <td>
      
      
    </td>
  </tr>
<tr data-ice="target">
    <td>
      <span class="access" data-ice="access">public</span>
      
      
      
      <span class="override" data-ice="override"></span>
    </td>
    <td>
      <div>
        <p>
          
          
          <span data-ice="name"><span><a href="/v4/class/lib/errors/index.js~HostNotReachableError.html">HostNotReachableError</a></span></span>
        </p>
      </div>
      <div>
        
        
        <div data-ice="description"><p>Thrown when a connection to a database has a hostname that was not reachable</p>
</div>
      </div>
    </td>
    <td>
      
      
    </td>
  </tr>
<tr data-ice="target">
    <td>
      <span class="access" data-ice="access">public</span>
      
      
      
      <span class="override" data-ice="override"></span>
    </td>
    <td>
      <div>
        <p>
          
          
          <span data-ice="name"><span><a href="/v4/class/lib/errors/index.js~InstanceError.html">InstanceError</a></span></span>
        </p>
      </div>
      <div>
        
        
        <div data-ice="description"><p>Thrown when a some problem occurred with Instance methods (see message for details)</p>
</div>
      </div>
    </td>
    <td>
      
      
    </td>
  </tr>
<tr data-ice="target">
    <td>
      <span class="access" data-ice="access">public</span>
      
      
      
      <span class="override" data-ice="override"></span>
    </td>
    <td>
      <div>
        <p>
          
          
          <span data-ice="name"><span><a href="/v4/class/lib/errors/index.js~InvalidConnectionError.html">InvalidConnectionError</a></span></span>
        </p>
      </div>
      <div>
        
        
        <div data-ice="description"><p>Thrown when a connection to a database has invalid values for any of the connection parameters</p>
</div>
      </div>
    </td>
    <td>
      
      
    </td>
  </tr>
<tr data-ice="target">
    <td>
      <span class="access" data-ice="access">public</span>
      
      
      
      <span class="override" data-ice="override"></span>
    </td>
    <td>
      <div>
        <p>
          
          
          <span data-ice="name"><span><a href="/v4/class/lib/model.js~Model.html">Model</a></span></span>
        </p>
      </div>
      <div>
        
        
        <div data-ice="description"><p>A Model represents a table in the database.</p>
</div>
      </div>
    </td>
    <td>
      
      
    </td>
  </tr>
<tr data-ice="target">
    <td>
      <span class="access" data-ice="access">public</span>
      
      
      
      <span class="override" data-ice="override"></span>
    </td>
    <td>
      <div>
        <p>
          
          
          <span data-ice="name"><span><a href="/v4/class/lib/errors/index.js~OptimisticLockError.html">OptimisticLockError</a></span></span>
        </p>
      </div>
      <div>
        
        
        <div data-ice="description"><p>Thrown when attempting to update a stale model instance</p>
</div>
      </div>
    </td>
    <td>
      
      
    </td>
  </tr>
<tr data-ice="target">
    <td>
      <span class="access" data-ice="access">public</span>
      
      
      
      <span class="override" data-ice="override"></span>
    </td>
    <td>
      <div>
        <p>
          
          
          <span data-ice="name"><span><a href="/v4/class/lib/errors/index.js~QueryError.html">QueryError</a></span></span>
        </p>
      </div>
      <div>
        
        
        <div data-ice="description"><p>Thrown when a query is passed invalid options (see message for details)</p>
</div>
      </div>
    </td>
    <td>
      
      
    </td>
  </tr>
<tr data-ice="target">
    <td>
      <span class="access" data-ice="access">public</span>
      
      
      
      <span class="override" data-ice="override"></span>
    </td>
    <td>
      <div>
        <p>
          
          
          <span data-ice="name"><span><a href="/v4/class/lib/query-interface.js~QueryInterface.html">QueryInterface</a></span></span>
        </p>
      </div>
      <div>
        
        
        <div data-ice="description"><p>The interface that Sequelize uses to talk to all databases</p>
</div>
      </div>
    </td>
    <td>
      
      
    </td>
  </tr>
<tr data-ice="target">
    <td>
      <span class="access" data-ice="access">public</span>
      
      
      
      <span class="override" data-ice="override"></span>
    </td>
    <td>
      <div>
        <p>
          
          
          <span data-ice="name"><span><a href="/v4/class/lib/sequelize.js~Sequelize.html">Sequelize</a></span></span>
        </p>
      </div>
      <div>
        
        
        <div data-ice="description"><p>This is the main class, the entry point to sequelize.</p>
</div>
      </div>
    </td>
    <td>
      
      
    </td>
  </tr>
<tr data-ice="target">
    <td>
      <span class="access" data-ice="access">public</span>
      
      
      
      <span class="override" data-ice="override"></span>
    </td>
    <td>
      <div>
        <p>
          
          
          <span data-ice="name"><span><a href="/v4/class/lib/errors/index.js~SequelizeScopeError.html">SequelizeScopeError</a></span></span>
        </p>
      </div>
      <div>
        
        
        <div data-ice="description"><p>Scope Error.</p>
</div>
      </div>
    </td>
    <td>
      
      
    </td>
  </tr>
<tr data-ice="target">
    <td>
      <span class="access" data-ice="access">public</span>
      
      
      
      <span class="override" data-ice="override"></span>
    </td>
    <td>
      <div>
        <p>
          
          
          <span data-ice="name"><span><a href="/v4/class/lib/errors/index.js~TimeoutError.html">TimeoutError</a></span></span>
        </p>
      </div>
      <div>
        
        
        <div data-ice="description"><p>Thrown when a database query times out because of a deadlock</p>
</div>
      </div>
    </td>
    <td>
      
      
    </td>
  </tr>
<tr data-ice="target">
    <td>
      <span class="access" data-ice="access">public</span>
      
      
      
      <span class="override" data-ice="override"></span>
    </td>
    <td>
      <div>
        <p>
          
          
          <span data-ice="name"><span><a href="/v4/class/lib/transaction.js~Transaction.html">Transaction</a></span></span>
        </p>
      </div>
      <div>
        
        
        <div data-ice="description"><p>The transaction object is used to identify a running transaction.</p>
</div>
      </div>
    </td>
    <td>
      
      
    </td>
  </tr>
<tr data-ice="target">
    <td>
      <span class="access" data-ice="access">public</span>
      
      
      
      <span class="override" data-ice="override"></span>
    </td>
    <td>
      <div>
        <p>
          
          
          <span data-ice="name"><span><a href="/v4/class/lib/errors/index.js~UniqueConstraintError.html">UniqueConstraintError</a></span></span>
        </p>
      </div>
      <div>
        
        
        <div data-ice="description"><p>Thrown when a unique constraint is violated in the database</p>
</div>
      </div>
    </td>
    <td>
      
      
    </td>
  </tr>
<tr data-ice="target">
    <td>
      <span class="access" data-ice="access">public</span>
      
      
      
      <span class="override" data-ice="override"></span>
    </td>
    <td>
      <div>
        <p>
          
          
          <span data-ice="name"><span><a href="/v4/class/lib/errors/index.js~UnknownConstraintError.html">UnknownConstraintError</a></span></span>
        </p>
      </div>
      <div>
        
        
        <div data-ice="description"><p>Thrown when constraint name is not found in the database</p>
</div>
      </div>
    </td>
    <td>
      
      
    </td>
  </tr>
<tr data-ice="target">
    <td>
      <span class="access" data-ice="access">public</span>
      
      
      
      <span class="override" data-ice="override"></span>
    </td>
    <td>
      <div>
        <p>
          
          
          <span data-ice="name"><span><a href="/v4/class/lib/errors/index.js~ValidationError.html">ValidationError</a></span></span><span data-ice="signature">(message: <span>string</span>, errors: <span>Array</span>)</span>
        </p>
      </div>
      <div>
        
        
        <div data-ice="description"><p>Validation Error.</p>
</div>
      </div>
    </td>
    <td>
      
      
    </td>
  </tr>
<tr data-ice="target">
    <td>
      <span class="access" data-ice="access">public</span>
      
      
      
      <span class="override" data-ice="override"></span>
    </td>
    <td>
      <div>
        <p>
          
          
          <span data-ice="name"><span><a href="/v4/class/lib/errors/index.js~ValidationErrorItem.html">ValidationErrorItem</a></span></span><span data-ice="signature">(message: <span>String</span>, type: <span>String</span>, path: <span>String</span>, value: <span>String</span>, inst: <span>Object</span>, validatorKey: <span>Object</span>, fnName: <span>String</span>, fnArgs: <span>String</span>)</span>
        </p>
      </div>
      <div>
        
        
        <div data-ice="description"><p>Validation Error Item
Instances of this class are included in the <code>ValidationError.errors</code> property.</p>
</div>
      </div>
    </td>
    <td>
      
      
    </td>
  </tr>
</tbody>
</table>
</div>

<div data-ice="functionSummary"><h2 id="function">Function Summary</h2><table class="summary" data-ice="summary">
  <thead><tr><td data-ice="title" colspan="3">Static Public Function Summary</td></tr></thead>
  <tbody>
  
  <tr data-ice="target">
    <td>
      <span class="access" data-ice="access">public</span>
      
      
      
      <span class="override" data-ice="override"></span>
    </td>
    <td>
      <div>
        <p>
          
          
          <span data-ice="name"><span><a href="/v4/function/index.html#static-function-isImmutable">isImmutable</a></span></span><span data-ice="signature">(value: <span>*</span>, validatorArgs: <span>*</span>, field: <span>*</span>, modelInstance: <span>*</span>): <span>*</span></span>
        </p>
      </div>
      <div>
        
        
        <div data-ice="description"><p>Instance based validators</p>
</div>
      </div>
    </td>
    <td>
      
      
    </td>
  </tr>
</tbody>
</table>
</div>
<div data-ice="variableSummary"><h2 id="variable">Variable Summary</h2><table class="summary" data-ice="summary">
  <thead><tr><td data-ice="title" colspan="3">Static Public Variable Summary</td></tr></thead>
  <tbody>
  
  <tr data-ice="target">
    <td>
      <span class="access" data-ice="access">public</span>
      
      
      
      <span class="override" data-ice="override"></span>
    </td>
    <td>
      <div>
        <p>
          
          
          <span data-ice="name"><span><a href="/v4/variable/index.html#static-variable-DataTypes">DataTypes</a></span></span><span data-ice="signature">: <span>*</span></span>
        </p>
      </div>
      <div>
        
        
        <div data-ice="description"><p>A convenience class holding commonly used data types.</p>
</div>
      </div>
    </td>
    <td>
      
      
    </td>
  </tr>
<tr data-ice="target">
    <td>
      <span class="access" data-ice="access">public</span>
      
      
      
      <span class="override" data-ice="override"></span>
    </td>
    <td>
      <div>
        <p>
          
          
          <span data-ice="name"><span><a href="/v4/variable/index.html#static-variable-Deferrable">Deferrable</a></span></span><span data-ice="signature">: <span>*</span></span>
        </p>
      </div>
      <div>
        
        
        <div data-ice="description"><p>A collection of properties related to deferrable constraints.</p>
</div>
      </div>
    </td>
    <td>
      
      
    </td>
  </tr>
<tr data-ice="target">
    <td>
      <span class="access" data-ice="access">public</span>
      
      
      
      <span class="override" data-ice="override"></span>
    </td>
    <td>
      <div>
        <p>
          
          
          <span data-ice="name"><span><a href="/v4/variable/index.html#static-variable-Op">Op</a></span></span><span data-ice="signature">: {"eq": <span>*</span>, "ne": <span>*</span>, "gte": <span>*</span>, "gt": <span>*</span>, "lte": <span>*</span>, "lt": <span>*</span>, "not": <span>*</span>, "is": <span>*</span>, "in": <span>*</span>, "notIn": <span>*</span>, "like": <span>*</span>, "notLike": <span>*</span>, "iLike": <span>*</span>, "notILike": <span>*</span>, "regexp": <span>*</span>, "notRegexp": <span>*</span>, "iRegexp": <span>*</span>, "notIRegexp": <span>*</span>, "between": <span>*</span>, "notBetween": <span>*</span>, "overlap": <span>*</span>, "contains": <span>*</span>, "contained": <span>*</span>, "adjacent": <span>*</span>, "strictLeft": <span>*</span>, "strictRight": <span>*</span>, "noExtendRight": <span>*</span>, "noExtendLeft": <span>*</span>, "and": <span>*</span>, "or": <span>*</span>, "any": <span>*</span>, "all": <span>*</span>, "values": <span>*</span>, "col": <span>*</span>, "placeholder": <span>*</span>, "join": <span>*</span>, "raw": <span>*</span>}</span>
        </p>
      </div>
      <div>
        
        
        <div data-ice="description"><p>Operator symbols to be used when querying data</p>
</div>
      </div>
    </td>
    <td>
      
      
    </td>
  </tr>
<tr data-ice="target">
    <td>
      <span class="access" data-ice="access">public</span>
      
      
      
      <span class="override" data-ice="override"></span>
    </td>
    <td>
      <div>
        <p>
          
          
          <span data-ice="name"><span><a href="/v4/variable/index.html#static-variable-QueryTypes">QueryTypes</a></span></span><span data-ice="signature">: <span>*</span></span>
        </p>
      </div>
      <div>
        
        
        <div data-ice="description"><p>An enum of query types used by <code>sequelize.query</code></p>
</div>
      </div>
    </td>
    <td>
      
      
    </td>
  </tr>
<tr data-ice="target">
    <td>
      <span class="access" data-ice="access">public</span>
      
      
      
      <span class="override" data-ice="override"></span>
    </td>
    <td>
      <div>
        <p>
          
          
          <span data-ice="name"><span><a href="/v4/variable/index.html#static-variable-TableHints">TableHints</a></span></span><span data-ice="signature">: <span>*</span></span>
        </p>
      </div>
      <div>
        
        
        <div data-ice="description"><p>An enum of table hints to be used in mssql for querying with table hints</p>
</div>
      </div>
    </td>
    <td>
      
      
    </td>
  </tr>
</tbody>
</table>
</div>


</div>
        <a data-ice="link" href="/v4/identifiers.html"></a>
      </div>
    </div>
<div class="manual-card-wrap" data-ice="cards">
      <h1 data-ice="label" class="manual-color manual-color-faq" data-section-count="■"><span data-ice="label-inner">Who's using sequelize?</span></h1>
      <div class="manual-card">
        <div data-ice="card"><h1>Who's using sequelize?</h1><p><a href="http://www.walmartlabs.com/"><img src="/v4/./manual/asset/walmart-labs-logo.png" alt="Walmart labs logo"></a></p><blockquote>
<p>... we are avid users of sequelize (and have been for the past 18 months) (Feb 2017)</p>
</blockquote><p></p><hr>

<p></p><p><a href="https://snaplytics.io"><img src="/v4/./manual/asset/logo-snaplytics-green.png" alt="Snaplytics logo"></a></p><blockquote>
<p>We've been using sequelize since we started in the beginning of 2015. We use it for our graphql servers (in connection with <a href="http://github.com/mickhansen/graphql-sequelize">graphql-sequelize</a>), and for all our background workers.</p>
</blockquote><p></p><hr>

<p></p><p><a href="https://connectedcars.io/"><img src="/v4/./manual/asset/connected-cars.png" alt="Connected Cars logo"></a></p><p></p><hr>

<p></p><p><a href="https://bitovi.com"><img src="/v4/./manual/asset/bitovi-logo.png" alt="Bitovi Logo"></a></p><blockquote>
<p>We have used Sequelize in enterprise projects for some of our Fortune 100 and Fortune 500 clients.  It is used in deployments that are depended on by hundreds of millions of devices every year.</p>
</blockquote><p></p><hr>

<p></p><p><a href="https://ermeshotels.com"><img src="/v4/./manual/asset/ermeshotels-logo.png" alt="ErmesHotels Logo"></a></p><blockquote>
<p>Using Sequelize in production for two different apps with 30k+ daily users by 2 years. I doubt there is something better at this moment in terms of productivity and features.</p>
</blockquote></div>
        <a data-ice="link" href="/v4/manual/faq/whos-using.html"></a>
      </div>
    </div>
<div class="manual-card-wrap" data-ice="cards">
      <h1 data-ice="label" class="manual-color manual-color-faq" data-section-count="■"><span data-ice="label-inner">Imprint</span></h1>
      <div class="manual-card">
        <div data-ice="card"><h1>Imprint</h1><ul>
<li>Boring legal stuff for the rest of us.
As there are people who are suing for fun and glory, you can find the respective information about the author of the page right here. Have fun reading ...</li>
</ul><h2>AUTHOR(S)</h2><pre><code><code class="source-code prettyprint">Main author:

Sascha Depold
Uhlandstr. 160
10719 Berlin
sascha [at] depold [dot] com
[plus] 49 152 [slash] 03878582</code>
</code></pre><h2>INHALTLICHE VERANTWORTUNG</h2><pre><code><code class="source-code prettyprint">Ich übernehme keine Haftung für ausgehende Links. 
Daher musst du dich bei Problemen an deren Betreiber wenden!</code>
</code></pre></div>
        <a data-ice="link" href="/v4/manual/faq/imprint.html"></a>
      </div>
    </div>
</div>
</div>
</div>

<footer class="footer">
  Generated by <a href="https://esdoc.org">ESDoc<span data-ice="esdocVersion">(0.5.2)</span><img src="/v4/./image/esdoc-logo-mini-black.png"></a>
</footer>



<script src="/v4/script/pretty-print.js"></script>



<script src="/v4/script/patch-for-local.js"></script>


</body></html>