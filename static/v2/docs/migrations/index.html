<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title></title>
  

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="/v2/css/theme.css" type="text/css" />
  <link href="/v2/css/custom.css" rel="stylesheet">

  <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/modernizr/2.8.3/modernizr.min.js"></script>
  <script src="../../js/theme.js"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.4/highlight.min.js"></script>
  <script src="../../search/main.js"></script>

  <style>
    body {font-size: 90%;}
    pre, code {font-size: 100%;}
    h3, h4, h5, h6 {color: #2980b9; font-weight: 300}
  </style> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href="/v2/" class="icon icon-home"> </a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
      <ul class="current">
   
  <span class="toctree-l0">Home</span>
  
  <li class="toctree-l1 ">
    <a class="" href="/v2/"
      >Welcome</a
    >
    
  </li>
  
  <li class="toctree-l1 ">
    <a class="" href="/v2/imprint/"
      >Imprint</a
    >
    
  </li>
     
  <span class="toctree-l0">Articles</span>
  
  <li class="toctree-l1 ">
    <a class="" href="/v2/articles/getting-started/"
      >Getting started</a
    >
    
  </li>
  
  <li class="toctree-l1 ">
    <a class="" href="/v2/articles/heroku/"
      >Heroku</a
    >
    
  </li>
  
  <li class="toctree-l1 ">
    <a class="" href="/v2/articles/express/"
      >Usage with Express.JS</a
    >
    
  </li>
     
  <span class="toctree-l0">Docs</span>
  
  <li class="toctree-l1 ">
    <a class="" href="/v2/docs/installation/"
      >Installation</a
    >
    
  </li>
  
  <li class="toctree-l1 ">
    <a class="" href="/v2/docs/usage/"
      >Usage</a
    >
    
  </li>
  
  <li class="toctree-l1 ">
    <a class="" href="/v2/docs/promises/"
      >Promises</a
    >
    
  </li>
  
  <li class="toctree-l1 ">
    <a class="" href="/v2/docs/models/"
      >Models</a
    >
    
  </li>
  
  <li class="toctree-l1 ">
    <a class="" href="/v2/docs/instances/"
      >Instances</a
    >
    
  </li>
  
  <li class="toctree-l1 ">
    <a class="" href="/v2/docs/associations/"
      >Associations</a
    >
    
  </li>
  
  <li class="toctree-l1 ">
    <a class="" href="/v2/docs/hooks/"
      >Hooks</a
    >
    
  </li>
  
  <li class="toctree-l1 ">
    <a class="" href="/v2/docs/transactions/"
      >Transactions</a
    >
    
  </li>
  
  <li class="toctree-l1 current">
    <a class="current" href="/v2/docs/migrations/"
      >Migrations</a
    >
    
    <ul>
      
    </ul>
    
  </li>
  
  <li class="toctree-l1 ">
    <a class="" href="/v2/docs/misc/"
      >Misc</a
    >
    
  </li>
     
  <span class="toctree-l0">API</span>
  
  <li class="toctree-l1 ">
    <a class="" href="/v2/api/sequelize/"
      >Sequelize</a
    >
    
  </li>
  
  <li class="toctree-l1 ">
    <a class="" href="/v2/api/model/"
      >Model</a
    >
    
  </li>
  
  <li class="toctree-l1 ">
    <a class="" href="/v2/api/instance/"
      >Instance</a
    >
    
  </li>
  
  <li class="toctree-l1 ">
    <a class="" href="/v2/api/associations/"
      >Associations</a
    >
    
  </li>
  
  <li class="toctree-l1 ">
    <a class="" href="/v2/api/hooks/"
      >Hooks</a
    >
    
  </li>
  
  <li class="toctree-l1 ">
    <a class="" href="/v2/api/promise/"
      >Promise</a
    >
    
  </li>
  
  <li class="toctree-l1 ">
    <a class="" href="/v2/api/transaction/"
      >Transaction</a
    >
    
  </li>
  
  <li class="toctree-l1 ">
    <a class="" href="/v2/api/datatypes/"
      >Datatypes</a
    >
    
  </li>
  
  <li class="toctree-l1 ">
    <a class="" href="/v2/api/errors/"
      >Errors</a
    >
    
  </li>
    
</ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="icon icon-reorder"></i>
        <a href="/v2/"></a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="/v2/">Docs</a> &raquo;</li>
    <li>Migrations</li>
      <li class="wy-breadcrumbs-aside">
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              <p>Sequelize <code>2.0.0</code> introduces a new CLI which is based on <a href="http://gulpjs.com/">gulp</a> and combines <a href="https://github.com/sequelize/cli">sequelize-cli</a> and <a href="https://github.com/sequelize/gulp-sequelize">gulp-sequelize</a>. The CLI ships support for migrations and project bootstrapping. With migrations you can transfer your existing database into another state and vice versa: Those state transitions are saved in migration files, which describe the way how to get to the new state and how to revert the changes in order to get back to the old state.</p>
<h2 id="the-cli">The CLI</h2>
<p>In order to use the CLI you need to install the respective package:</p>
<pre><code class="language-bash">$ npm install --save sequelize-cli
</code></pre>
<p>The CLI currently supports the following commands:</p>
<pre><code class="language-bash">$ sequelize db:migrate        # Run pending migrations.
$ sequelize db:migrate:undo   # Revert the last migration run.
$ sequelize help              # Display this help text.
$ sequelize init              # Initializes the project.
$ sequelize migration:create  # Generates a new migration file.
$ sequelize version           # Prints the version number.
</code></pre>
<p>Further and more detailled information about the available commands
can be obtained via the help command:</p>
<pre><code class="language-bash">$ sequelize help:init
$ sequelize help:db:migrate
$ sequelize help:db:migrate:undo
# etc
</code></pre>
<p>The latter one for example will print out the following output:</p>
<pre><code class="language-bash">Sequelize [CLI: v0.0.2, ORM: v1.7.5]

COMMANDS
    sequelize db:migrate:undo -- Revert the last migration run.

DESCRIPTION
    Revert the last migration run.

OPTIONS
    --env           The environment to run the command in. Default: development
    --options-path  The path to a JSON file with additional options. Default: none
    --coffee        Enables coffee script support. Default: false
    --config        The path to the config file. Default: config/config.json
</code></pre>
<h2 id="skeleton">Skeleton</h2>
<p>The following skeleton shows a typical migration file&period; All migrations are expected to be located in a folder called <code>migrations</code> at the very top of the project&period; The sequelize binary can generate a migration skeleton&period; See the aboves section for more details&period;</p>
<pre><code class="language-js">module.exports = {
  up: function(migration, DataTypes, done) {
    // logic for transforming into the new state
    done() // sets the migration as finished
  },
 
  down: function(migration, DataTypes, done) {
    // logic for reverting the changes
    done() // sets the migration as finished
  }
}
</code></pre>
<p>The passed <code>migration</code> object can be used to modify the database&period; The <code>DataTypes</code> object stores the available data types such as <code>STRING</code> or <code>INTEGER</code>&period; The third parameter is a callback function which needs to be called once everything was executed&period; The first parameter of the callback function can be used to pass a possible error&period; In that case&comma; the migration will be marked as failed&period; Here is some code&colon;</p>
<pre><code class="language-js">module.exports = {
  up: function(migration, DataTypes, done) {
    migration.dropAllTables().complete(done)
 
    // equals:
    migration.dropAllTables().complete(function(err) {
      if (err) {
        done(err)
      } else {
        done(null)
      }
    })
  }
}
</code></pre>
<p>The available methods of the migration object are the following&period;</p>
<h2 id="functions">Functions</h2>
<p>Using the <code>migration</code> object describe before&comma; you will have access to most of already introduced functions&period; Furthermore there are some other methods&comma; which are designed to actually change the database schema&period;</p>
<h3 id="createtabletablename-attributes-options">createTable&lpar;tableName&comma; attributes&comma; options&rpar;</h3>
<p>This method allows creation of new tables&period; It is allowed to pass simple or complex attribute definitions&period; You can define the encoding of the table and the table's engine via options</p>
<pre><code class="language-js">migration.createTable(
  'nameOfTheNewTable',
  {
    id: {
      type: DataTypes.INTEGER,
      primaryKey: true,
      autoIncrement: true
    },
    createdAt: {
      type: DataTypes.DATE
    },
    updatedAt: {
      type: DataTypes.DATE
    },
    attr1: DataTypes.STRING,
    attr2: DataTypes.INTEGER,
    attr3: {
      type: DataTypes.BOOLEAN,
      defaultValue: false,
      allowNull: false
    }
  },
  {
    engine: 'MYISAM', // default: 'InnoDB'
    charset: 'latin1' // default: null
  }
)
</code></pre>
<h3 id="droptabletablename">dropTable&lpar;tableName&rpar;</h3>
<p>This method allows deletion of an existing table&period;</p>
<pre><code class="language-js">migration.dropTable('nameOfTheExistingTable')
</code></pre>
<h3 id="dropalltables">dropAllTables&lpar;&rpar;</h3>
<p>This method allows deletion of all existing tables in the database&period;</p>
<pre><code class="language-js">migration.dropAllTables()
</code></pre>
<h3 id="renametablebefore-after">renameTable&lpar;before&comma; after&rpar;</h3>
<p>This method allows renaming of an existing table&period;</p>
<pre><code class="language-js">migration.renameTable('Person', 'User')
</code></pre>
<h3 id="showalltables">showAllTables&lpar;&rpar;</h3>
<p>This method returns the name of all existing tables in the database&period;</p>
<pre><code class="language-js">migration.showAllTables().success(function(tableNames) {})
</code></pre>
<h3 id="describetabletablename">describeTable&lpar;tableName&rpar;</h3>
<p>This method returns an array of hashes containing information about all attributes in the table&period;</p>
<pre><code class="language-js">migration.describeTable('Person').success(function(attributes) {
  /*
    attributes will be something like:
 
    {
      name: {
        type:         'VARCHAR(255)', // this will be 'CHARACTER VARYING' for pg!
        allowNull:    true,
        defaultValue: null
      },
      isBetaMember: {
        type:         'TINYINT(1)', // this will be 'BOOLEAN' for pg!
        allowNull:    false,
        defaultValue: false
      }
    }
  */
})
</code></pre>
<h3 id="addcolumntablename-attributename-datatypeoroptions">addColumn&lpar;tableName&comma; attributeName&comma; dataTypeOrOptions&rpar;</h3>
<p>This method allows adding columns to an existing table&period; The data type can be simple or complex&period;</p>
<pre><code class="language-js">migration.addColumn(
  'nameOfAnExistingTable',
  'nameOfTheNewAttribute',
  DataTypes.STRING
)
 
// or
 
migration.addColumn(
  'nameOfAnExistingTable',
  'nameOfTheNewAttribute',
  {
    type: DataTypes.STRING,
    allowNull: false
  }
)
</code></pre>
<h3 id="removecolumntablename-attributename">removeColumn&lpar;tableName&comma; attributeName&rpar;</h3>
<p>This method allows deletion of a specific column of an existing table&period;</p>
<pre><code class="language-js">migration.removeColumn('Person', 'signature')
</code></pre>
<h3 id="changecolumntablename-attributename-datatypeoroptions">changeColumn&lpar;tableName&comma; attributeName&comma; dataTypeOrOptions&rpar;</h3>
<p>This method changes the meta data of an attribute&period; It is possible to change the default value&comma; allowance of null or the data type&period; Please make sure&comma; that you are completely describing the new data type&period; Missing information are expected to be defaults&period;</p>
<pre><code class="language-js">migration.changeColumn(
  'nameOfAnExistingTable',
  'nameOfAnExistingAttribute',
  DataTypes.STRING
)
 
// or
 
migration.changeColumn(
  'nameOfAnExistingTable',
  'nameOfAnExistingAttribute',
  {
    type: DataTypes.FLOAT,
    allowNull: false,
    default: 0.0
  }
)
</code></pre>
<h3 id="renamecolumntablename-attrnamebefore-attrnameafter">renameColumn&lpar;tableName&comma; attrNameBefore&comma; attrNameAfter&rpar;</h3>
<p>This methods allows renaming attributes&period;</p>
<pre><code class="language-js">migration.renameColumn('Person', 'signature', 'sig')
</code></pre>
<h3 id="addindextablename-attributes-options">addIndex&lpar;tableName&comma; attributes&comma; options&rpar;</h3>
<p>This methods creates indexes for specific attributes of a table&period; The index name will be automatically generated if it is not passed via in the options &lpar;see below&rpar;&period;</p>
<pre><code class="language-js">// This example will create the index person_firstname_lastname
migration.addIndex('Person', ['firstname', 'lastname'])

// This example will create a unique index with the name SuperDuperIndex using the optional 'options' field.
// Possible options:
// - indicesType: UNIQUE|FULLTEXT|SPATIAL
// - indexName: The name of the index. Default is __
// - parser: For FULLTEXT columns set your parser
// - indexType: Set a type for the index, e.g. BTREE. See the documentation of the used dialect
migration.addIndex(
  'Person',
  ['firstname', 'lastname'],
  {
    indexName: 'SuperDuperIndex',
    indicesType: 'UNIQUE'
  }
)
</code></pre>
<h3 id="removeindextablename-indexnameorattributes">removeIndex&lpar;tableName&comma; indexNameOrAttributes&rpar;</h3>
<p>This method deletes an existing index of a table&period;</p>
<pre><code class="language-js">migration.removeIndex('Person', 'SuperDuperIndex')
 
// or
 
migration.removeIndex('Person', ['firstname', 'lastname'])
</code></pre>
<h2 id="programmatic-use">Programmatic use</h2>
<p>If you need to interact with the migrator within your code, you can easily achieve that via <code>sequelize.getMigrator</code>. You can specify the path to your migrations as well as a pattern which represents the files that contain the migrations.</p>
<pre><code class="language-js">var migrator = sequelize.getMigrator({
  path:        process.cwd() + '/database/migrations',
  filesFilter: /\.coffee$/
})
</code></pre>
<p>Once you have a migrator object, you can run its migration with <code>migrator.migrate</code>. By default, this will execute all the up methods within your pending migrations. If you want to rollback a migration, just call it like this:</p>
<pre><code class="language-js">migrator
  .migrate({ method: 'down' })
  .success(function() {
    // The migrations have been executed!
  })
</code></pre>
            </div>
          </div> 
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
    <!-- Copyright etc -->
    </p>
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a>, using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
	  
        </div>
      </div>

    </section>

  </div>

<div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
        
      <span><a href="/v2/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      <span style="margin-left: 15px"><a href="/v2/" style="color: #fcfcfc">Next &raquo;</a></span>
    </span>
</div>
</body>
</html>